{"title":"Gather","markdown":{"headingText":"Gather","containsRefs":false,"markdown":"\n## About\n\nThis page gathers KoBoToolbox files from the home visit questionnaires.\n\n## Setup\n\nLoad helper functions and required package dependencies.\n\n```{r setup}\nfl <-\n  list.files(\n    file.path(here::here(), \"R\"),\n    \"^load|^kobo_|^file_|^screen_|^ecbq_|^health_|^databrary|^home|^make|^export|^post_visit|CONSTANTS\",\n    full.names = TRUE\n  )\npurrr::walk(fl, source)\n\nsuppressPackageStartupMessages(library(tidyverse))\n```\n\nData files for each of the language by age-group conditions are stored on KoBoToolbox (KBT).\n\nThe data files on KBT are stored in `kb_df`, a data frame that is generated as one of the workflow targets.\n\n```{r home-visit-list-forms}\ntargets::tar_load(kb_df, store=file.path(here::here(), \"_targets\"))\nkb_df\n```\n\n## Download data {-}\n\nList data forms specific to the home visit by filtering the files with names that contain \"Home\".\n\n```{r filter-home-visits}\nkb_home_df <- kobo_list_data_filtered(kb_df, \"Home\")\nkb_home_df\n```\n\nThere are *n*= {r dim(kb_home_df)[1]} separate data files.\n\n## Retrieve and save files {-}\n\nWe save the answer files in `data/xlsx/home_visit/raw/ans` and the question files in `data/xlsx/home_visit/raw/qs`.\nTo extract the answer data only, we would set `save_form = FALSE`.\n\n::: {.callout-note}\nThis process seems inefficient.\nMost of the time most of the files do not change.\nBut, it ensures that if there are any upstream changes to the raw KoBoToolbox data forms that those get propagated to our local copies.\n:::\n\n```{r retrieve-home-xlsx-from-kobo}\nkobo_retrieve_save_many_xlsx(\n  kb_home_df,\n  save_dir = file.path(here::here(), \"data/xlsx/home_visit/raw\"),\n  save_form = TRUE\n)\n```\n\n### Normalize file names {-}\n\nSome of the form names are inconsistent, so we normalize them to fit the following pattern:\n\n`<form_id>_PLAY_HomeQuestionnaires_<age_group>_<lang_group>.xlsx`\n\n```{r rename-home-visit}\nrename_home_xlsx(\n  fl = list.files(\n    file.path(here::here(), \"data/xlsx/home_visit/raw/ans\"),\n    \"\\\\.xlsx$\",\n    full.names = TRUE\n  ),\n  out_dir = file.path(here::here(), \"data/xlsx/home_visit/std_name\")\n)\n```\n\n### Save renamed xlsx as csv {-}\n\nWe save the (answer) CSVs in `data/csv/home_visit/raw`.\n\n```{r load-xlsx-save-csvs}\nfile_load_xlsx_save_many_csv(\n  in_dir = file.path(here::here(), \"data/xlsx/home_visit/std_name\"),\n  out_dir = file.path(here::here(), \"data/csv/home_visit/raw\"),\n  filter_str = \".*\"\n)\n```\n\n## Split MB-CDI from non {-}\n\nNext we import a CSV for a given form year, age group, and language group, and create two new CSV files: one with the MB-CDI data and one with all of the other survey questions.\n\nBy default, the document presumes that we want to convert **all** of the CSV files\n\nExtract the 'non-mbcdi' questions first and add 'non_mbcdi' to the filename.\n\n```{r split-non-mbcdi}\nfile_split_non_mbcdi_csvs(\n  fl = list.files(\n    file.path(here::here(), \"data/csv/home_visit/raw\"),\n    \"\\\\.csv$\",\n    full.names = TRUE\n  ),\n  out_dir = file.path(here::here(), \"data/csv/home_visit/non_mbcdi/raw\")\n)\n```\n\nCreating a separate MBCDI CSV relies on a very similar function `file_split_mbcdi_csvs`.\n\n```{r split-mbcdi}\nfile_split_mbcdi_csvs(\n  fl = list.files(\n    file.path(here::here(), \"data/csv/home_visit/raw\"),\n    \"\\\\.csv$\",\n    full.names = TRUE\n  ),\n  out_dir = file.path(here::here(), \"data/csv/home_visit/mbcdi\")\n)\n```\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["include/css/style.css"],"number-sections":false,"toc":true,"toc-depth":3,"output-file":"home-visit-gather.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.40","editor":"source","theme":"default","csl":"include/bib/apa.csl","bibliography":["include/bib/book.bib","include/bib/packages.bib"],"citations-hover":true,"date-modified":"last-modified","lightbox":true},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}