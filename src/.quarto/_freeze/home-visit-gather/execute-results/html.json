{
  "hash": "282155d9f38761d23544549ad61c7ef6",
  "result": {
    "engine": "knitr",
    "markdown": "# Home visit: Gathering\n\n## Download data {-}\n\nData files for each of the language by age-group conditions are stored on KoBoToolbox (KBT).\n\nStore all of the data files on KBT in `kb_df`.\n\n```\ntar_target(kb_df, list_kobo_data()),\n```\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(targets)\ntargets::tar_load(kb_df, store=\"../_targets\")\nkb_df\n```\n:::\n\n\n\n\n\nList data forms specific to the home visit by filtering the files with names that contain \"Home\".\n\n```\ntar_target(kb_home, dplyr::filter(kb_df, stringr::str_detect(title, \"Home\")))\n```\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntargets::tar_load(kb_home, store=\"../_targets\")\nkb_home\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        id              id_string\n1   411456 a58ZhjX6M8WXtzLGvBaEaG\n2   740625 a8HyzdxnVjK53dt4fX3Vup\n3   331453 aae4wz2tpkSnAkea2PAzin\n4   363465 abYGMsrMvkGsnA4xm9kqC9\n5   363431 acCBJaRqBkSMPYdvaaWCSu\n6   334099 ad3NtS6TDPuKTUKCAyCuby\n7   363349 aEMERWLYQAdhaMKMt5QkD7\n8   307736 aeMJQLo56HWyVHkKX9oaJD\n9   740631 ahYJ7XRUcit8gbFYwaxnAV\n10 1151489 aLqdPLTCZb8jvFkDxcFwzy\n11 1136694 aMteoHisncRUStdyZfsjMB\n12  740623 aoLcmmN8KWG4N6A3XpUiRT\n13  740628 aRJW7SwKsVyZu8b4FighiM\n14  363466 asv7tL6CEYjiW2XCkLxhcX\n15  411469 aswcEAtxj24u9MfuBmS9AW\n16  740630 aThMD6zuEFjtTfptwcpZPg\n17  411388 aTyGBYk6HvRXmki9ksb29p\n18  740624 aUeYzPfq6WED4dDF28VT9D\n19  363381 aWd7wujF5d5HYaYMhT4jBZ\n20  740626 awMnFDna5kWR3LXKyGmFMd\n21  331848 axYbEbLcJxzUNFbqMVySjJ\n22  740629 axyJSgLRDeSk3BHB6cJmYk\n23  408149 ayhCy68ZTaDGc7tuGthQpJ\n24  740627 aYokcZAjTZ9JCyVXz4R5rh\n                                                                     title\n1              PLAY Home Questionaires - 12 Bilingual English (2020-03-04)\n2                                        PLAY_HomeQuestionaires_12_English\n3                                    PLAY Home Questionnaires (24 English)\n4             PLAY Home Questionnaires - 24 Bilingual English (2020-03-04)\n5                       PLAY Home Questionnaires - 12 English (2020-03-04)\n6                        PLAY Home Questionnaires (12 Bilingual - English)\n7                       PLAY Home Questionnaires - 18 English (2020-03-04)\n8                                    PLAY Home Questionnaires (18 English)\n9                              PLAY_HomeQuestionaires_24_Bilingual_English\n10 Clone of Clone of PLAY_HomeQuestionnaires_18_English - NO AUTO METADATA\n11             Clone of PLAY_HomeQuestionnaires_18_English - NO AUTO TODAY\n12                             PLAY_HomeQuestionaires_12_Bilingual_English\n13                                      PLAY_HomeQuestionnaires_18_English\n14            PLAY Home Questionnaires - 18 Bilingual English (2020-03-04)\n15            PLAY Home Questionnaires - 12 Bilingual Spanish (2020-03-04)\n16                             PLAY_HomeQuestionaires_24_Bilingual_Spanish\n17            PLAY Home Questionnaires - 18 Bilingual Spanish (2020-03-04)\n18                             PLAY_HomeQuestionaires_12_Bilingual_Spanish\n19                      PLAY Home Questionnaires - 24 English (2020-03-04)\n20                             PLAY_HomeQuestionaires_18_Bilingual_English\n21                                   PLAY Home Questionnaires (12 English)\n22                                      PLAY_HomeQuestionnaires_24_English\n23            PLAY Home Questionnaires - 24 Bilingual Spanish (2020-03-04)\n24                             PLAY_HomeQuestionaires_18_Bilingual_Spanish\n                                                               description\n1            PLAY Home Questionaires - 12 Bilingual (English) (2020-03-04)\n2                             PLAY_HomeQuestionaires_12_English-2021-07-29\n3                                    PLAY Home Questionnaires (24 English)\n4             PLAY Home Questionnaires - 24 Bilingual English (2019-11-20)\n5                       PLAY Home Questionnaires - 12 English (2019-11-20)\n6                        PLAY Home Questionnaires (12 Bilingual - English)\n7                       PLAY Home Questionnaires - 18 English (2018-11-20)\n8                                    PLAY Home Questionnaires (18 English)\n9                   PLAY_HomeQuestionaires_24_Bilingual_English-2021-07-30\n10 Clone of Clone of PLAY_HomeQuestionnaires_18_English - NO AUTO METADATA\n11                             Clone of PLAY_HomeQuestionnaires_18_English\n12                  PLAY_HomeQuestionaires_12_Bilingual_English-2021-07-29\n13                           PLAY_HomeQuestionnaires_18_English-2021-07-29\n14            PLAY Home Questionnaires - 18 Bilingual English (2019-11-20)\n15            PLAY Home Questionnaires - 12 Bilingual Spanish (2020-03-04)\n16                  PLAY_HomeQuestionaires_24_Bilingual_Spanish-2021-07-30\n17            PLAY Home Questionnaires - 18 Bilingual Spanish (2020-03-04)\n18                  PLAY_HomeQuestionaires_12_Bilingual_Spanish-2021-07-29\n19                      PLAY Home Questionnaires - 24 English (2019-11-20)\n20                  PLAY_HomeQuestionaires_18_Bilingual_English-2021-07-29\n21                                   PLAY Home Questionnaires (12 English)\n22                           PLAY_HomeQuestionnaires_24_English-2021-07-30\n23            PLAY Home Questionnaires - 24 Bilingual Spanish (2020-02-27)\n24                  PLAY_HomeQuestionaires_18_Bilingual_Spanish-2021-07-29\n                                              url\n1   https://kc.kobotoolbox.org/api/v1/data/411456\n2   https://kc.kobotoolbox.org/api/v1/data/740625\n3   https://kc.kobotoolbox.org/api/v1/data/331453\n4   https://kc.kobotoolbox.org/api/v1/data/363465\n5   https://kc.kobotoolbox.org/api/v1/data/363431\n6   https://kc.kobotoolbox.org/api/v1/data/334099\n7   https://kc.kobotoolbox.org/api/v1/data/363349\n8   https://kc.kobotoolbox.org/api/v1/data/307736\n9   https://kc.kobotoolbox.org/api/v1/data/740631\n10 https://kc.kobotoolbox.org/api/v1/data/1151489\n11 https://kc.kobotoolbox.org/api/v1/data/1136694\n12  https://kc.kobotoolbox.org/api/v1/data/740623\n13  https://kc.kobotoolbox.org/api/v1/data/740628\n14  https://kc.kobotoolbox.org/api/v1/data/363466\n15  https://kc.kobotoolbox.org/api/v1/data/411469\n16  https://kc.kobotoolbox.org/api/v1/data/740630\n17  https://kc.kobotoolbox.org/api/v1/data/411388\n18  https://kc.kobotoolbox.org/api/v1/data/740624\n19  https://kc.kobotoolbox.org/api/v1/data/363381\n20  https://kc.kobotoolbox.org/api/v1/data/740626\n21  https://kc.kobotoolbox.org/api/v1/data/331848\n22  https://kc.kobotoolbox.org/api/v1/data/740629\n23  https://kc.kobotoolbox.org/api/v1/data/408149\n24  https://kc.kobotoolbox.org/api/v1/data/740627\n```\n\n\n:::\n:::\n\n\n\n\n\n### Save selected raw files to local directory {-}\n\nPrepare to retrieve all home visit files.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn_files <- dim(kb_home)[1]\n```\n:::\n\n\n\n\n\nThere are $n=$ 24 home visit data files.\n\n```\ntar_target(\n  home_visit_downloads,\n  retrieve_kobo_xlsx(kb_home, \n    \"data/xlsx/home_visit/raw\"),\n  cue = tarchetypes::tar_cue_age(\n    name = home_visit_downloads,\n    age = as.difftime(update_interval, \n      units = update_interval_units)\n  )\n)\n```\n\n### Normalize file names {-}\n\nSome of the form names are inconsistent, so we normalize them to fit the following pattern:\n\n`<form_id>_PLAY_HomeQuestionnaires_<age_group>_<lang_group>.xlsx`\n\n```\ntar_target(\n  home_visit_renamed,\n  rename_home_xlsx(home_visit_downloads,\n                     \"data/xlsx/home_visit/std_name\"),\n  cue = tarchetypes::tar_cue_age(\n    name = home_visit_renamed,\n    age = as.difftime(update_interval, \n      units = update_interval_units)\n  )\n)\n```\n\n### Save xlsx as csv {-}\n\n```\ntar_target(\n  home_visit_xlsx_to_csv,\n  load_xlsx_save_many_csvs_2(home_visit_renamed, \n    \"data/csv/home_visit/raw\")\n)\n```\n\n### Split MB-CDI from other questions {-}\n\nNext we import a CSV for a given form year, age group, and language group, and create two new CSV files: one with the MB-CDI data and one with all of the other survey questions.\n\nBy default, the document presumes that we want to convert **all** of the CSV files\n\nExtract the 'non-mbcdi' questions first and add 'non_mbcdi' to the filename.\n\n```\ntar_target(\n  home_visit_non_mbcdi,\n  split_non_mbcdi_csvs(home_visit_xlsx_to_csv,\n                        \"data/csv/home_visit/non_mbcdi\")\n)\n```\n\nExtracting the MB-CDI data has nearly the same function call, but the `these_questions` parameter is set to 'mbcdi'.\n\n```\ntar_target(\n  home_visit_mbcdi,\n  split_mbcdi_csvs(home_visit_xlsx_to_csv,\n                    \"data/csv/home_visit/mbcdi\")\n)\n```\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}