{
  "hash": "f707b44fb18cdac12fad53f9bc84514d",
  "result": {
    "engine": "knitr",
    "markdown": "# Clean\n\n### Setup {-}\n\nWe source a set of cleaning functions have the `screen_` prefix.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npurrr::walk(list.files(file.path(here::here(), \"R\"), \n                    \"^screen_\", full.names = TRUE), source)\n```\n:::\n\n\n\n\nThere are three CSV files to clean:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(fn <- list.files(\"../data/csv/screening\", \"[Dd]emographic\", full.names = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"../data/csv/screening/275882_PLAY_Demographic_Questionnaire.csv\"        \n[2] \"../data/csv/screening/334134_PLAY_Demographic_Questionnaire_Spanish.csv\"\n[3] \"../data/csv/screening/359546_PLAY_Demographic_Questionnaire.csv\"        \n```\n\n\n:::\n:::\n\n\n\n\nWe clean them separately, as needed, then merge them.\n\n### Clean variable names {-}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 <-\n  readr::read_csv(fn[1],\n                  col_types = readr::cols(.default = 'c'),\n                  show_col_types = FALSE)\ndf2 <-\n  readr::read_csv(fn[2],\n                  col_types = readr::cols(.default = 'c'),\n                  show_col_types = FALSE)\ndf3 <-\n  readr::read_csv(fn[3],\n                  col_types = readr::cols(.default = 'c'),\n                  show_col_types = FALSE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(names(df1), 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"start\"                                                                        \n [2] \"end\"                                                                          \n [3] \"c_today\"                                                                      \n [4] \"play_phone_questionnaire/update_date\"                                         \n [5] \"play_phone_questionnaire/group_contact_info/instructions_contactinfo\"         \n [6] \"play_phone_questionnaire/group_contact_info/parent_phone\"                     \n [7] \"play_phone_questionnaire/group_contact_info/parent_email\"                     \n [8] \"play_phone_questionnaire/group_contact_info/group_address/note_parent_address\"\n [9] \"play_phone_questionnaire/group_contact_info/group_address/parent_address_1\"   \n[10] \"play_phone_questionnaire/group_contact_info/group_address/parent_address_2\"   \n[11] \"play_phone_questionnaire/group_contact_info/group_address/city\"               \n[12] \"play_phone_questionnaire/group_contact_info/group_address/state\"              \n[13] \"play_phone_questionnaire/group_contact_info/acknowledge_contact_info\"         \n[14] \"play_phone_questionnaire/instructions_guid\"                                   \n[15] \"play_phone_questionnaire/child_first_name\"                                    \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(names(df2), 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"start\"                                                                                                                                                                                                                                    \n [2] \"end\"                                                                                                                                                                                                                                      \n [3] \"c_today\"                                                                                                                                                                                                                                  \n [4] \"play_demo_questionnaire/update_date\"                                                                                                                                                                                                      \n [5] \"play_demo_questionnaire/NOTA_El_cuestionario_demogr_fico_debe_ser_completado_por_el_investigador_que_va_a_ir_a_la_visita_al_hogar_con_la_madre_por_tel_fono_La_madre_deber_a_ser_la_madre_que_va_a_participar_en_el_estudio_con_su_ni_o_a\"\n [6] \"play_demo_questionnaire/group_siteinfo/site_id\"                                                                                                                                                                                           \n [7] \"play_demo_questionnaire/group_siteinfo/subject_number\"                                                                                                                                                                                    \n [8] \"play_demo_questionnaire/exp_name\"                                                                                                                                                                                                         \n [9] \"play_demo_questionnaire/group_contact_info/instructions_contactinfo\"                                                                                                                                                                      \n[10] \"play_demo_questionnaire/group_contact_info/parent_phone\"                                                                                                                                                                                  \n[11] \"play_demo_questionnaire/group_contact_info/parent_email\"                                                                                                                                                                                  \n[12] \"play_demo_questionnaire/group_contact_info/group_address/note_parent_address\"                                                                                                                                                             \n[13] \"play_demo_questionnaire/group_contact_info/group_address/parent_address_1\"                                                                                                                                                                \n[14] \"play_demo_questionnaire/group_contact_info/group_address/parent_address_2\"                                                                                                                                                                \n[15] \"play_demo_questionnaire/group_contact_info/group_address/city\"                                                                                                                                                                            \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(names(df3), 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"start\"                                                                       \n [2] \"end\"                                                                         \n [3] \"c_today\"                                                                     \n [4] \"play_demo_questionnaire/update_date\"                                         \n [5] \"play_demo_questionnaire/note_exp\"                                            \n [6] \"play_demo_questionnaire/group_siteinfo/site_id\"                              \n [7] \"play_demo_questionnaire/group_siteinfo/subject_number\"                       \n [8] \"play_demo_questionnaire/group_siteinfo/exp_name\"                             \n [9] \"play_demo_questionnaire/group_contact_info/instructions_contactinfo\"         \n[10] \"play_demo_questionnaire/group_contact_info/parent_phone\"                     \n[11] \"play_demo_questionnaire/group_contact_info/parent_email\"                     \n[12] \"play_demo_questionnaire/group_contact_info/group_address/note_parent_address\"\n[13] \"play_demo_questionnaire/group_contact_info/group_address/parent_address_1\"   \n[14] \"play_demo_questionnaire/group_contact_info/group_address/parent_address_2\"   \n[15] \"play_demo_questionnaire/group_contact_info/group_address/city\"               \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(names(df1), 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"start\"                                                                        \n [2] \"end\"                                                                          \n [3] \"c_today\"                                                                      \n [4] \"play_phone_questionnaire/update_date\"                                         \n [5] \"play_phone_questionnaire/group_contact_info/instructions_contactinfo\"         \n [6] \"play_phone_questionnaire/group_contact_info/parent_phone\"                     \n [7] \"play_phone_questionnaire/group_contact_info/parent_email\"                     \n [8] \"play_phone_questionnaire/group_contact_info/group_address/note_parent_address\"\n [9] \"play_phone_questionnaire/group_contact_info/group_address/parent_address_1\"   \n[10] \"play_phone_questionnaire/group_contact_info/group_address/parent_address_2\"   \n[11] \"play_phone_questionnaire/group_contact_info/group_address/city\"               \n[12] \"play_phone_questionnaire/group_contact_info/group_address/state\"              \n[13] \"play_phone_questionnaire/group_contact_info/acknowledge_contact_info\"         \n[14] \"play_phone_questionnaire/instructions_guid\"                                   \n[15] \"play_phone_questionnaire/child_first_name\"                                    \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(names(df2), 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"start\"                                                                                                                                                                                                                                    \n [2] \"end\"                                                                                                                                                                                                                                      \n [3] \"c_today\"                                                                                                                                                                                                                                  \n [4] \"play_demo_questionnaire/update_date\"                                                                                                                                                                                                      \n [5] \"play_demo_questionnaire/NOTA_El_cuestionario_demogr_fico_debe_ser_completado_por_el_investigador_que_va_a_ir_a_la_visita_al_hogar_con_la_madre_por_tel_fono_La_madre_deber_a_ser_la_madre_que_va_a_participar_en_el_estudio_con_su_ni_o_a\"\n [6] \"play_demo_questionnaire/group_siteinfo/site_id\"                                                                                                                                                                                           \n [7] \"play_demo_questionnaire/group_siteinfo/subject_number\"                                                                                                                                                                                    \n [8] \"play_demo_questionnaire/exp_name\"                                                                                                                                                                                                         \n [9] \"play_demo_questionnaire/group_contact_info/instructions_contactinfo\"                                                                                                                                                                      \n[10] \"play_demo_questionnaire/group_contact_info/parent_phone\"                                                                                                                                                                                  \n[11] \"play_demo_questionnaire/group_contact_info/parent_email\"                                                                                                                                                                                  \n[12] \"play_demo_questionnaire/group_contact_info/group_address/note_parent_address\"                                                                                                                                                             \n[13] \"play_demo_questionnaire/group_contact_info/group_address/parent_address_1\"                                                                                                                                                                \n[14] \"play_demo_questionnaire/group_contact_info/group_address/parent_address_2\"                                                                                                                                                                \n[15] \"play_demo_questionnaire/group_contact_info/group_address/city\"                                                                                                                                                                            \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(names(df3), 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"start\"                                                                       \n [2] \"end\"                                                                         \n [3] \"c_today\"                                                                     \n [4] \"play_demo_questionnaire/update_date\"                                         \n [5] \"play_demo_questionnaire/note_exp\"                                            \n [6] \"play_demo_questionnaire/group_siteinfo/site_id\"                              \n [7] \"play_demo_questionnaire/group_siteinfo/subject_number\"                       \n [8] \"play_demo_questionnaire/group_siteinfo/exp_name\"                             \n [9] \"play_demo_questionnaire/group_contact_info/instructions_contactinfo\"         \n[10] \"play_demo_questionnaire/group_contact_info/parent_phone\"                     \n[11] \"play_demo_questionnaire/group_contact_info/parent_email\"                     \n[12] \"play_demo_questionnaire/group_contact_info/group_address/note_parent_address\"\n[13] \"play_demo_questionnaire/group_contact_info/group_address/parent_address_1\"   \n[14] \"play_demo_questionnaire/group_contact_info/group_address/parent_address_2\"   \n[15] \"play_demo_questionnaire/group_contact_info/group_address/city\"               \n```\n\n\n:::\n:::\n\n\n\n\n<!-- There are a separate set of variable-by-variable cleaning functions in `R/screen_clean_utils.R`. -->\n\nWe remove the unneeded 'play_demo_*' and 'play_phone_questionnaire_' variable headers using `screen_remove_variable_headers()`.\n\nWe next add Census FIPS codes for the home state and county so that we can link with county-level Census data at a later date.\nThis depends on address, city, and state information.\n\n::: {.callout-note}\nThe Census queries stopped working around 2023-06-16, but should be restored as of 2024-09-13, using `R/screen_add_fips.R`.\n\nIt would be more efficient to query the Census geocoding database once.\n:::\n\nWe have name and address information in the screening data (e.g., '..parent_phone', '..parent_email', etc.).\nWe remove this and other identifiable information using `screen_remove_identifiers()`.\n\nWe remove fields that contain administrative metadata with `screen_remove_metadata_fields()`.\n\nWe remove fields used only by staff in uploading data to Databrary using `screen_remove_databrary_fields()`.\n\nThen, we use `dplyr::full_join()` to combine the set of individually \ncleaned data files.\nThe `screen_clean_raw_csv()` function combines the previous `screen_remove*` functions.\nThe `screen_clean_raw_join()` function cleans each CSV then joins them.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(scr_df <- screen_clean_raw_join())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/275882_PLAY_Demographic_Questionnaire.csv'.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: stringr\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nPassing 8 addresses to the US Census batch geocoder\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nQuery completed in: 1.1 seconds\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRemoved n = 31 of 172 columns.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: dplyr\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/334134_PLAY_Demographic_Questionnaire_Spanish.csv'.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nPassing 8 addresses to the US Census batch geocoder\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nQuery completed in: 0.9 seconds\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRemoved n = 47 of 240 columns.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/359546_PLAY_Demographic_Questionnaire.csv'.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nPassing 942 addresses to the US Census batch geocoder\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nQuery completed in: 35.1 seconds\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRemoved n = 47 of 243 columns.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(start, end, c_today, update_date, site_id,\nsubject_number, state, check_childage, check_childage_weeks, child_sex, day,\nday2, day1, play_id, language_spoken_mom, `language_spoken_mom/english`,\n`language_spoken_mom/spanish`, `language_spoken_mom/other`,\nlanguage_spoken_mom_other, language_spoken_child,\n`language_spoken_child/english`, `language_spoken_child/spanish`,\n`language_spoken_child/other`, language_spoken_child_other,\nlanguage_spoken_house, `language_spoken_house/english`,\n`language_spoken_house/spanish`, `language_spoken_house/other`,\nlanguage_spoken_house_other, `child_information/child_bornonduedate`,\n`child_information/child_onterm`, `child_information/child_duedate`,\n`child_information/child_birthage`, `child_information/child_weight_pounds`,\n`child_information/child_weight_ounces`,\n`child_information/child_birth_complications`,\n`child_information/specify_birth_complications`,\n`child_information/hearing_disabilities`, `child_information/specify_hearing`,\n`child_information/vision_disabilities`, `child_information/specify_vision`,\n`child_information/major_illnesses_injuries`,\n`child_information/specify_illnesses_injuries`,\n`child_information/other_developmentaldelays`,\n`child_information/specify_developmentaldelays`,\n`child_information/child_race`, `child_information/child_sleep_time`,\n`child_information/child_wake_time`, `child_information/child_nap_hours`,\n`child_information/child_sleep_location`,\n`child_information/specify_child_sleep_location`,\n`child_information/indicate_child`, `child_information/indicate_child_2`,\n`group_family_structure/only_child`,\n`group_family_structure/specify_onlychild`,\n`group_family_structure/household_members`,\n`group_family_structure/household_members/father_biological`,\n`group_family_structure/household_members/male_partner`,\n`group_family_structure/household_members/mother_biological`,\n`group_family_structure/household_members/female_partner`,\n`group_family_structure/household_members/other_partner`,\n`group_family_structure/household_members/sibling_biological`,\n`group_family_structure/household_members/sibling_nonbiological`,\n`group_family_structure/household_members/grandmother`,\n`group_family_structure/household_members/grandfather`,\n`group_family_structure/household_members/great_grandmother`,\n`group_family_structure/household_members/great_grandfather`,\n`group_family_structure/household_members/aunt`,\n`group_family_structure/household_members/uncle`,\n`group_family_structure/household_members/cousin`,\n`group_family_structure/household_members/relative`,\n`group_family_structure/household_members/non_relative`,\n`group_family_structure/household_members/none`,\n`group_family_structure/other_relatives`,\n`group_family_structure/other_non_relatives`,\n`group_family_structure/indicate_familystructure`,\n`group_mominfo/mom_biological`, `group_mominfo/mom_relation`,\n`group_mominfo/mom_datecare`, `group_mominfo/mom_childbirth_age`,\n`group_mominfo/check_mom_childbirth_age`, `group_mominfo/mom_race`,\n`group_mominfo/mom_birth_country`, `group_mominfo/specify_mom_birth_country`,\n`group_mominfo/mom_education`, `group_mominfo/mom_employment`,\n`group_mominfo/mom_occupation`, `group_mominfo/mom_jobs_number`,\n`group_mominfo/mom_training`, `group_mominfo/mom_condition`,\n`group_mominfo/specify_mom_condition`, `group_mominfo/indicate_mom`,\n`group_biodad/biodad_childbirth_age`,\n`group_biodad/check_biodad_childbirth_age`, `group_biodad/biodad_race`,\n`group_biodad/indicate_biodad`, `group_biomom/biomom_childbirth_age`,\n`group_biomom/check_biomom_childbirth_age`, `group_biomom/biomom_race`,\n`group_biomom/indicate_biomom`, `group_nonbiopartner/nonbiopartner_race`,\n`group_nonbiopartner/indicate_nonbiopartner`,\n`group_genpartner_info/partner_education`,\n`group_genpartner_info/partner_employment`,\n`group_genpartner_info/partner_occupation`,\n`group_genpartner_info/partner_jobs_number`,\n`group_genpartner_info/partner_program`,\n`group_genpartner_info/indicate_genpartner`,\n`group_child_care_arrangements/childcare_types`,\n`group_child_care_arrangements/childcare_types/nanny_home`,\n`group_child_care_arrangements/childcare_types/nanny_nothome`,\n`group_child_care_arrangements/childcare_types/relative`,\n`group_child_care_arrangements/childcare_types/childcare`,\n`group_child_care_arrangements/childcare_types/none`,\n`group_child_care_arrangements/childcare_location`,\n`group_child_care_arrangements/childcare_hours`,\n`group_child_care_arrangements/childcare_number`,\n`group_child_care_arrangements/childcare_age`,\n`group_child_care_arrangements/childcare_language`,\n`group_inclusioncheck/inclusionreason`,\n`group_inclusioncheck/indicate_inclusion`, indicate_demoquestionnaire,\nindicate_databrary, `_id`, state_fips, county_fips, fips_state, fips_county)`\nJoining with `by = join_by(start, end, c_today, update_date, site_id,\nsubject_number, state, check_childage, check_childage_weeks, child_sex, day,\nday2, day1, language_spoken_child, `language_spoken_child/english`,\n`language_spoken_child/spanish`, `language_spoken_child/other`,\nlanguage_spoken_child_other, `child_information/child_bornonduedate`,\n`child_information/child_onterm`, `child_information/child_duedate`,\n`child_information/child_birthage`, `child_information/child_weight_pounds`,\n`child_information/child_weight_ounces`,\n`child_information/child_birth_complications`,\n`child_information/specify_birth_complications`,\n`child_information/hearing_disabilities`, `child_information/specify_hearing`,\n`child_information/vision_disabilities`, `child_information/specify_vision`,\n`child_information/major_illnesses_injuries`,\n`child_information/specify_illnesses_injuries`,\n`child_information/child_sleep_time`, `child_information/child_wake_time`,\n`child_information/child_nap_hours`, `child_information/child_sleep_location`,\n`child_information/specify_child_sleep_location`,\n`child_information/indicate_child`, `child_information/indicate_child_2`,\n`group_family_structure/household_members`,\n`group_family_structure/household_members/male_partner`,\n`group_family_structure/household_members/female_partner`,\n`group_family_structure/household_members/other_partner`,\n`group_family_structure/household_members/grandmother`,\n`group_family_structure/household_members/grandfather`,\n`group_family_structure/household_members/great_grandmother`,\n`group_family_structure/household_members/great_grandfather`,\n`group_family_structure/household_members/aunt`,\n`group_family_structure/household_members/uncle`,\n`group_family_structure/household_members/cousin`,\n`group_family_structure/household_members/relative`,\n`group_family_structure/household_members/non_relative`,\n`group_family_structure/other_relatives`,\n`group_family_structure/other_non_relatives`,\n`group_family_structure/indicate_familystructure`,\n`group_child_care_arrangements/childcare_types`,\n`group_child_care_arrangements/childcare_types/relative`,\n`group_child_care_arrangements/childcare_types/childcare`,\n`group_child_care_arrangements/childcare_types/none`,\n`group_child_care_arrangements/childcare_hours`,\n`group_child_care_arrangements/childcare_number`,\n`group_child_care_arrangements/childcare_age`,\n`group_child_care_arrangements/childcare_language`, `_id`, state_fips,\ncounty_fips, fips_state, fips_county)`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 974 × 166\n   start   end   c_today update_date site_id subject_number state check_childage\n   <chr>   <chr> <chr>   <chr>       <chr>   <chr>          <chr> <chr>         \n 1 2020-0… 2020… 2020-0… <NA>        NYUNI   230            New … 32.6772408503…\n 2 2020-0… 2020… 2020-0… <NA>        NYUNI   229            New … 32.3813828621…\n 3 2019-1… 2020… 2020-0… <NA>        VCOMU   002            VA    26.7258382642…\n 4 2020-0… 2020… 2020-0… <NA>        GEORG   010            Virg… 12.7547666009…\n 5 2020-0… 2020… 2020-0… <NA>        NYUNI   008            New … 13.4122287968…\n 6 2020-0… 2020… 2020-0… <NA>        NYUNI   009            New … 19.3636313828…\n 7 2020-0… 2020… 2020-0… <NA>        GEORG   011            Virg… 17.8514683322…\n 8 2020-0… 2020… 2020-0… <NA>        NYUNI   010            NY    17.8514683322…\n 9 2020-0… 2020… 2020-0… <NA>        NYUNI   011            New … 23.8001314924…\n10 2020-0… 2020… 2020-0… <NA>        VCOMU   003            VA    17.5884834538…\n# ℹ 964 more rows\n# ℹ 158 more variables: check_childage_weeks <chr>, child_sex <chr>, day <chr>,\n#   day2 <chr>, day1 <chr>, play_id <chr>, language_spoken_mom <chr>,\n#   `language_spoken_mom/english` <chr>, `language_spoken_mom/spanish` <chr>,\n#   `language_spoken_mom/other` <chr>, language_spoken_mom_other <chr>,\n#   language_spoken_child <chr>, `language_spoken_child/english` <chr>,\n#   `language_spoken_child/spanish` <chr>, …\n```\n\n\n:::\n:::\n\n\n\n\n### Clean individual fields {-}\n\nNow, we can proceed to clean-up the merged data frame.\nThe sequence of functions called below cleans 'construct-specific' variables\nas indicated by the function names.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscr_df <- scr_df |> \n    screen_clean_child_info() |>\n    screen_clean_lang_info() |>\n    screen_clean_mom_info() |>\n    screen_clean_biodad_father_info() |>\n    screen_clean_childcare_info() |>\n    screen_clean_family_structure() |>\n    screen_clean_play_id() |>\n    screen_remove_selected_cols() |>\n    screen_select_reorder_cols()\n```\n:::\n\n\n\n\nFor convenience, we package this sequence in its own function, `screen_clean_fields()`.\n\n::: {.callout-note}\n\nNote that all of the variables are considered character strings. The `tidyverse`\nsuite does a great job of guessing what variables are what, but sometimes it\nguesses wrongly. So, in preliminary stages, it has proved easier to make everything\na character string.\n\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscr_df <- screen_clean_fields(scr_df)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: tidyr\n```\n\n\n:::\n\n```{.r .cell-code}\nstr(scr_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [974 × 51] (S3: tbl_df/tbl/data.frame)\n $ submit_date                       : chr [1:974] \"2020-02-27T08:24:10.551-05:00\" \"2020-02-27T08:43:34.275-05:00\" \"2019-12-18T16:37:17.554-05:00\" \"2020-01-01T12:54:04.550-05:00\" ...\n $ site_id                           : chr [1:974] \"NYUNI\" \"NYUNI\" \"VCOMU\" \"GEORG\" ...\n $ participant_ID                    : chr [1:974] \"230\" \"229\" \"002\" \"010\" ...\n $ play_id                           : chr [1:974] NA NA NA NA ...\n $ child_age_mos                     : chr [1:974] \"32.677240850317695\" \"32.38138286215201\" \"26.725838264299803\" \"12.754766600920446\" ...\n $ child_sex                         : chr [1:974] \"male\" \"female\" \"female\" \"male\" ...\n $ child_bornonduedate               : chr [1:974] \"yes\" \"yes\" \"yes\" \"yes\" ...\n $ child_onterm                      : chr [1:974] NA NA NA NA ...\n $ child_birthage                    : chr [1:974] \"-7\" \"-10\" \"0\" \"1\" ...\n $ child_weight_pounds               : chr [1:974] \"8\" \"7\" \"6\" \"7\" ...\n $ child_weight_ounces               : chr [1:974] \"12\" \"10\" \"12\" \"15\" ...\n $ child_birth_complications         : chr [1:974] \"no\" \"no\" \"no\" \"no\" ...\n $ child_birth_complications_specify : chr [1:974] NA NA NA NA ...\n $ child_hearing_disabilities        : chr [1:974] \"yes\" \"no\" \"no\" \"no\" ...\n $ child_hearing_disabilities_specify: chr [1:974] \"Temporary hearing loss so tubes in his ears, one still remaining\" NA NA NA ...\n $ child_vision_disabilities         : chr [1:974] \"no\" \"no\" \"no\" \"no\" ...\n $ child_vision_disabilities_specify : chr [1:974] NA NA NA NA ...\n $ child_major_illnesses_injuries    : chr [1:974] \"yes\" \"no\" \"no\" \"no\" ...\n $ child_illnesses_injuries_specify  : chr [1:974] \"Pneumonia at 5 months\" \"\" \"\" \"\" ...\n $ child_developmentaldelays         : chr [1:974] NA NA NA NA ...\n $ child_developmentaldelays_specify : chr [1:974] NA NA NA NA ...\n $ child_sleep_time                  : chr [1:974] \"20:15:00.000-05:00\" \"20:15:00.000-05:00\" \"19:00:00.000-05:00\" \"19:00:00.000-05:00\" ...\n $ child_wake_time                   : chr [1:974] \"07:15:00.000-05:00\" \"06:45:00.000-05:00\" \"07:30:00.000-05:00\" \"06:15:00.000-05:00\" ...\n $ child_nap_hours                   : chr [1:974] \"2\" \"3\" \"1.5\" \"2\" ...\n $ child_sleep_location              : chr [1:974] \"crib_separate\" \"crib_separate\" \"crib_separate\" \"crib_separate\" ...\n $ mom_bio                           : chr [1:974] \"yes\" \"yes\" \"yes\" \"yes\" ...\n $ mom_childbirth_age                : chr [1:974] \"33.41\" \"38.84\" \"32.2\" \"30.38\" ...\n $ mom_race                          : chr [1:974] \"white\" \"white\" \"white\" \"white\" ...\n $ mom_birth_country                 : chr [1:974] \"unitedstates\" \"unitedstates\" \"unitedstates\" \"unitedstates\" ...\n $ mom_birth_country_specify         : chr [1:974] \"\" \"\" \"\" \"\" ...\n $ mom_education                     : chr [1:974] \"masters\" \"doctorate\" \"doctorate\" \"masters\" ...\n $ mom_employment                    : chr [1:974] \"full_time\" \"full_time\" \"full_time\" \"full_time\" ...\n $ mom_occupation                    : chr [1:974] \"Architect\" \"Spanish teacher\" \"Nurse instructor\" \"School Psychologist\" ...\n $ mom_jobs_number                   : chr [1:974] \"1\" \"1\" \"1\" \"1\" ...\n $ mom_training                      : chr [1:974] \"no\" \"no\" \"no\" \"no\" ...\n $ biodad_childbirth_age             : chr [1:974] \"33.85_NA\" \"30.42_NA\" \"37.32_NA\" \"30.53_NA\" ...\n $ biodad_race                       : chr [1:974] \"white_NA\" \"white_NA\" \"NA_NA\" \"NA_NA\" ...\n $ language_spoken_mom               : chr [1:974] \"english\" \"english spanish\" \"english\" \"english\" ...\n $ language_spoken_mom_comments      : chr [1:974] NA NA NA NA ...\n $ language_spoken_child             : chr [1:974] \"english\" \"spanish\" \"english\" \"english\" ...\n $ language_spoken_home_comments     : chr [1:974] \"FALSE_47706996\" \"TRUE_47707423\" \"FALSE_43397823\" \"FALSE_44074192\" ...\n $ language_spoken_child_comments    : chr [1:974] NA NA NA NA ...\n $ language_spoken_home              : chr [1:974] \"english\" \"english spanish\" \"english\" \"english\" ...\n $ language_spoken_house_other       : chr [1:974] NA NA NA NA ...\n $ language_spoken_home_other        : chr [1:974] NA NA NA NA ...\n $ childcare_types                   : chr [1:974] NA NA NA NA ...\n $ childcare_location                : chr [1:974] NA NA NA NA ...\n $ childcare_hours                   : chr [1:974] NA NA NA NA ...\n $ childcare_number                  : chr [1:974] NA NA NA NA ...\n $ childcare_age                     : chr [1:974] NA NA NA NA ...\n $ childcare_language                : chr [1:974] NA NA NA NA ...\n```\n\n\n:::\n:::\n\n\n\n\nThere is more work to do, but we have a version worth exporting.\n\n## Merge {-}\n\nLet's add the Databrary volume ID info.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscr_df <- scr_df |>\n  screen_add_db_vol_id()\n```\n:::\n\n\n\n\nThen filter out rows that do not have valid volume IDs.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvalid_db_vol <- !is.na(scr_df$vol_id)\n\nscr_df <- scr_df[valid_db_vol,]\n```\n:::\n\n\n\n\nThere are *n=*970 valid Databrary volume IDs out of a total of *n*=974 screening records.\n\nNext, we add a `play_status` field based on the `group-name` field from Databrary.\nWe use `group-name` for indicating \"Gold\", \"Silver\", or \"Not run.\"\n\nTwo targets in `_targets.R` are relevant for this operation:\n\n```\n  tar_target(\n    play_vols_df,\n    readr::read_csv(\"data/csv/_meta/play_site_vols.csv\",\n                    show_col_types = FALSE)\n  ),\n  tar_target(\n    databrary_session_csvs,\n    purrr::map(play_vols_df$site_id, databrary_get_save_session_csv),\n    cue = tarchetypes::tar_cue_age(\n      name = databrary_session_csvs,\n      age = as.difftime(update_interval, units = update_interval_units)\n    )\n  )\n\n```\n\nThese targets generate site-specific CSVs in `data/csv/site_sessions` based on the database of PLAY sites contained in `data/csv/_meta/play_site_vols.csv`.\nWe load these CSVs into a single data frame.\n\n### Load site session data {-}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsession_fns <-\n  list.files(\"../data/csv/site_sessions\", \"\\\\.csv$\", full.names = TRUE)\n\ndf_sessions <-\n  purrr::map(\n    session_fns,\n    readr::read_csv,\n    col_types = readr::cols(.default = 'c'),\n    show_col_types = FALSE\n  ) |>\n  purrr::list_rbind()\n```\n:::\n\n\n\n\nThe `group_name` variable contains status information about the sessions.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxtabs(~ group_name, data=df_sessions)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ngroup_name\n   No visit    No_visit    No_Visit   PLAY_Gold PLAY_Silver \n          1          46          88         684         114 \n```\n\n\n:::\n:::\n\n\n\n\nWe note that there are three different versions of no visit: \"No visit\", \"No_visit\", and \"No_Visit\". \nIn addition, there are *n*=29 sessions with NA in the `group_name`.\n\nLet's modify those values that specify no visit on one of these forms to conform with one another.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_sessions <- df_sessions |>\n  dplyr::mutate(group_name = stringr::str_replace(group_name, \"No.*isit\", \"No_visit\"))\n```\n:::\n\n\n\n\nThese could be sessions that are still in QA or which are scheduled, or there could be some other anomaly.\nHere, we want to select only those sessions that occurred and which have passed QA--those sessions for which `group_name` is either 'PLAY_Gold' or 'PLAY_Silver'.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_sessions <- df_sessions |>\n  dplyr::filter(stringr::str_detect(group_name, \"PLAY_\"))\n```\n:::\n\n\n\n\n### Sharing by session status {-}\n\nHere is information about the sharing status.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxtabs(~ group_name + session_release, df_sessions)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             session_release\ngroup_name    EXCERPTS PRIVATE SHARED\n  PLAY_Gold        538       0    146\n  PLAY_Silver       82       4     28\n```\n\n\n:::\n:::\n\n\n\n\nThere was one session marked `PRIVATE`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_sessions |>\n  dplyr::filter(session_release == \"PRIVATE\") |>\n  dplyr::select(vol_id, session_id, session_name, group_name)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n  vol_id session_id session_name   group_name \n  <chr>  <chr>      <chr>          <chr>      \n1 1656   70116      PLAY_ASUNI_001 PLAY_Silver\n2 979    66932      PLAY_PRINU_024 PLAY_Silver\n3 1397   70234      PLAY_UHOUS_035 PLAY_Silver\n4 1422   72657      PLAY_UIOWA_025 PLAY_Silver\n```\n\n\n:::\n:::\n\n\n\n\nNow, we join the screening data with the Databrary session data.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscreen_datab_df <- dplyr::left_join(df_sessions, scr_df, by = c('vol_id', 'participant_ID'))\n```\n:::\n\n\n\n\nLet's do some additional cleaning of redundant column names, e.g., exclusion.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscreen_datab_df <- screen_datab_df |>\n  tidyr::unite(exclusion_reason, c(\"exclusion1_reason\", \"exclusion2_reason\", \"exclusion_reason\")) |>\n  dplyr::mutate(exclusion_reason = stringr::str_remove_all(exclusion_reason, \"NA|_\"))\n```\n:::\n\n\n\n\n## Export cleaned file {-}\n\nWe date-stamp the exported file so we can monitor progress as this workflow develops.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsfn <- paste0(\"PLAY-screening-datab-\", Sys.Date(), \".csv\")\nreadr::write_csv(screen_datab_df, file.path(here::here(), \"data/csv/screening/agg/\", sfn))\n```\n:::\n\n\n\n\nWe also save a copy with \"latest\".\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsfn <- \"PLAY-screening-datab-latest.csv\"\nreadr::write_csv(screen_datab_df, file.path(here::here(), \"data/csv/screening/agg/\", sfn))\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}