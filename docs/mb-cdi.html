<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MB-CDI | PLAY Project: Surveys</title>
<meta name="author" content="Rick Gilmore">
<meta name="description" content="Purpose This page documents the cleaning and merging procedures related to the MB-CDI data. The home visit workflow strips these files into their own set of CSVs under data/csv/home_visit/mbcdi....">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="MB-CDI | PLAY Project: Surveys">
<meta property="og:type" content="book">
<meta property="og:description" content="Purpose This page documents the cleaning and merging procedures related to the MB-CDI data. The home visit workflow strips these files into their own set of CSVs under data/csv/home_visit/mbcdi....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MB-CDI | PLAY Project: Surveys">
<meta name="twitter:description" content="Purpose This page documents the cleaning and merging procedures related to the MB-CDI data. The home visit workflow strips these files into their own set of CSVs under data/csv/home_visit/mbcdi....">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="include/css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">PLAY Project: Surveys</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li class="book-part">Tools and Processes</li>
<li><a class="" href="setup.html">Setup</a></li>
<li class="book-part">Data Wrangling</li>
<li><a class="" href="screening-call.html">Screening call</a></li>
<li><a class="" href="home-visit.html">Home visit</a></li>
<li><a class="" href="qa-for-merging.html">QA for merging</a></li>
<li><a class="active" href="mb-cdi.html">MB-CDI</a></li>
<li><a class="" href="post-visit-notes.html">Post-visit notes</a></li>
<li><a class="" href="data-dictionary.html">Data dictionary</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="screening-visualizations.html">Screening visualizations</a></li>
<li><a class="" href="demographics-visualizations.html">Demographics visualizations</a></li>
<li><a class="" href="language-visualizations.html">Language visualizations</a></li>
<li><a class="" href="locomotion-visualizations.html">Locomotion visualizations</a></li>
<li><a class="" href="health-visualizations.html">Health visualizations</a></li>
<li><a class="" href="temperament-visualizations.html">Temperament visualizations</a></li>
<li><a class="" href="post-visit-data.html">Post-visit data</a></li>
<li class="book-part">Project Monitoring</li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PLAY-behaviorome/KoBoToolbox">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mb-cdi" class="section level1 unnumbered">
<h1>MB-CDI<a class="anchor" aria-label="anchor" href="#mb-cdi"><i class="fas fa-link"></i></a>
</h1>
<div id="purpose-2" class="section level2 unnumbered">
<h2>Purpose<a class="anchor" aria-label="anchor" href="#purpose-2"><i class="fas fa-link"></i></a>
</h2>
<p>This page documents the cleaning and merging procedures related to the MB-CDI data.
The home visit workflow strips these files into their own set of CSVs under <code>data/csv/home_visit/mbcdi</code>.</p>
<p>The aggregate (across language group and age) data files are saved under <code>data/csv/agg</code>.</p>
</div>
<div id="preparation" class="section level2 unnumbered">
<h2>Preparation<a class="anchor" aria-label="anchor" href="#preparation"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"R"</span>, <span class="st">"_OLD"</span>, <span class="st">"functions.R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">walk</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"R"</span><span class="op">)</span>, <span class="st">"\\.R$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">source</span><span class="op">)</span></span></code></pre></div>
<p>Letâ€™s investigate the number of files, records, and variables per file.</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mbcdi_fns</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"csv"</span>, <span class="st">"home_visit"</span>, <span class="st">"mbcdi"</span><span class="op">)</span>, <span class="st">"\\.csv$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mbcdi_fns</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 25</code></pre>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_datafile_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">csv</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/scalar.html">is.string</a></span><span class="op">(</span><span class="va">csv</span><span class="op">)</span></span>
<span>  <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assertions-file.html">is.readable</a></span><span class="op">(</span><span class="va">csv</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">csv</span>,</span>
<span>                    col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                    show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>fn <span class="op">=</span> <span class="va">csv</span>,</span>
<span>             age_group <span class="op">=</span> <span class="fu">extract_age_group_from_name</span><span class="op">(</span><span class="va">csv</span><span class="op">)</span>,</span>
<span>             lang_cond <span class="op">=</span> <span class="fu">form_language</span><span class="op">(</span><span class="va">csv</span><span class="op">)</span>,</span>
<span>             n_subs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>             n_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mbcdi_file_dat</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">mbcdi_fns</span>, <span class="va">make_datafile_summary</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mbcdi_file_dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="va">lang_cond</span>, <span class="va">n_subs</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">'html'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html">kable_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:left;">
fn
</th>
<th style="text-align:left;">
age_group
</th>
<th style="text-align:left;">
lang_cond
</th>
<th style="text-align:right;">
n_subs
</th>
<th style="text-align:right;">
n_vars
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/334099_mbcdi_12_bilingual_english.csv
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
bilingual_english
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
730
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/411456_mbcdi_12_bilingual_english.csv
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
bilingual_english
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
717
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740623_mbcdi_12_bilingual_english.csv
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
bilingual_english
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
712
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/411469_mbcdi_12_bilingual_spanish.csv
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
bilingual_spanish
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
717
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740624_mbcdi_12_bilingual_spanish.csv
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
bilingual_spanish
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
712
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/331848_mbcdi_12_english.csv
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
256
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/363431_mbcdi_12_english.csv
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
255
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740625_mbcdi_12_english.csv
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
172
</td>
<td style="text-align:right;">
259
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/363466_mbcdi_18_bilingual_english.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
bilingual_english
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
815
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740626_mbcdi_18_bilingual_english.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
bilingual_english
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
829
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/411388_mbcdi_18_bilingual_spanish.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
bilingual_spanish
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
815
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740627_mbcdi_18_bilingual_spanish.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
bilingual_spanish
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
829
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/1136694_mbcdi_18_english.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
359
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/1151489_mbcdi_18_english.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
359
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/307736_mbcdi_18_english.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
352
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/363349_mbcdi_18_english.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
352
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740628_mbcdi_18_english.csv
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
157
</td>
<td style="text-align:right;">
358
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/363465_mbcdi_24_bilingual_english.csv
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
bilingual_english
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
815
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740631_mbcdi_24_bilingual_english.csv
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
bilingual_english
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
829
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/408149_mbcdi_24_bilingual_spanish.csv
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
bilingual_spanish
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
815
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740630_mbcdi_24_bilingual_spanish.csv
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
bilingual_spanish
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
829
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740631_mbcdi_24_bilingual_spanish.csv
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
bilingual_spanish
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
830
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/331453_mbcdi_24_english.csv
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
352
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/363381_mbcdi_24_english.csv
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
352
</td>
</tr>
<tr>
<td style="text-align:left;">
/Users/rog1/rrr/KoBoToolbox/data/csv/home_visit/mbcdi/740629_mbcdi_24_english.csv
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
english
</td>
<td style="text-align:right;">
133
</td>
<td style="text-align:right;">
358
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="mo-old-english-speakers" class="section level2 unnumbered">
<h2>12-mo-old English speakers<a class="anchor" aria-label="anchor" href="#mo-old-english-speakers"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12_files</span> <span class="op">&lt;-</span> <span class="va">mbcdi_file_dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">'12'</span>, <span class="va">lang_cond</span> <span class="op">==</span> <span class="st">'english'</span>, <span class="va">n_subs</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12_combined_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">eng_12_files</span><span class="op">$</span><span class="va">fn</span>, <span class="va">mcdi_clean_12_csv</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"csv"</span>, <span class="st">"home_visit"</span>, <span class="st">"agg"</span>, <span class="st">"mcdi_english_12_combined.csv"</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">eng_12_combined_df</span>, <span class="va">eng_12_fn</span><span class="op">)</span></span></code></pre></div>
<p>There are <span class="math inline">\(n=\)</span> 186 participant records.</p>
</div>
<div id="mo-old-english-speakers-1" class="section level2 unnumbered">
<h2>18-mo-old English speakers<a class="anchor" aria-label="anchor" href="#mo-old-english-speakers-1"><i class="fas fa-link"></i></a>
</h2>
<div class="rmdnote">
<p>This code should be wrapped in functions since many of the components duplicate one another.</p>
</div>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_18_files</span> <span class="op">&lt;-</span> <span class="va">mbcdi_file_dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">'18'</span>, <span class="va">lang_cond</span> <span class="op">==</span> <span class="st">'english'</span>, <span class="va">n_subs</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_18_combined_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">eng_18_files</span><span class="op">$</span><span class="va">fn</span>, <span class="va">mcdi_clean_18_24_csv</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_18_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"csv"</span>, <span class="st">"home_visit"</span>, <span class="st">"agg"</span>, <span class="st">"mcdi_english_18_combined.csv"</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">eng_18_combined_df</span>, <span class="va">eng_18_fn</span><span class="op">)</span></span></code></pre></div>
<p>There are <span class="math inline">\(n=\)</span> 170 participant records.</p>
</div>
<div id="mo-old-english-speakers-2" class="section level2 unnumbered">
<h2>24-mo-old English speakers<a class="anchor" aria-label="anchor" href="#mo-old-english-speakers-2"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_24_files</span> <span class="op">&lt;-</span> <span class="va">mbcdi_file_dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">'24'</span>, <span class="va">lang_cond</span> <span class="op">==</span> <span class="st">'english'</span>, <span class="va">n_subs</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_24_combined_df</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">eng_24_files</span><span class="op">$</span><span class="va">fn</span>, <span class="va">mcdi_clean_18_24_csv</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_24_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"csv"</span>, <span class="st">"home_visit"</span>, <span class="st">"agg"</span>, <span class="st">"mcdi_english_24_combined.csv"</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">eng_24_combined_df</span>, <span class="va">eng_24_fn</span><span class="op">)</span></span></code></pre></div>
<p>There are <span class="math inline">\(n=\)</span> 170 participant records.</p>
</div>
<div id="old-code" class="section level2 unnumbered">
<h2>Old code<a class="anchor" aria-label="anchor" href="#old-code"><i class="fas fa-link"></i></a>
</h2>
<div class="rmdnote">
<p>The following code is deprecated as of 2023-10-25, and is <em>not</em> run.</p>
</div>
<p>For simplicity, weâ€™ll start with the youngest age group, and with the English speakers.
There are <span class="math inline">\(n=3\)</span> forms, with 4, 10, and 111 participants each, and 254, 253, and 257 variables.</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12_files</span> <span class="op">&lt;-</span> <span class="va">mbcdi_file_dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">'12'</span>, <span class="va">lang_cond</span> <span class="op">==</span> <span class="st">'english'</span>, <span class="va">n_subs</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Weâ€™ll examine the first one.</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12_331</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">eng_12_files</span><span class="op">$</span><span class="va">fn</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                    col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                    show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">eng_12_331</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Letâ€™s try trimming the metadata labels.</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12_331_trim_names</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">eng_12_331</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eng_12_331_trim_names</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>That looks better.
Letâ€™s look at the second file.</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12_363</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">eng_12_files</span><span class="op">$</span><span class="va">fn</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                    col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                    show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">eng_12_363</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>And the third one.</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12_740625</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">eng_12_files</span><span class="op">$</span><span class="va">fn</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                    col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                    show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">eng_12_740625</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, weâ€™ll create a function to clean the variable names.</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">select_basename</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/scalar.html">is.string</a></span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span></span>
<span>  <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assertions-file.html">is.readable</a></span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">csv_fn</span>,</span>
<span>                    col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                    show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">select_basename</span><span class="op">(</span><span class="va">eng_12_files</span><span class="op">$</span><span class="va">fn</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Letâ€™s trim unneeded fields.
Weâ€™ll write several helper functions to do this.</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trim_cdi_fields</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"note"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"instructions"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"comments"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"continue"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"vocab"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"mcdi"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">add_particip_index</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>play_i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">make_cdi_longer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="va">n_vars</span>,</span>
<span>                        names_to <span class="op">=</span> <span class="st">"word"</span>,</span>
<span>                        values_to <span class="op">=</span> <span class="st">"understands_or_says"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">understands_or_says</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>understands_or_says <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">understands_or_says</span>, <span class="st">"understands___"</span>, <span class="st">"says"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      understands_or_says <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">understands_or_says</span>, <span class="st">"understands_says"</span>, <span class="st">"says"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"mommy_001"</span>, <span class="st">"mommy"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"bath_001"</span>, <span class="st">"bath"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then we combine them into an omnibus function.</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clean_cdi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">select_basename</span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">trim_cdi_fields</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"play_id"</span> <span class="op">=</span> <span class="st">"participant_id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">make_cdi_longer</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">add_particip_index</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, we can run <code>clean_cdi()</code> across all three files.</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_12</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">eng_12_files</span><span class="op">$</span><span class="va">fn</span>, <span class="va">clean_cdi</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">word</span> <span class="op">+</span> <span class="va">understands_or_says</span>, <span class="va">eng_12</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="mo-old-english-speakers-3" class="section level2 unnumbered">
<h2>18-mo-old English speakers<a class="anchor" aria-label="anchor" href="#mo-old-english-speakers-3"><i class="fas fa-link"></i></a>
</h2>
<p>Letâ€™s move on to the 18-mo-old English speakers.</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_18_files</span> <span class="op">&lt;-</span> <span class="va">mbcdi_file_dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">'18'</span>, <span class="va">lang_cond</span> <span class="op">==</span> <span class="st">'english'</span>, <span class="va">n_subs</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>There are <span class="math inline">\(n=\)</span> 3 files with participant data.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">clean_cdi</span><span class="op">(</span><span class="va">eng_18_files</span><span class="op">$</span><span class="va">fn</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">clean_cdi</span><span class="op">(</span><span class="va">eng_18_files</span><span class="op">$</span><span class="va">fn</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">clean_cdi</span><span class="op">(</span><span class="va">eng_18_files</span><span class="op">$</span><span class="va">fn</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>There are some duplicate entries for some words.</p>
<div class="rmdnote">
<p><del>We need a strategy for reconciling these duplicates: <code>candy</code>, <code>leg</code>, <code>rain</code>, <code>wet</code>.</del></p>
<p>Itâ€™s not elegant, but I have one for modifying the duplicate names. See below.</p>
</div>
</div>
<div id="mo-old-english-speakers-4" class="section level2 unnumbered">
<h2>24-mo-old English speakers<a class="anchor" aria-label="anchor" href="#mo-old-english-speakers-4"><i class="fas fa-link"></i></a>
</h2>
<p>Letâ€™s move on to the 24-mo-old English speakers.</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_24_files</span> <span class="op">&lt;-</span> <span class="va">mbcdi_file_dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op">==</span> <span class="st">'24'</span>, <span class="va">lang_cond</span> <span class="op">==</span> <span class="st">'english'</span>, <span class="va">n_subs</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>There are <span class="math inline">\(n=\)</span> 3 files with participant data.</p>
<p>Letâ€™s see how the <code>clean_cdi()</code> works on one of these.</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">clean_cdi</span><span class="op">(</span><span class="va">eng_24_files</span><span class="op">$</span><span class="va">fn</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Once again, we have duplicates for several items: â€˜candyâ€™, â€˜legâ€™, â€˜rainâ€™, â€˜wetâ€™.</p>
<p>Itâ€™s very hacky, but I think we might want to modify these item names until we figure out a better way to handle the duplicates.</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modify_mcdi_dupes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">dupe</span> <span class="op">=</span> <span class="st">'leg'</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dup_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">==</span> <span class="va">dupe</span><span class="op">]</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dup_index</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">this_dup</span> <span class="op">&lt;-</span> <span class="va">dup_index</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="va">this_dup</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">dupe</span>, <span class="st">"_"</span>, <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">df</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">open_csv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/scalar.html">is.string</a></span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span></span>
<span>  <span class="fu">assertthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/assertthat/man/assertions-file.html">is.readable</a></span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">csv_fn</span>,</span>
<span>                    col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                    show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">trim_cdi_18_24_fields</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"note"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"instructions"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"comments"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"continue"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"vocab"</span><span class="op">)</span>,</span>
<span>                  <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"mcdi"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">make_cdi_18_24_longer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="va">n_vars</span>,</span>
<span>                        names_to <span class="op">=</span> <span class="st">"word"</span>,</span>
<span>                        values_to <span class="op">=</span> <span class="st">"knows"</span><span class="op">)</span></span>
<span> <span class="op">}</span></span>
<span></span>
<span><span class="va">clean_cdi_18_24_dedupe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">open_csv</span><span class="op">(</span><span class="va">csv_fn</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">modify_mcdi_dupes</span><span class="op">(</span>dupe <span class="op">=</span> <span class="st">'leg'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">modify_mcdi_dupes</span><span class="op">(</span>dupe <span class="op">=</span> <span class="st">'candy'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">modify_mcdi_dupes</span><span class="op">(</span>dupe <span class="op">=</span> <span class="st">'rain'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">modify_mcdi_dupes</span><span class="op">(</span>dupe <span class="op">=</span> <span class="st">'wet'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">trim_cdi_18_24_fields</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"play_id"</span> <span class="op">=</span> <span class="st">"participant_id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">make_cdi_18_24_longer</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_24</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">eng_24_files</span><span class="op">$</span><span class="va">fn</span>, <span class="va">clean_cdi_18_24_dedupe</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">word</span> <span class="op">+</span> <span class="va">knows</span>, <span class="va">eng_24</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can return to the 18-mo-old data to see if this works:</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eng_18</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">eng_18_files</span><span class="op">$</span><span class="va">fn</span>, <span class="va">clean_cdi_18_24_dedupe</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">word</span> <span class="op">+</span> <span class="va">knows</span>, <span class="va">eng_18</span><span class="op">)</span></span></code></pre></div>
<p>It does.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="qa-for-merging.html">QA for merging</a></div>
<div class="next"><a href="post-visit-notes.html">Post-visit notes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mb-cdi">MB-CDI</a></li>
<li><a class="nav-link" href="#purpose-2">Purpose</a></li>
<li><a class="nav-link" href="#preparation">Preparation</a></li>
<li><a class="nav-link" href="#mo-old-english-speakers">12-mo-old English speakers</a></li>
<li><a class="nav-link" href="#mo-old-english-speakers-1">18-mo-old English speakers</a></li>
<li><a class="nav-link" href="#mo-old-english-speakers-2">24-mo-old English speakers</a></li>
<li><a class="nav-link" href="#old-code">Old code</a></li>
<li><a class="nav-link" href="#mo-old-english-speakers-3">18-mo-old English speakers</a></li>
<li><a class="nav-link" href="#mo-old-english-speakers-4">24-mo-old English speakers</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PLAY-behaviorome/KoBoToolbox/blob/main/src/15-mb-cdi.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PLAY-behaviorome/KoBoToolbox/edit/main/src/15-mb-cdi.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>PLAY Project: Surveys</strong>" was written by Rick Gilmore. It was last built on 2024-05-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
