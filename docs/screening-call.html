<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Screening call | PLAY Project: Surveys</title>
<meta name="author" content="Rick Gilmore">
<meta name="description" content="Collection protocol Details about the data collection protocol for participant screening and recruiting can be found on the PLAY Project website.  Retrieve from KoBoToolbox (KBT) We make use of...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="Screening call | PLAY Project: Surveys">
<meta property="og:type" content="book">
<meta property="og:description" content="Collection protocol Details about the data collection protocol for participant screening and recruiting can be found on the PLAY Project website.  Retrieve from KoBoToolbox (KBT) We make use of...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Screening call | PLAY Project: Surveys">
<meta name="twitter:description" content="Collection protocol Details about the data collection protocol for participant screening and recruiting can be found on the PLAY Project website.  Retrieve from KoBoToolbox (KBT) We make use of...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="include/css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">PLAY Project: Surveys</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li class="book-part">Tools and Processes</li>
<li><a class="" href="setup.html">Setup</a></li>
<li class="book-part">Data Wrangling</li>
<li><a class="active" href="screening-call.html">Screening call</a></li>
<li><a class="" href="home-visit.html">Home visit</a></li>
<li><a class="" href="qa-for-merging.html">QA for merging</a></li>
<li><a class="" href="mb-cdi.html">MB-CDI</a></li>
<li><a class="" href="post-visit-notes.html">Post-visit notes</a></li>
<li><a class="" href="data-dictionary.html">Data dictionary</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="screening-visualizations.html">Screening visualizations</a></li>
<li><a class="" href="demographics-visualizations.html">Demographics visualizations</a></li>
<li><a class="" href="language-visualizations.html">Language visualizations</a></li>
<li><a class="" href="locomotion-visualizations.html">Locomotion visualizations</a></li>
<li><a class="" href="health-visualizations.html">Health visualizations</a></li>
<li><a class="" href="temperament-visualizations.html">Temperament visualizations</a></li>
<li><a class="" href="post-visit-data.html">Post-visit data</a></li>
<li class="book-part">Project Monitoring</li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PLAY-behaviorome/KoBoToolbox">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="screening-call" class="section level1 unnumbered">
<h1>Screening call<a class="anchor" aria-label="anchor" href="#screening-call"><i class="fas fa-link"></i></a>
</h1>
<div id="collection-protocol" class="section level2 unnumbered">
<h2>Collection protocol<a class="anchor" aria-label="anchor" href="#collection-protocol"><i class="fas fa-link"></i></a>
</h2>
<p>Details about the data collection <a href="https://www.play-project.org/collection.html#Participant_Recruitment">protocol for participant screening and recruiting</a> can be found on the <a href="https://play-project.org">PLAY Project website</a>.</p>
</div>
<div id="retrieve-from-kobotoolbox-kbt" class="section level2 unnumbered">
<h2>Retrieve from KoBoToolbox (KBT)<a class="anchor" aria-label="anchor" href="#retrieve-from-kobotoolbox-kbt"><i class="fas fa-link"></i></a>
</h2>
<p>We make use of the <code>targets</code> package for downloading data files from KoBoToolbox
and for saving local XLSX and CSV copies.
This allows us to download and process those files on a regular basis.</p>
<div id="setup-1" class="section level3 unnumbered">
<h3>Setup<a class="anchor" aria-label="anchor" href="#setup-1"><i class="fas fa-link"></i></a>
</h3>
<p>Load functions needed to download KBT screening/demographic questionnaire files.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"R"</span><span class="op">)</span>, <span class="st">"^kobo_|^file_"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">walk</a></span><span class="op">(</span><span class="va">fl</span>, <span class="va">source</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="download" class="section level3 unnumbered">
<h3>Download<a class="anchor" aria-label="anchor" href="#download"><i class="fas fa-link"></i></a>
</h3>
<p>We have two targets specified in <code>_targets.R</code> that handle the regular downloading of screening data files.</p>
<p>First, we generate a data frame of KoBoToolbox forms that contain the screening (“Demographic”) data.
Here is the target for that process:</p>
<pre><code># Not evaluated
  tar_target(
    kb_screen_df,
    kobo_list_data_filtered("[Dd]emographic"),
    cue = tarchetypes::tar_cue_age(
      name = kb_screen,
      age = as.difftime(update_interval, units = update_interval_units)
    )
  ),</code></pre>
<p>Then we download and save the raw XLSX files to <code>../data/xlsx/screening</code> using <code>kobo_retrieve_save_many_xlsx(kb_screen_df, save_dir = "../data/xlsx/screening")</code>.
Finally, we convert the XLSX files to CSVs via <code>file_load_xlsx_save_many_csv("../data/xlsx/screening", "../data/csv/screening", "Demographic")</code>.
The latter two steps are handled by the wrapper function <code>screen_download_convert(kb_screen_df, "data/xlsx/screening", "data/csv/screening")</code>.
Here is the accompanying target:</p>
<pre><code># Download screening/demographic survey
  tar_target(
    screen_download,
    screen_download_convert(kb_screen_df, "data/xlsx/screening", "data/csv/screening"),
    cue = tarchetypes::tar_cue_age(
      name = screen_df,
      age = as.difftime(update_interval, units = update_interval_units)
    )
  ),</code></pre>
</div>
</div>
<div id="clean" class="section level2 unnumbered">
<h2>Clean<a class="anchor" aria-label="anchor" href="#clean"><i class="fas fa-link"></i></a>
</h2>
<p>As of 2023-09-22, the cleaning and merging process for the screening/demographic data is handled here, in this document, not as a target.</p>
<div id="setup-2" class="section level3 unnumbered">
<h3>Setup<a class="anchor" aria-label="anchor" href="#setup-2"><i class="fas fa-link"></i></a>
</h3>
<p>A set of cleaning functions have the <code>screen_</code> prefix.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">walk</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"R"</span><span class="op">)</span>, </span>
<span>                    <span class="st">"^screen_"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">source</span><span class="op">)</span></span></code></pre></div>
<p>There are three CSV files to clean:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"../data/csv/screening"</span>, <span class="st">"[Dd]emographic"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "../data/csv/screening/275882_PLAY_Demographic_Questionnaire.csv"        
## [2] "../data/csv/screening/334134_PLAY_Demographic_Questionnaire_Spanish.csv"
## [3] "../data/csv/screening/359546_PLAY_Demographic_Questionnaire.csv"</code></pre>
<p>We clean them separately, as needed, then merge them.</p>
</div>
<div id="clean-variable-names" class="section level3 unnumbered">
<h3>Clean variable names<a class="anchor" aria-label="anchor" href="#clean-variable-names"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">fn</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                  col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                  show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">fn</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                  col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                  show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">df3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">fn</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                  col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>                  show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span>, <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "start"                                                                        
##  [2] "end"                                                                          
##  [3] "c_today"                                                                      
##  [4] "play_phone_questionnaire/update_date"                                         
##  [5] "play_phone_questionnaire/group_contact_info/instructions_contactinfo"         
##  [6] "play_phone_questionnaire/group_contact_info/parent_phone"                     
##  [7] "play_phone_questionnaire/group_contact_info/parent_email"                     
##  [8] "play_phone_questionnaire/group_contact_info/group_address/note_parent_address"
##  [9] "play_phone_questionnaire/group_contact_info/group_address/parent_address_1"   
## [10] "play_phone_questionnaire/group_contact_info/group_address/parent_address_2"   
## [11] "play_phone_questionnaire/group_contact_info/group_address/city"               
## [12] "play_phone_questionnaire/group_contact_info/group_address/state"              
## [13] "play_phone_questionnaire/group_contact_info/acknowledge_contact_info"         
## [14] "play_phone_questionnaire/instructions_guid"                                   
## [15] "play_phone_questionnaire/child_first_name"</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span>, <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "start"                                                                                                                                                                                                                                    
##  [2] "end"                                                                                                                                                                                                                                      
##  [3] "c_today"                                                                                                                                                                                                                                  
##  [4] "play_demo_questionnaire/update_date"                                                                                                                                                                                                      
##  [5] "play_demo_questionnaire/NOTA_El_cuestionario_demogr_fico_debe_ser_completado_por_el_investigador_que_va_a_ir_a_la_visita_al_hogar_con_la_madre_por_tel_fono_La_madre_deber_a_ser_la_madre_que_va_a_participar_en_el_estudio_con_su_ni_o_a"
##  [6] "play_demo_questionnaire/group_siteinfo/site_id"                                                                                                                                                                                           
##  [7] "play_demo_questionnaire/group_siteinfo/subject_number"                                                                                                                                                                                    
##  [8] "play_demo_questionnaire/exp_name"                                                                                                                                                                                                         
##  [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"                                                                                                                                                                      
## [10] "play_demo_questionnaire/group_contact_info/parent_phone"                                                                                                                                                                                  
## [11] "play_demo_questionnaire/group_contact_info/parent_email"                                                                                                                                                                                  
## [12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"                                                                                                                                                             
## [13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"                                                                                                                                                                
## [14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"                                                                                                                                                                
## [15] "play_demo_questionnaire/group_contact_info/group_address/city"</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df3</span><span class="op">)</span>, <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "start"                                                                       
##  [2] "end"                                                                         
##  [3] "c_today"                                                                     
##  [4] "play_demo_questionnaire/update_date"                                         
##  [5] "play_demo_questionnaire/note_exp"                                            
##  [6] "play_demo_questionnaire/group_siteinfo/site_id"                              
##  [7] "play_demo_questionnaire/group_siteinfo/subject_number"                       
##  [8] "play_demo_questionnaire/group_siteinfo/exp_name"                             
##  [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"         
## [10] "play_demo_questionnaire/group_contact_info/parent_phone"                     
## [11] "play_demo_questionnaire/group_contact_info/parent_email"                     
## [12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"
## [13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"   
## [14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"   
## [15] "play_demo_questionnaire/group_contact_info/group_address/city"</code></pre>
<p>There are a separate set of variable-by-variable cleaning functions in <code>R/screen_clean_utils.R</code>.</p>
<p>We remove the unneeded ’play_demo_*’ and ‘play_phone_questionnaire_’ variable headers using <code>screen_remove_variable_headers()</code>.</p>
<p>We remove fields that contain administrative metadata with <code>screen_remove_metadata_fields()</code>.</p>
<p>We remove fields used only by staff in uploading data to Databrary using <code>screen_remove_databrary_fields()</code>.</p>
<p>We have name and address information in the screening data (e.g., ‘..parent_phone’, ‘..parent_email’, etc.)</p>
<div class="rmdnote">
<p>In a future workflow, we will add Census FIPS IDs for the State and Country
<strong>before</strong> removing the address information.</p>
<p>The Census queries stopped working around 2023-06-16.</p>
<p>For now, we remove identifiers without querying the Census.</p>
</div>
<p>We remove identifiable information using <code>screen_remove_identifiers()</code>.</p>
<p>Then, we use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::full_join()</a></code> to combine the set of individually
cleaned data files.
The <code>screen_clean_raw_csv()</code> function combines the previous <code>screen_remove*</code> functions.
The <code>screen_clean_raw_join()</code> function cleans each CSV then joins them.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">scr_df</span> <span class="op">&lt;-</span> <span class="fu">screen_clean_raw_join</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/275882_PLAY_Demographic_Questionnaire.csv'.</code></pre>
<pre><code>## Removed n = 31 of 168 columns.</code></pre>
<pre><code>## Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/334134_PLAY_Demographic_Questionnaire_Spanish.csv'.</code></pre>
<pre><code>## Removed n = 47 of 236 columns.</code></pre>
<pre><code>## Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/359546_PLAY_Demographic_Questionnaire.csv'.</code></pre>
<pre><code>## Removed n = 47 of 239 columns.</code></pre>
<pre><code>## Joining with `by = join_by(start, end, c_today, update_date, site_id,
## subject_number, state, check_childage, check_childage_weeks, child_sex,
## day, day2, day1, play_id, language_spoken_mom,
## `language_spoken_mom/english`, `language_spoken_mom/spanish`,
## `language_spoken_mom/other`, language_spoken_mom_other,
## language_spoken_child, `language_spoken_child/english`,
## `language_spoken_child/spanish`, `language_spoken_child/other`,
## language_spoken_child_other, language_spoken_house,
## `language_spoken_house/english`, `language_spoken_house/spanish`,
## `language_spoken_house/other`, language_spoken_house_other,
## `child_information/child_bornonduedate`, `child_information/child_onterm`,
## `child_information/child_duedate`, `child_information/child_birthage`,
## `child_information/child_weight_pounds`,
## `child_information/child_weight_ounces`,
## `child_information/child_birth_complications`,
## `child_information/specify_birth_complications`,
## `child_information/hearing_disabilities`,
## `child_information/specify_hearing`,
## `child_information/vision_disabilities`,
## `child_information/specify_vision`,
## `child_information/major_illnesses_injuries`,
## `child_information/specify_illnesses_injuries`,
## `child_information/other_developmentaldelays`,
## `child_information/specify_developmentaldelays`,
## `child_information/child_race`, `child_information/child_sleep_time`,
## `child_information/child_wake_time`, `child_information/child_nap_hours`,
## `child_information/child_sleep_location`,
## `child_information/specify_child_sleep_location`,
## `child_information/indicate_child`, `child_information/indicate_child_2`,
## `group_family_structure/only_child`,
## `group_family_structure/specify_onlychild`,
## `group_family_structure/household_members`,
## `group_family_structure/household_members/father_biological`,
## `group_family_structure/household_members/male_partner`,
## `group_family_structure/household_members/mother_biological`,
## `group_family_structure/household_members/female_partner`,
## `group_family_structure/household_members/other_partner`,
## `group_family_structure/household_members/sibling_biological`,
## `group_family_structure/household_members/sibling_nonbiological`,
## `group_family_structure/household_members/grandmother`,
## `group_family_structure/household_members/grandfather`,
## `group_family_structure/household_members/great_grandmother`,
## `group_family_structure/household_members/great_grandfather`,
## `group_family_structure/household_members/aunt`,
## `group_family_structure/household_members/uncle`,
## `group_family_structure/household_members/cousin`,
## `group_family_structure/household_members/relative`,
## `group_family_structure/household_members/non_relative`,
## `group_family_structure/household_members/none`,
## `group_family_structure/other_relatives`,
## `group_family_structure/other_non_relatives`,
## `group_family_structure/indicate_familystructure`,
## `group_mominfo/mom_biological`, `group_mominfo/mom_relation`,
## `group_mominfo/mom_datecare`, `group_mominfo/mom_childbirth_age`,
## `group_mominfo/check_mom_childbirth_age`, `group_mominfo/mom_race`,
## `group_mominfo/mom_birth_country`,
## `group_mominfo/specify_mom_birth_country`, `group_mominfo/mom_education`,
## `group_mominfo/mom_employment`, `group_mominfo/mom_occupation`,
## `group_mominfo/mom_jobs_number`, `group_mominfo/mom_training`,
## `group_mominfo/mom_condition`, `group_mominfo/specify_mom_condition`,
## `group_mominfo/indicate_mom`, `group_biodad/biodad_childbirth_age`,
## `group_biodad/check_biodad_childbirth_age`, `group_biodad/biodad_race`,
## `group_biodad/indicate_biodad`, `group_biomom/biomom_childbirth_age`,
## `group_biomom/check_biomom_childbirth_age`, `group_biomom/biomom_race`,
## `group_biomom/indicate_biomom`, `group_nonbiopartner/nonbiopartner_race`,
## `group_nonbiopartner/indicate_nonbiopartner`,
## `group_genpartner_info/partner_education`,
## `group_genpartner_info/partner_employment`,
## `group_genpartner_info/partner_occupation`,
## `group_genpartner_info/partner_jobs_number`,
## `group_genpartner_info/partner_program`,
## `group_genpartner_info/indicate_genpartner`,
## `group_child_care_arrangements/childcare_types`,
## `group_child_care_arrangements/childcare_types/nanny_home`,
## `group_child_care_arrangements/childcare_types/nanny_nothome`,
## `group_child_care_arrangements/childcare_types/relative`,
## `group_child_care_arrangements/childcare_types/childcare`,
## `group_child_care_arrangements/childcare_types/none`,
## `group_child_care_arrangements/childcare_location`,
## `group_child_care_arrangements/childcare_hours`,
## `group_child_care_arrangements/childcare_number`,
## `group_child_care_arrangements/childcare_age`,
## `group_child_care_arrangements/childcare_language`,
## `group_inclusioncheck/inclusionreason`,
## `group_inclusioncheck/indicate_inclusion`, indicate_demoquestionnaire,
## indicate_databrary, `_id`)`
## Joining with `by = join_by(start, end, c_today, update_date, site_id,
## subject_number, state, check_childage, check_childage_weeks, child_sex,
## day, day2, day1, language_spoken_child, `language_spoken_child/english`,
## `language_spoken_child/spanish`, `language_spoken_child/other`,
## language_spoken_child_other, `child_information/child_bornonduedate`,
## `child_information/child_onterm`, `child_information/child_duedate`,
## `child_information/child_birthage`,
## `child_information/child_weight_pounds`,
## `child_information/child_weight_ounces`,
## `child_information/child_birth_complications`,
## `child_information/specify_birth_complications`,
## `child_information/hearing_disabilities`,
## `child_information/specify_hearing`,
## `child_information/vision_disabilities`,
## `child_information/specify_vision`,
## `child_information/major_illnesses_injuries`,
## `child_information/specify_illnesses_injuries`,
## `child_information/child_sleep_time`, `child_information/child_wake_time`,
## `child_information/child_nap_hours`,
## `child_information/child_sleep_location`,
## `child_information/specify_child_sleep_location`,
## `child_information/indicate_child`, `child_information/indicate_child_2`,
## `group_family_structure/household_members`,
## `group_family_structure/household_members/male_partner`,
## `group_family_structure/household_members/female_partner`,
## `group_family_structure/household_members/other_partner`,
## `group_family_structure/household_members/grandmother`,
## `group_family_structure/household_members/grandfather`,
## `group_family_structure/household_members/great_grandmother`,
## `group_family_structure/household_members/great_grandfather`,
## `group_family_structure/household_members/aunt`,
## `group_family_structure/household_members/uncle`,
## `group_family_structure/household_members/cousin`,
## `group_family_structure/household_members/relative`,
## `group_family_structure/household_members/non_relative`,
## `group_family_structure/other_relatives`,
## `group_family_structure/other_non_relatives`,
## `group_family_structure/indicate_familystructure`,
## `group_child_care_arrangements/childcare_types`,
## `group_child_care_arrangements/childcare_types/relative`,
## `group_child_care_arrangements/childcare_types/childcare`,
## `group_child_care_arrangements/childcare_types/none`,
## `group_child_care_arrangements/childcare_hours`,
## `group_child_care_arrangements/childcare_number`,
## `group_child_care_arrangements/childcare_age`,
## `group_child_care_arrangements/childcare_language`, `_id`)`</code></pre>
<pre><code>## # A tibble: 633 × 162
##    start              end   c_today update_date site_id subject_number state
##    &lt;chr&gt;              &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;
##  1 2020-02-27T08:24:… 2020… 2020-0… &lt;NA&gt;        NYUNI   230            New …
##  2 2020-02-27T08:43:… 2020… 2020-0… &lt;NA&gt;        NYUNI   229            New …
##  3 2019-12-18T16:37:… 2020… 2020-0… &lt;NA&gt;        VCOMU   002            VA   
##  4 2020-01-01T12:54:… 2020… 2020-0… &lt;NA&gt;        GEORG   010            Virg…
##  5 2020-01-15T14:53:… 2020… 2020-0… &lt;NA&gt;        NYUNI   008            New …
##  6 2020-01-15T15:47:… 2020… 2020-0… &lt;NA&gt;        NYUNI   009            New …
##  7 2020-01-24T14:22:… 2020… 2020-0… &lt;NA&gt;        GEORG   011            Virg…
##  8 2020-01-30T13:30:… 2020… 2020-0… &lt;NA&gt;        NYUNI   010            NY   
##  9 2020-02-03T17:40:… 2020… 2020-0… &lt;NA&gt;        NYUNI   011            New …
## 10 2020-02-05T09:39:… 2020… 2020-0… &lt;NA&gt;        VCOMU   003            VA   
## # ℹ 623 more rows
## # ℹ 155 more variables: check_childage &lt;chr&gt;, check_childage_weeks &lt;chr&gt;,
## #   child_sex &lt;chr&gt;, day &lt;chr&gt;, day2 &lt;chr&gt;, day1 &lt;chr&gt;, play_id &lt;chr&gt;,
## #   language_spoken_mom &lt;chr&gt;, `language_spoken_mom/english` &lt;chr&gt;,
## #   `language_spoken_mom/spanish` &lt;chr&gt;, `language_spoken_mom/other` &lt;chr&gt;,
## #   language_spoken_mom_other &lt;chr&gt;, language_spoken_child &lt;chr&gt;,
## #   `language_spoken_child/english` &lt;chr&gt;, …</code></pre>
</div>
<div id="clean-individual-fields" class="section level3 unnumbered">
<h3>Clean individual fields<a class="anchor" aria-label="anchor" href="#clean-individual-fields"><i class="fas fa-link"></i></a>
</h3>
<p>Now, we can proceed to clean-up the merged data frame.
The sequence of functions called below cleans ‘construct-specific’ variables
as indicated by the function names.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scr_df</span> <span class="op">&lt;-</span> <span class="va">scr_df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">screen_clean_child_info</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">screen_clean_lang_info</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">screen_clean_mom_info</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">screen_clean_biodad_father_info</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">screen_clean_childcare_info</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">screen_clean_family_structure</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">screen_clean_play_id</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">screen_remove_selected_cols</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">screen_select_reorder_cols</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For convenience, we package this sequence in its own function, <code>screen_clean_fields()</code>.</p>
<div class="rmdnote">
<p>Note that all of the variables are considered character strings. The <code>tidyverse</code>
suite does a great job of guessing what variables are what, but sometimes it
guesses wrongly. So, in preliminary stages, it has proved easier to make everything
a character string.</p>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scr_df</span> <span class="op">&lt;-</span> <span class="fu">screen_clean_fields</span><span class="op">(</span><span class="va">scr_df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">scr_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>## tibble [633 × 51] (S3: tbl_df/tbl/data.frame)
##  $ submit_date                       : chr [1:633] "2020-02-27T08:24:10.551-05:00" "2020-02-27T08:43:34.275-05:00" "2019-12-18T16:37:17.554-05:00" "2020-01-01T12:54:04.550-05:00" ...
##  $ site_id                           : chr [1:633] "NYUNI" "NYUNI" "VCOMU" "GEORG" ...
##  $ participant_ID                    : chr [1:633] "230" "229" "002" "010" ...
##  $ play_id                           : chr [1:633] NA NA NA NA ...
##  $ child_age_mos                     : chr [1:633] "32.677240850317695" "32.38138286215201" "26.725838264299803" "12.754766600920446" ...
##  $ child_sex                         : chr [1:633] "male" "female" "female" "male" ...
##  $ child_bornonduedate               : chr [1:633] "yes" "yes" "yes" "yes" ...
##  $ child_onterm                      : chr [1:633] NA NA NA NA ...
##  $ child_birthage                    : chr [1:633] "-7" "-10" "0" "1" ...
##  $ child_weight_pounds               : chr [1:633] "8" "7" "6" "7" ...
##  $ child_weight_ounces               : chr [1:633] "12" "10" "12" "15" ...
##  $ child_birth_complications         : chr [1:633] "no" "no" "no" "no" ...
##  $ child_birth_complications_specify : chr [1:633] NA NA NA NA ...
##  $ child_hearing_disabilities        : chr [1:633] "yes" "no" "no" "no" ...
##  $ child_hearing_disabilities_specify: chr [1:633] "Temporary hearing loss so tubes in his ears, one still remaining" NA NA NA ...
##  $ child_vision_disabilities         : chr [1:633] "no" "no" "no" "no" ...
##  $ child_vision_disabilities_specify : chr [1:633] NA NA NA NA ...
##  $ child_major_illnesses_injuries    : chr [1:633] "yes" "no" "no" "no" ...
##  $ child_illnesses_injuries_specify  : chr [1:633] "Pneumonia at 5 months" "" "" "" ...
##  $ child_developmentaldelays         : chr [1:633] NA NA NA NA ...
##  $ child_developmentaldelays_specify : chr [1:633] NA NA NA NA ...
##  $ child_sleep_time                  : chr [1:633] "20:15:00.000-05:00" "20:15:00.000-05:00" "19:00:00.000-05:00" "19:00:00.000-05:00" ...
##  $ child_wake_time                   : chr [1:633] "07:15:00.000-05:00" "06:45:00.000-05:00" "07:30:00.000-05:00" "06:15:00.000-05:00" ...
##  $ child_nap_hours                   : chr [1:633] "2" "3" "1.5" "2" ...
##  $ child_sleep_location              : chr [1:633] "crib_separate" "crib_separate" "crib_separate" "crib_separate" ...
##  $ mom_bio                           : chr [1:633] "yes" "yes" "yes" "yes" ...
##  $ mom_childbirth_age                : chr [1:633] "33.41" "38.84" "32.2" "30.38" ...
##  $ mom_race                          : chr [1:633] "white" "white" "white" "white" ...
##  $ mom_birth_country                 : chr [1:633] "unitedstates" "unitedstates" "unitedstates" "unitedstates" ...
##  $ mom_birth_country_specify         : chr [1:633] "" "" "" "" ...
##  $ mom_education                     : chr [1:633] "masters" "doctorate" "doctorate" "masters" ...
##  $ mom_employment                    : chr [1:633] "full_time" "full_time" "full_time" "full_time" ...
##  $ mom_occupation                    : chr [1:633] "Architect" "Spanish teacher" "Nurse instructor" "School Psychologist" ...
##  $ mom_jobs_number                   : chr [1:633] "1" "1" "1" "1" ...
##  $ mom_training                      : chr [1:633] "no" "no" "no" "no" ...
##  $ biodad_childbirth_age             : chr [1:633] "33.85_NA" "30.42_NA" "37.32_NA" "30.53_NA" ...
##  $ biodad_race                       : chr [1:633] "white_NA" "white_NA" "NA_NA" "NA_NA" ...
##  $ language_spoken_mom               : chr [1:633] "english" "english spanish" "english" "english" ...
##  $ language_spoken_mom_comments      : chr [1:633] NA NA NA NA ...
##  $ language_spoken_child             : chr [1:633] "english" "spanish" "english" "english" ...
##  $ language_spoken_home_comments     : chr [1:633] "FALSE_47706996" "TRUE_47707423" "FALSE_43397823" "FALSE_44074192" ...
##  $ language_spoken_child_comments    : chr [1:633] NA NA NA NA ...
##  $ language_spoken_home              : chr [1:633] "english" "english spanish" "english" "english" ...
##  $ language_spoken_house_other       : chr [1:633] NA NA NA NA ...
##  $ language_spoken_home_other        : chr [1:633] NA NA NA NA ...
##  $ childcare_types                   : chr [1:633] NA NA NA NA ...
##  $ childcare_location                : chr [1:633] NA NA NA NA ...
##  $ childcare_hours                   : chr [1:633] NA NA NA NA ...
##  $ childcare_number                  : chr [1:633] NA NA NA NA ...
##  $ childcare_age                     : chr [1:633] NA NA NA NA ...
##  $ childcare_language                : chr [1:633] NA NA NA NA ...</code></pre>
<p>There is more work to do, but we have a version worth exporting.</p>
</div>
</div>
<div id="merge" class="section level2 unnumbered">
<h2>Merge<a class="anchor" aria-label="anchor" href="#merge"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s add the Databrary volume ID info.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scr_df</span> <span class="op">&lt;-</span> <span class="va">scr_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">screen_add_db_vol_id</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then filter out rows that do not have valid volume IDs.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_db_vol</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">scr_df</span><span class="op">$</span><span class="va">vol_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scr_df</span> <span class="op">&lt;-</span> <span class="va">scr_df</span><span class="op">[</span><span class="va">valid_db_vol</span>,<span class="op">]</span></span></code></pre></div>
<p>There are <span class="math inline">\(n=\)</span> 624 valid Databrary volume IDs out of a total of <span class="math inline">\(n=\)</span> 633 screening records.</p>
<p>Next, we add a <code>play_status</code> field based on the <code>group-name</code> field from Databrary.
We use <code>group-name</code> for indicating “Gold”, “Silver”, or “Not run.”</p>
<p>Two targets in <code>_targets.R</code> are relevant for this operation:</p>
<pre><code>  tar_target(
    play_vols_df,
    readr::read_csv("data/csv/_meta/play_site_vols.csv",
                    show_col_types = FALSE)
  ),
  tar_target(
    databrary_session_csvs,
    purrr::map(play_vols_df$site_id, databrary_get_save_session_csv),
    cue = tarchetypes::tar_cue_age(
      name = databrary_session_csvs,
      age = as.difftime(update_interval, units = update_interval_units)
    )
  )
</code></pre>
<p>These targets generate site-specific CSVs in <code>data/csv/site_sessions</code> based on the database of PLAY sites contained in <code>data/csv/_meta/play_site_vols.csv</code>.
We load these CSVs into a single data frame.</p>
<div id="load-site-session-data" class="section level3" number="0.1.1">
<h3>
<span class="header-section-number">0.1.1</span> Load site session data<a class="anchor" aria-label="anchor" href="#load-site-session-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">session_fns</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"../data/csv/site_sessions"</span>, <span class="st">"\\.csv$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_sessions</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span></span>
<span>    <span class="va">session_fns</span>,</span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="va"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>,</span>
<span>    col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">'c'</span><span class="op">)</span>,</span>
<span>    show_col_types <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code>group_name</code> variable contains status information about the sessions.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">group_name</span>, data<span class="op">=</span><span class="va">df_sessions</span><span class="op">)</span></span></code></pre></div>
<pre><code>## group_name
##    No visit    No_visit    No_Visit   PLAY_Gold PLAY_Silver 
##           1          15          66         380          81</code></pre>
<p>We note that there are three different versions of no visit: “No visit”, “No_visit”, and “No_Visit”.
In addition, there are <span class="math inline">\(n=\)</span> 56 sessions with NA in the <code>group_name</code>.
These could be sessions that are still in QA or which are scheduled, or there could be some other anomaly.
Here, we want to select only those sessions that occurred and which have passed QA–those sessions for which <code>group_name</code> is either ‘PLAY_Gold’ or ‘PLAY_Silver’.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sessions</span> <span class="op">&lt;-</span> <span class="va">df_sessions</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">group_name</span>, <span class="st">"PLAY_"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="sharing-by-session-status" class="section level3" number="0.1.2">
<h3>
<span class="header-section-number">0.1.2</span> Sharing by session status<a class="anchor" aria-label="anchor" href="#sharing-by-session-status"><i class="fas fa-link"></i></a>
</h3>
<p>Here is information about the sharing status.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">group_name</span> <span class="op">+</span> <span class="va">session_release</span>, <span class="va">df_sessions</span><span class="op">)</span></span></code></pre></div>
<pre><code>##              session_release
## group_name    EXCERPTS PRIVATE SHARED
##   PLAY_Gold        294       0     86
##   PLAY_Silver       64       1     16</code></pre>
<p>There was one session marked <code>PRIVATE</code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sessions</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">session_release</span> <span class="op">==</span> <span class="st">"PRIVATE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">vol_id</span>, <span class="va">session_id</span>, <span class="va">session_name</span>, <span class="va">group_name</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   vol_id session_id session_name   group_name 
##   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;      
## 1 979    66932      PLAY_PRINU_024 PLAY_Silver</code></pre>
<p>Now, we join the screening data with the Databrary session data.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">screen_datab_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df_sessions</span>, <span class="va">scr_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'vol_id'</span>, <span class="st">'participant_ID'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s do some additional cleaning of redundant column names, e.g., exclusion.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">screen_datab_df</span> <span class="op">&lt;-</span> <span class="va">screen_datab_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="va">exclusion_reason</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"exclusion1_reason"</span>, <span class="st">"exclusion2_reason"</span>, <span class="st">"exclusion_reason"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>exclusion_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">exclusion_reason</span>, <span class="st">"NA|_"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="export-cleaned-file" class="section level2 unnumbered">
<h2>Export cleaned file<a class="anchor" aria-label="anchor" href="#export-cleaned-file"><i class="fas fa-link"></i></a>
</h2>
<p>We date-stamp the exported file so we can monitor progress as this workflow develops.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sfn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PLAY-screening-datab-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".csv"</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">screen_datab_df</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data/csv/screening/agg/"</span>, <span class="va">sfn</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We also save a copy with “latest”.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sfn</span> <span class="op">&lt;-</span> <span class="st">"PLAY-screening-datab-latest.csv"</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">screen_datab_df</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data/csv/screening/agg/"</span>, <span class="va">sfn</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="setup.html">Setup</a></div>
<div class="next"><a href="home-visit.html">Home visit</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#screening-call">Screening call</a></li>
<li><a class="nav-link" href="#collection-protocol">Collection protocol</a></li>
<li>
<a class="nav-link" href="#retrieve-from-kobotoolbox-kbt">Retrieve from KoBoToolbox (KBT)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#setup-1">Setup</a></li>
<li><a class="nav-link" href="#download">Download</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#clean">Clean</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#setup-2">Setup</a></li>
<li><a class="nav-link" href="#clean-variable-names">Clean variable names</a></li>
<li><a class="nav-link" href="#clean-individual-fields">Clean individual fields</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#merge">Merge</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-site-session-data"><span class="header-section-number">0.1.1</span> Load site session data</a></li>
<li><a class="nav-link" href="#sharing-by-session-status"><span class="header-section-number">0.1.2</span> Sharing by session status</a></li>
</ul>
</li>
<li><a class="nav-link" href="#export-cleaned-file">Export cleaned file</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PLAY-behaviorome/KoBoToolbox/blob/main/src/12-screening.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PLAY-behaviorome/KoBoToolbox/edit/main/src/12-screening.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>PLAY Project: Surveys</strong>" was written by Rick Gilmore. It was last built on 2024-01-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
