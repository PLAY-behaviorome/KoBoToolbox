<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Clean – PLAY Survey Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./screen-viz.html" rel="next">
<link href="./screen-gather.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="include/css/style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./screen-gather.html">Screening</a></li><li class="breadcrumb-item"><a href="./screen-clean.html"><span class="chapter-title">Clean</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PLAY Survey Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/PLAY-behaviorome/KoBoToolbox/tree/main/src/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Setup</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Screening</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./screen-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Gather</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./screen-clean.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Clean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./screen-viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Visualize</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./screen-data-dictionary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data dictionary</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Home visit</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Gather</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-aggregate.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Aggregate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-clean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Clean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Visualize</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-data-dictionary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data dictionary</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Post visit</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./post-visit-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Gather</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./post-visit-clean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Clean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./post-visit-viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Visualize</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./post-visit-data-dictionary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data dictionary</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Export</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./merge.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Merge files</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#clean-variable-names" id="toc-clean-variable-names" class="nav-link" data-scroll-target="#clean-variable-names">Clean variable names</a></li>
  <li><a href="#clean-individual-fields" id="toc-clean-individual-fields" class="nav-link" data-scroll-target="#clean-individual-fields">Clean individual fields</a></li>
  <li><a href="#merge" id="toc-merge" class="nav-link" data-scroll-target="#merge">Merge</a>
  <ul class="collapse">
  <li><a href="#load-site-session-data" id="toc-load-site-session-data" class="nav-link" data-scroll-target="#load-site-session-data">Load site session data</a></li>
  <li><a href="#sharing-by-session-status" id="toc-sharing-by-session-status" class="nav-link" data-scroll-target="#sharing-by-session-status">Sharing by session status</a></li>
  </ul></li>
  <li><a href="#export-cleaned-file" id="toc-export-cleaned-file" class="nav-link" data-scroll-target="#export-cleaned-file">Export cleaned file</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/PLAY-behaviorome/KoBoToolbox/edit/main/src/screen-clean.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/PLAY-behaviorome/KoBoToolbox/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./screen-gather.html">Screening</a></li><li class="breadcrumb-item"><a href="./screen-clean.html"><span class="chapter-title">Clean</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Clean</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">September 13, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="setup" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="setup">Setup</h3>
<p>We source a set of cleaning functions have the <code>screen_</code> prefix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk</span>(<span class="fu">list.files</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"R"</span>), </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"^screen_"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>), source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are three CSV files to clean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>(fn <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"../data/csv/screening"</span>, <span class="st">"[Dd]emographic"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "../data/csv/screening/275882_PLAY_Demographic_Questionnaire.csv"        
[2] "../data/csv/screening/334134_PLAY_Demographic_Questionnaire_Spanish.csv"
[3] "../data/csv/screening/359546_PLAY_Demographic_Questionnaire.csv"        </code></pre>
</div>
</div>
<p>We clean them separately, as needed, then merge them.</p>
</section>
<section id="clean-variable-names" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="clean-variable-names">Clean variable names</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(fn[<span class="dv">1</span>],</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">'c'</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(fn[<span class="dv">2</span>],</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">'c'</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(fn[<span class="dv">3</span>],</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">'c'</span>),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df1), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                        
 [2] "end"                                                                          
 [3] "c_today"                                                                      
 [4] "play_phone_questionnaire/update_date"                                         
 [5] "play_phone_questionnaire/group_contact_info/instructions_contactinfo"         
 [6] "play_phone_questionnaire/group_contact_info/parent_phone"                     
 [7] "play_phone_questionnaire/group_contact_info/parent_email"                     
 [8] "play_phone_questionnaire/group_contact_info/group_address/note_parent_address"
 [9] "play_phone_questionnaire/group_contact_info/group_address/parent_address_1"   
[10] "play_phone_questionnaire/group_contact_info/group_address/parent_address_2"   
[11] "play_phone_questionnaire/group_contact_info/group_address/city"               
[12] "play_phone_questionnaire/group_contact_info/group_address/state"              
[13] "play_phone_questionnaire/group_contact_info/acknowledge_contact_info"         
[14] "play_phone_questionnaire/instructions_guid"                                   
[15] "play_phone_questionnaire/child_first_name"                                    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df2), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                                                                                                                                                                                    
 [2] "end"                                                                                                                                                                                                                                      
 [3] "c_today"                                                                                                                                                                                                                                  
 [4] "play_demo_questionnaire/update_date"                                                                                                                                                                                                      
 [5] "play_demo_questionnaire/NOTA_El_cuestionario_demogr_fico_debe_ser_completado_por_el_investigador_que_va_a_ir_a_la_visita_al_hogar_con_la_madre_por_tel_fono_La_madre_deber_a_ser_la_madre_que_va_a_participar_en_el_estudio_con_su_ni_o_a"
 [6] "play_demo_questionnaire/group_siteinfo/site_id"                                                                                                                                                                                           
 [7] "play_demo_questionnaire/group_siteinfo/subject_number"                                                                                                                                                                                    
 [8] "play_demo_questionnaire/exp_name"                                                                                                                                                                                                         
 [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"                                                                                                                                                                      
[10] "play_demo_questionnaire/group_contact_info/parent_phone"                                                                                                                                                                                  
[11] "play_demo_questionnaire/group_contact_info/parent_email"                                                                                                                                                                                  
[12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"                                                                                                                                                             
[13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"                                                                                                                                                                
[14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"                                                                                                                                                                
[15] "play_demo_questionnaire/group_contact_info/group_address/city"                                                                                                                                                                            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df3), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                       
 [2] "end"                                                                         
 [3] "c_today"                                                                     
 [4] "play_demo_questionnaire/update_date"                                         
 [5] "play_demo_questionnaire/note_exp"                                            
 [6] "play_demo_questionnaire/group_siteinfo/site_id"                              
 [7] "play_demo_questionnaire/group_siteinfo/subject_number"                       
 [8] "play_demo_questionnaire/group_siteinfo/exp_name"                             
 [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"         
[10] "play_demo_questionnaire/group_contact_info/parent_phone"                     
[11] "play_demo_questionnaire/group_contact_info/parent_email"                     
[12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"
[13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"   
[14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"   
[15] "play_demo_questionnaire/group_contact_info/group_address/city"               </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df1), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                        
 [2] "end"                                                                          
 [3] "c_today"                                                                      
 [4] "play_phone_questionnaire/update_date"                                         
 [5] "play_phone_questionnaire/group_contact_info/instructions_contactinfo"         
 [6] "play_phone_questionnaire/group_contact_info/parent_phone"                     
 [7] "play_phone_questionnaire/group_contact_info/parent_email"                     
 [8] "play_phone_questionnaire/group_contact_info/group_address/note_parent_address"
 [9] "play_phone_questionnaire/group_contact_info/group_address/parent_address_1"   
[10] "play_phone_questionnaire/group_contact_info/group_address/parent_address_2"   
[11] "play_phone_questionnaire/group_contact_info/group_address/city"               
[12] "play_phone_questionnaire/group_contact_info/group_address/state"              
[13] "play_phone_questionnaire/group_contact_info/acknowledge_contact_info"         
[14] "play_phone_questionnaire/instructions_guid"                                   
[15] "play_phone_questionnaire/child_first_name"                                    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df2), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                                                                                                                                                                                    
 [2] "end"                                                                                                                                                                                                                                      
 [3] "c_today"                                                                                                                                                                                                                                  
 [4] "play_demo_questionnaire/update_date"                                                                                                                                                                                                      
 [5] "play_demo_questionnaire/NOTA_El_cuestionario_demogr_fico_debe_ser_completado_por_el_investigador_que_va_a_ir_a_la_visita_al_hogar_con_la_madre_por_tel_fono_La_madre_deber_a_ser_la_madre_que_va_a_participar_en_el_estudio_con_su_ni_o_a"
 [6] "play_demo_questionnaire/group_siteinfo/site_id"                                                                                                                                                                                           
 [7] "play_demo_questionnaire/group_siteinfo/subject_number"                                                                                                                                                                                    
 [8] "play_demo_questionnaire/exp_name"                                                                                                                                                                                                         
 [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"                                                                                                                                                                      
[10] "play_demo_questionnaire/group_contact_info/parent_phone"                                                                                                                                                                                  
[11] "play_demo_questionnaire/group_contact_info/parent_email"                                                                                                                                                                                  
[12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"                                                                                                                                                             
[13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"                                                                                                                                                                
[14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"                                                                                                                                                                
[15] "play_demo_questionnaire/group_contact_info/group_address/city"                                                                                                                                                                            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df3), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                       
 [2] "end"                                                                         
 [3] "c_today"                                                                     
 [4] "play_demo_questionnaire/update_date"                                         
 [5] "play_demo_questionnaire/note_exp"                                            
 [6] "play_demo_questionnaire/group_siteinfo/site_id"                              
 [7] "play_demo_questionnaire/group_siteinfo/subject_number"                       
 [8] "play_demo_questionnaire/group_siteinfo/exp_name"                             
 [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"         
[10] "play_demo_questionnaire/group_contact_info/parent_phone"                     
[11] "play_demo_questionnaire/group_contact_info/parent_email"                     
[12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"
[13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"   
[14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"   
[15] "play_demo_questionnaire/group_contact_info/group_address/city"               </code></pre>
</div>
</div>
<!-- There are a separate set of variable-by-variable cleaning functions in `R/screen_clean_utils.R`. -->
<p>We remove the unneeded ’play_demo_*’ and ‘play_phone_questionnaire_’ variable headers using <code>screen_remove_variable_headers()</code>.</p>
<p>We next add Census FIPS codes for the home state and county so that we can link with county-level Census data at a later date. This depends on address, city, and state information.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Census queries stopped working around 2023-06-16, but should be restored as of 2024-09-13, using <code>R/screen_add_fips.R</code>.</p>
<p>It would be more efficient to query the Census geocoding database once.</p>
</div>
</div>
<p>We have name and address information in the screening data (e.g., ‘..parent_phone’, ‘..parent_email’, etc.). We remove this and other identifiable information using <code>screen_remove_identifiers()</code>.</p>
<p>We remove fields that contain administrative metadata with <code>screen_remove_metadata_fields()</code>.</p>
<p>We remove fields used only by staff in uploading data to Databrary using <code>screen_remove_databrary_fields()</code>.</p>
<p>Then, we use <code>dplyr::full_join()</code> to combine the set of individually cleaned data files. The <code>screen_clean_raw_csv()</code> function combines the previous <code>screen_remove*</code> functions. The <code>screen_clean_raw_join()</code> function cleans each CSV then joins them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(scr_df <span class="ot">&lt;-</span> <span class="fu">screen_clean_raw_join</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/275882_PLAY_Demographic_Questionnaire.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stringr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Passing 8 addresses to the US Census batch geocoder</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Query completed in: 1.7 seconds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Removed n = 31 of 172 columns.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: dplyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/334134_PLAY_Demographic_Questionnaire_Spanish.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Passing 8 addresses to the US Census batch geocoder</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Query completed in: 1.3 seconds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Removed n = 47 of 240 columns.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/359546_PLAY_Demographic_Questionnaire.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Passing 942 addresses to the US Census batch geocoder</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Query completed in: 123.3 seconds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Removed n = 47 of 243 columns.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(start, end, c_today, update_date, site_id,
subject_number, state, check_childage, check_childage_weeks, child_sex, day,
day2, day1, play_id, language_spoken_mom, `language_spoken_mom/english`,
`language_spoken_mom/spanish`, `language_spoken_mom/other`,
language_spoken_mom_other, language_spoken_child,
`language_spoken_child/english`, `language_spoken_child/spanish`,
`language_spoken_child/other`, language_spoken_child_other,
language_spoken_house, `language_spoken_house/english`,
`language_spoken_house/spanish`, `language_spoken_house/other`,
language_spoken_house_other, `child_information/child_bornonduedate`,
`child_information/child_onterm`, `child_information/child_duedate`,
`child_information/child_birthage`, `child_information/child_weight_pounds`,
`child_information/child_weight_ounces`,
`child_information/child_birth_complications`,
`child_information/specify_birth_complications`,
`child_information/hearing_disabilities`, `child_information/specify_hearing`,
`child_information/vision_disabilities`, `child_information/specify_vision`,
`child_information/major_illnesses_injuries`,
`child_information/specify_illnesses_injuries`,
`child_information/other_developmentaldelays`,
`child_information/specify_developmentaldelays`,
`child_information/child_race`, `child_information/child_sleep_time`,
`child_information/child_wake_time`, `child_information/child_nap_hours`,
`child_information/child_sleep_location`,
`child_information/specify_child_sleep_location`,
`child_information/indicate_child`, `child_information/indicate_child_2`,
`group_family_structure/only_child`,
`group_family_structure/specify_onlychild`,
`group_family_structure/household_members`,
`group_family_structure/household_members/father_biological`,
`group_family_structure/household_members/male_partner`,
`group_family_structure/household_members/mother_biological`,
`group_family_structure/household_members/female_partner`,
`group_family_structure/household_members/other_partner`,
`group_family_structure/household_members/sibling_biological`,
`group_family_structure/household_members/sibling_nonbiological`,
`group_family_structure/household_members/grandmother`,
`group_family_structure/household_members/grandfather`,
`group_family_structure/household_members/great_grandmother`,
`group_family_structure/household_members/great_grandfather`,
`group_family_structure/household_members/aunt`,
`group_family_structure/household_members/uncle`,
`group_family_structure/household_members/cousin`,
`group_family_structure/household_members/relative`,
`group_family_structure/household_members/non_relative`,
`group_family_structure/household_members/none`,
`group_family_structure/other_relatives`,
`group_family_structure/other_non_relatives`,
`group_family_structure/indicate_familystructure`,
`group_mominfo/mom_biological`, `group_mominfo/mom_relation`,
`group_mominfo/mom_datecare`, `group_mominfo/mom_childbirth_age`,
`group_mominfo/check_mom_childbirth_age`, `group_mominfo/mom_race`,
`group_mominfo/mom_birth_country`, `group_mominfo/specify_mom_birth_country`,
`group_mominfo/mom_education`, `group_mominfo/mom_employment`,
`group_mominfo/mom_occupation`, `group_mominfo/mom_jobs_number`,
`group_mominfo/mom_training`, `group_mominfo/mom_condition`,
`group_mominfo/specify_mom_condition`, `group_mominfo/indicate_mom`,
`group_biodad/biodad_childbirth_age`,
`group_biodad/check_biodad_childbirth_age`, `group_biodad/biodad_race`,
`group_biodad/indicate_biodad`, `group_biomom/biomom_childbirth_age`,
`group_biomom/check_biomom_childbirth_age`, `group_biomom/biomom_race`,
`group_biomom/indicate_biomom`, `group_nonbiopartner/nonbiopartner_race`,
`group_nonbiopartner/indicate_nonbiopartner`,
`group_genpartner_info/partner_education`,
`group_genpartner_info/partner_employment`,
`group_genpartner_info/partner_occupation`,
`group_genpartner_info/partner_jobs_number`,
`group_genpartner_info/partner_program`,
`group_genpartner_info/indicate_genpartner`,
`group_child_care_arrangements/childcare_types`,
`group_child_care_arrangements/childcare_types/nanny_home`,
`group_child_care_arrangements/childcare_types/nanny_nothome`,
`group_child_care_arrangements/childcare_types/relative`,
`group_child_care_arrangements/childcare_types/childcare`,
`group_child_care_arrangements/childcare_types/none`,
`group_child_care_arrangements/childcare_location`,
`group_child_care_arrangements/childcare_hours`,
`group_child_care_arrangements/childcare_number`,
`group_child_care_arrangements/childcare_age`,
`group_child_care_arrangements/childcare_language`,
`group_inclusioncheck/inclusionreason`,
`group_inclusioncheck/indicate_inclusion`, indicate_demoquestionnaire,
indicate_databrary, `_id`, state_fips, county_fips, fips_state, fips_county)`
Joining with `by = join_by(start, end, c_today, update_date, site_id,
subject_number, state, check_childage, check_childage_weeks, child_sex, day,
day2, day1, language_spoken_child, `language_spoken_child/english`,
`language_spoken_child/spanish`, `language_spoken_child/other`,
language_spoken_child_other, `child_information/child_bornonduedate`,
`child_information/child_onterm`, `child_information/child_duedate`,
`child_information/child_birthage`, `child_information/child_weight_pounds`,
`child_information/child_weight_ounces`,
`child_information/child_birth_complications`,
`child_information/specify_birth_complications`,
`child_information/hearing_disabilities`, `child_information/specify_hearing`,
`child_information/vision_disabilities`, `child_information/specify_vision`,
`child_information/major_illnesses_injuries`,
`child_information/specify_illnesses_injuries`,
`child_information/child_sleep_time`, `child_information/child_wake_time`,
`child_information/child_nap_hours`, `child_information/child_sleep_location`,
`child_information/specify_child_sleep_location`,
`child_information/indicate_child`, `child_information/indicate_child_2`,
`group_family_structure/household_members`,
`group_family_structure/household_members/male_partner`,
`group_family_structure/household_members/female_partner`,
`group_family_structure/household_members/other_partner`,
`group_family_structure/household_members/grandmother`,
`group_family_structure/household_members/grandfather`,
`group_family_structure/household_members/great_grandmother`,
`group_family_structure/household_members/great_grandfather`,
`group_family_structure/household_members/aunt`,
`group_family_structure/household_members/uncle`,
`group_family_structure/household_members/cousin`,
`group_family_structure/household_members/relative`,
`group_family_structure/household_members/non_relative`,
`group_family_structure/other_relatives`,
`group_family_structure/other_non_relatives`,
`group_family_structure/indicate_familystructure`,
`group_child_care_arrangements/childcare_types`,
`group_child_care_arrangements/childcare_types/relative`,
`group_child_care_arrangements/childcare_types/childcare`,
`group_child_care_arrangements/childcare_types/none`,
`group_child_care_arrangements/childcare_hours`,
`group_child_care_arrangements/childcare_number`,
`group_child_care_arrangements/childcare_age`,
`group_child_care_arrangements/childcare_language`, `_id`, state_fips,
county_fips, fips_state, fips_county)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 974 × 166
   start   end   c_today update_date site_id subject_number state check_childage
   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;         
 1 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   230            New … 32.6772408503…
 2 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   229            New … 32.3813828621…
 3 2019-1… 2020… 2020-0… &lt;NA&gt;        VCOMU   002            VA    26.7258382642…
 4 2020-0… 2020… 2020-0… &lt;NA&gt;        GEORG   010            Virg… 12.7547666009…
 5 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   008            New … 13.4122287968…
 6 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   009            New … 19.3636313828…
 7 2020-0… 2020… 2020-0… &lt;NA&gt;        GEORG   011            Virg… 17.8514683322…
 8 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   010            NY    17.8514683322…
 9 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   011            New … 23.8001314924…
10 2020-0… 2020… 2020-0… &lt;NA&gt;        VCOMU   003            VA    17.5884834538…
# ℹ 964 more rows
# ℹ 158 more variables: check_childage_weeks &lt;chr&gt;, child_sex &lt;chr&gt;, day &lt;chr&gt;,
#   day2 &lt;chr&gt;, day1 &lt;chr&gt;, play_id &lt;chr&gt;, language_spoken_mom &lt;chr&gt;,
#   `language_spoken_mom/english` &lt;chr&gt;, `language_spoken_mom/spanish` &lt;chr&gt;,
#   `language_spoken_mom/other` &lt;chr&gt;, language_spoken_mom_other &lt;chr&gt;,
#   language_spoken_child &lt;chr&gt;, `language_spoken_child/english` &lt;chr&gt;,
#   `language_spoken_child/spanish` &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="clean-individual-fields" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="clean-individual-fields">Clean individual fields</h3>
<p>Now, we can proceed to clean-up the merged data frame. The sequence of functions called below cleans ‘construct-specific’ variables as indicated by the function names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>scr_df <span class="ot">&lt;-</span> scr_df <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_child_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_lang_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_mom_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_biodad_father_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_childcare_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_family_structure</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_play_id</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_remove_selected_cols</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_select_reorder_cols</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For convenience, we package this sequence in its own function, <code>screen_clean_fields()</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that all of the variables are considered character strings. The <code>tidyverse</code> suite does a great job of guessing what variables are what, but sometimes it guesses wrongly. So, in preliminary stages, it has proved easier to make everything a character string.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>scr_df <span class="ot">&lt;-</span> <span class="fu">screen_clean_fields</span>(scr_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidyr</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(scr_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [974 × 51] (S3: tbl_df/tbl/data.frame)
 $ submit_date                       : chr [1:974] "2020-02-27T08:24:10.551-05:00" "2020-02-27T08:43:34.275-05:00" "2019-12-18T16:37:17.554-05:00" "2020-01-01T12:54:04.550-05:00" ...
 $ site_id                           : chr [1:974] "NYUNI" "NYUNI" "VCOMU" "GEORG" ...
 $ participant_ID                    : chr [1:974] "230" "229" "002" "010" ...
 $ play_id                           : chr [1:974] NA NA NA NA ...
 $ child_age_mos                     : chr [1:974] "32.677240850317695" "32.38138286215201" "26.725838264299803" "12.754766600920446" ...
 $ child_sex                         : chr [1:974] "male" "female" "female" "male" ...
 $ child_bornonduedate               : chr [1:974] "yes" "yes" "yes" "yes" ...
 $ child_onterm                      : chr [1:974] NA NA NA NA ...
 $ child_birthage                    : chr [1:974] "-7" "-10" "0" "1" ...
 $ child_weight_pounds               : chr [1:974] "8" "7" "6" "7" ...
 $ child_weight_ounces               : chr [1:974] "12" "10" "12" "15" ...
 $ child_birth_complications         : chr [1:974] "no" "no" "no" "no" ...
 $ child_birth_complications_specify : chr [1:974] NA NA NA NA ...
 $ child_hearing_disabilities        : chr [1:974] "yes" "no" "no" "no" ...
 $ child_hearing_disabilities_specify: chr [1:974] "Temporary hearing loss so tubes in his ears, one still remaining" NA NA NA ...
 $ child_vision_disabilities         : chr [1:974] "no" "no" "no" "no" ...
 $ child_vision_disabilities_specify : chr [1:974] NA NA NA NA ...
 $ child_major_illnesses_injuries    : chr [1:974] "yes" "no" "no" "no" ...
 $ child_illnesses_injuries_specify  : chr [1:974] "Pneumonia at 5 months" "" "" "" ...
 $ child_developmentaldelays         : chr [1:974] NA NA NA NA ...
 $ child_developmentaldelays_specify : chr [1:974] NA NA NA NA ...
 $ child_sleep_time                  : chr [1:974] "20:15:00.000-05:00" "20:15:00.000-05:00" "19:00:00.000-05:00" "19:00:00.000-05:00" ...
 $ child_wake_time                   : chr [1:974] "07:15:00.000-05:00" "06:45:00.000-05:00" "07:30:00.000-05:00" "06:15:00.000-05:00" ...
 $ child_nap_hours                   : chr [1:974] "2" "3" "1.5" "2" ...
 $ child_sleep_location              : chr [1:974] "crib_separate" "crib_separate" "crib_separate" "crib_separate" ...
 $ mom_bio                           : chr [1:974] "yes" "yes" "yes" "yes" ...
 $ mom_childbirth_age                : chr [1:974] "33.41" "38.84" "32.2" "30.38" ...
 $ mom_race                          : chr [1:974] "white" "white" "white" "white" ...
 $ mom_birth_country                 : chr [1:974] "unitedstates" "unitedstates" "unitedstates" "unitedstates" ...
 $ mom_birth_country_specify         : chr [1:974] "" "" "" "" ...
 $ mom_education                     : chr [1:974] "masters" "doctorate" "doctorate" "masters" ...
 $ mom_employment                    : chr [1:974] "full_time" "full_time" "full_time" "full_time" ...
 $ mom_occupation                    : chr [1:974] "Architect" "Spanish teacher" "Nurse instructor" "School Psychologist" ...
 $ mom_jobs_number                   : chr [1:974] "1" "1" "1" "1" ...
 $ mom_training                      : chr [1:974] "no" "no" "no" "no" ...
 $ biodad_childbirth_age             : chr [1:974] "33.85_NA" "30.42_NA" "37.32_NA" "30.53_NA" ...
 $ biodad_race                       : chr [1:974] "white_NA" "white_NA" "NA_NA" "NA_NA" ...
 $ language_spoken_mom               : chr [1:974] "english" "english spanish" "english" "english" ...
 $ language_spoken_mom_comments      : chr [1:974] NA NA NA NA ...
 $ language_spoken_child             : chr [1:974] "english" "spanish" "english" "english" ...
 $ language_spoken_home_comments     : chr [1:974] "FALSE_47706996" "TRUE_47707423" "FALSE_43397823" "FALSE_44074192" ...
 $ language_spoken_child_comments    : chr [1:974] NA NA NA NA ...
 $ language_spoken_home              : chr [1:974] "english" "english spanish" "english" "english" ...
 $ language_spoken_house_other       : chr [1:974] NA NA NA NA ...
 $ language_spoken_home_other        : chr [1:974] NA NA NA NA ...
 $ childcare_types                   : chr [1:974] NA NA NA NA ...
 $ childcare_location                : chr [1:974] NA NA NA NA ...
 $ childcare_hours                   : chr [1:974] NA NA NA NA ...
 $ childcare_number                  : chr [1:974] NA NA NA NA ...
 $ childcare_age                     : chr [1:974] NA NA NA NA ...
 $ childcare_language                : chr [1:974] NA NA NA NA ...</code></pre>
</div>
</div>
<p>There is more work to do, but we have a version worth exporting.</p>
</section>
<section id="merge" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="merge">Merge</h2>
<p>Let’s add the Databrary volume ID info.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>scr_df <span class="ot">&lt;-</span> scr_df <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">screen_add_db_vol_id</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then filter out rows that do not have valid volume IDs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>valid_db_vol <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(scr_df<span class="sc">$</span>vol_id)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>scr_df <span class="ot">&lt;-</span> scr_df[valid_db_vol,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are <em>n=</em>970 valid Databrary volume IDs out of a total of <em>n</em>=974 screening records.</p>
<p>Next, we add a <code>play_status</code> field based on the <code>group-name</code> field from Databrary. We use <code>group-name</code> for indicating “Gold”, “Silver”, or “Not run.”</p>
<p>Two targets in <code>_targets.R</code> are relevant for this operation:</p>
<pre><code>  tar_target(
    play_vols_df,
    readr::read_csv("data/csv/_meta/play_site_vols.csv",
                    show_col_types = FALSE)
  ),
  tar_target(
    databrary_session_csvs,
    purrr::map(play_vols_df$site_id, databrary_get_save_session_csv),
    cue = tarchetypes::tar_cue_age(
      name = databrary_session_csvs,
      age = as.difftime(update_interval, units = update_interval_units)
    )
  )
</code></pre>
<p>These targets generate site-specific CSVs in <code>data/csv/site_sessions</code> based on the database of PLAY sites contained in <code>data/csv/_meta/play_site_vols.csv</code>. We load these CSVs into a single data frame.</p>
<section id="load-site-session-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="load-site-session-data">Load site session data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>session_fns <span class="ot">&lt;-</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">"../data/csv/site_sessions"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="ot">&lt;-</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    session_fns,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span>read_csv,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">'c'</span>),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">list_rbind</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>group_name</code> variable contains status information about the sessions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> group_name, <span class="at">data=</span>df_sessions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>group_name
   No visit    No_visit    No_Visit   PLAY_Gold PLAY_Silver 
          1          43          86         672         113 </code></pre>
</div>
</div>
<p>We note that there are three different versions of no visit: “No visit”, “No_visit”, and “No_Visit”. In addition, there are <em>n</em>=42 sessions with NA in the <code>group_name</code>.</p>
<p>Let’s modify those values that specify no visit on one of these forms to conform with one another.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="ot">&lt;-</span> df_sessions <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group_name =</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(group_name, <span class="st">"No.*isit"</span>, <span class="st">"No_visit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These could be sessions that are still in QA or which are scheduled, or there could be some other anomaly. Here, we want to select only those sessions that occurred and which have passed QA–those sessions for which <code>group_name</code> is either ‘PLAY_Gold’ or ‘PLAY_Silver’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="ot">&lt;-</span> df_sessions <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(group_name, <span class="st">"PLAY_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sharing-by-session-status" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sharing-by-session-status">Sharing by session status</h3>
<p>Here is information about the sharing status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> group_name <span class="sc">+</span> session_release, df_sessions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             session_release
group_name    EXCERPTS PRIVATE SHARED
  PLAY_Gold        529       0    143
  PLAY_Silver       81       4     28</code></pre>
</div>
</div>
<p>There was one session marked <code>PRIVATE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(session_release <span class="sc">==</span> <span class="st">"PRIVATE"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(vol_id, session_id, session_name, group_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  vol_id session_id session_name   group_name 
  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;      
1 1656   70116      PLAY_ASUNI_001 PLAY_Silver
2 979    66932      PLAY_PRINU_024 PLAY_Silver
3 1397   70234      PLAY_UHOUS_035 PLAY_Silver
4 1422   72657      PLAY_UIOWA_025 PLAY_Silver</code></pre>
</div>
</div>
<p>Now, we join the screening data with the Databrary session data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>screen_datab_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(df_sessions, scr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'vol_id'</span>, <span class="st">'participant_ID'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s do some additional cleaning of redundant column names, e.g., exclusion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>screen_datab_df <span class="ot">&lt;-</span> screen_datab_df <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unite</span>(exclusion_reason, <span class="fu">c</span>(<span class="st">"exclusion1_reason"</span>, <span class="st">"exclusion2_reason"</span>, <span class="st">"exclusion_reason"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">exclusion_reason =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(exclusion_reason, <span class="st">"NA|_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="export-cleaned-file" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="export-cleaned-file">Export cleaned file</h2>
<p>We date-stamp the exported file so we can monitor progress as this workflow develops.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>sfn <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"PLAY-screening-datab-"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(screen_datab_df, <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"data/csv/screening/agg/"</span>, sfn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also save a copy with “latest”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>sfn <span class="ot">&lt;-</span> <span class="st">"PLAY-screening-datab-latest.csv"</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(screen_datab_df, <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"data/csv/screening/agg/"</span>, sfn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./screen-gather.html" class="pagination-link" aria-label="Gather">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Gather</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./screen-viz.html" class="pagination-link" aria-label="Visualize">
        <span class="nav-page-text"><span class="chapter-title">Visualize</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/PLAY-behaviorome/KoBoToolbox/edit/main/src/screen-clean.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/PLAY-behaviorome/KoBoToolbox/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>