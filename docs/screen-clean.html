<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Clean – PLAY Survey Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./screen-viz.html" rel="next">
<link href="./screen-gather.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="include/css/style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./screen-gather.html">Screening</a></li><li class="breadcrumb-item"><a href="./screen-clean.html"><span class="chapter-title">Clean</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PLAY Survey Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/PLAY-behaviorome/KoBoToolbox/tree/main/src/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Setup</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Screening</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./screen-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Gather</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./screen-clean.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Clean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./screen-viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Visualize</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./screen-data-dictionary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data dictionary</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Home visit</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Gather</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-aggregate.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Aggregate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-clean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Clean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Visualize</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./home-visit-data-dictionary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data dictionary</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Post visit</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./post-visit-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Gather</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./post-visit-clean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Clean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./post-visit-viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Visualize</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./post-visit-data-dictionary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data dictionary</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Export</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./merge.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Merge files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./site-specific.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Site-specific files</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#clean-variable-names" id="toc-clean-variable-names" class="nav-link" data-scroll-target="#clean-variable-names">Clean variable names</a></li>
  <li><a href="#clean-individual-fields" id="toc-clean-individual-fields" class="nav-link" data-scroll-target="#clean-individual-fields">Clean individual fields</a></li>
  <li><a href="#merge" id="toc-merge" class="nav-link" data-scroll-target="#merge">Merge</a>
  <ul class="collapse">
  <li><a href="#load-site-session-data" id="toc-load-site-session-data" class="nav-link" data-scroll-target="#load-site-session-data">Load site session data</a></li>
  <li><a href="#sharing-by-session-status" id="toc-sharing-by-session-status" class="nav-link" data-scroll-target="#sharing-by-session-status">Sharing by session status</a></li>
  </ul></li>
  <li><a href="#export-cleaned-file" id="toc-export-cleaned-file" class="nav-link" data-scroll-target="#export-cleaned-file">Export cleaned file</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/PLAY-behaviorome/KoBoToolbox/edit/main/src/screen-clean.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/PLAY-behaviorome/KoBoToolbox/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./screen-gather.html">Screening</a></li><li class="breadcrumb-item"><a href="./screen-clean.html"><span class="chapter-title">Clean</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Clean</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">September 13, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="setup" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="setup">Setup</h3>
<p>We source a set of cleaning functions have the <code>screen_</code> prefix.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk</span>(<span class="fu">list.files</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"R"</span>), </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"^screen_"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>), source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There are three CSV files to clean:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>(fn <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"../data/csv/screening"</span>, <span class="st">"[Dd]emographic"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "../data/csv/screening/275882_PLAY_Demographic_Questionnaire.csv"        
[2] "../data/csv/screening/334134_PLAY_Demographic_Questionnaire_Spanish.csv"
[3] "../data/csv/screening/359546_PLAY_Demographic_Questionnaire.csv"        </code></pre>
</div>
</div>
<p>We clean them separately, as needed, then merge them.</p>
</section>
<section id="clean-variable-names" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="clean-variable-names">Clean variable names</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(fn[<span class="dv">1</span>],</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">'c'</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(fn[<span class="dv">2</span>],</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">'c'</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(fn[<span class="dv">3</span>],</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">'c'</span>),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df1), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                        
 [2] "end"                                                                          
 [3] "c_today"                                                                      
 [4] "play_phone_questionnaire/update_date"                                         
 [5] "play_phone_questionnaire/group_contact_info/instructions_contactinfo"         
 [6] "play_phone_questionnaire/group_contact_info/parent_phone"                     
 [7] "play_phone_questionnaire/group_contact_info/parent_email"                     
 [8] "play_phone_questionnaire/group_contact_info/group_address/note_parent_address"
 [9] "play_phone_questionnaire/group_contact_info/group_address/parent_address_1"   
[10] "play_phone_questionnaire/group_contact_info/group_address/parent_address_2"   
[11] "play_phone_questionnaire/group_contact_info/group_address/city"               
[12] "play_phone_questionnaire/group_contact_info/group_address/state"              
[13] "play_phone_questionnaire/group_contact_info/acknowledge_contact_info"         
[14] "play_phone_questionnaire/instructions_guid"                                   
[15] "play_phone_questionnaire/child_first_name"                                    </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df2), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                                                                                                                                                                                    
 [2] "end"                                                                                                                                                                                                                                      
 [3] "c_today"                                                                                                                                                                                                                                  
 [4] "play_demo_questionnaire/update_date"                                                                                                                                                                                                      
 [5] "play_demo_questionnaire/NOTA_El_cuestionario_demogr_fico_debe_ser_completado_por_el_investigador_que_va_a_ir_a_la_visita_al_hogar_con_la_madre_por_tel_fono_La_madre_deber_a_ser_la_madre_que_va_a_participar_en_el_estudio_con_su_ni_o_a"
 [6] "play_demo_questionnaire/group_siteinfo/site_id"                                                                                                                                                                                           
 [7] "play_demo_questionnaire/group_siteinfo/subject_number"                                                                                                                                                                                    
 [8] "play_demo_questionnaire/exp_name"                                                                                                                                                                                                         
 [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"                                                                                                                                                                      
[10] "play_demo_questionnaire/group_contact_info/parent_phone"                                                                                                                                                                                  
[11] "play_demo_questionnaire/group_contact_info/parent_email"                                                                                                                                                                                  
[12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"                                                                                                                                                             
[13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"                                                                                                                                                                
[14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"                                                                                                                                                                
[15] "play_demo_questionnaire/group_contact_info/group_address/city"                                                                                                                                                                            </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df3), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                       
 [2] "end"                                                                         
 [3] "c_today"                                                                     
 [4] "play_demo_questionnaire/update_date"                                         
 [5] "play_demo_questionnaire/note_exp"                                            
 [6] "play_demo_questionnaire/group_siteinfo/site_id"                              
 [7] "play_demo_questionnaire/group_siteinfo/subject_number"                       
 [8] "play_demo_questionnaire/group_siteinfo/exp_name"                             
 [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"         
[10] "play_demo_questionnaire/group_contact_info/parent_phone"                     
[11] "play_demo_questionnaire/group_contact_info/parent_email"                     
[12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"
[13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"   
[14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"   
[15] "play_demo_questionnaire/group_contact_info/group_address/city"               </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df1), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                        
 [2] "end"                                                                          
 [3] "c_today"                                                                      
 [4] "play_phone_questionnaire/update_date"                                         
 [5] "play_phone_questionnaire/group_contact_info/instructions_contactinfo"         
 [6] "play_phone_questionnaire/group_contact_info/parent_phone"                     
 [7] "play_phone_questionnaire/group_contact_info/parent_email"                     
 [8] "play_phone_questionnaire/group_contact_info/group_address/note_parent_address"
 [9] "play_phone_questionnaire/group_contact_info/group_address/parent_address_1"   
[10] "play_phone_questionnaire/group_contact_info/group_address/parent_address_2"   
[11] "play_phone_questionnaire/group_contact_info/group_address/city"               
[12] "play_phone_questionnaire/group_contact_info/group_address/state"              
[13] "play_phone_questionnaire/group_contact_info/acknowledge_contact_info"         
[14] "play_phone_questionnaire/instructions_guid"                                   
[15] "play_phone_questionnaire/child_first_name"                                    </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df2), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                                                                                                                                                                                    
 [2] "end"                                                                                                                                                                                                                                      
 [3] "c_today"                                                                                                                                                                                                                                  
 [4] "play_demo_questionnaire/update_date"                                                                                                                                                                                                      
 [5] "play_demo_questionnaire/NOTA_El_cuestionario_demogr_fico_debe_ser_completado_por_el_investigador_que_va_a_ir_a_la_visita_al_hogar_con_la_madre_por_tel_fono_La_madre_deber_a_ser_la_madre_que_va_a_participar_en_el_estudio_con_su_ni_o_a"
 [6] "play_demo_questionnaire/group_siteinfo/site_id"                                                                                                                                                                                           
 [7] "play_demo_questionnaire/group_siteinfo/subject_number"                                                                                                                                                                                    
 [8] "play_demo_questionnaire/exp_name"                                                                                                                                                                                                         
 [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"                                                                                                                                                                      
[10] "play_demo_questionnaire/group_contact_info/parent_phone"                                                                                                                                                                                  
[11] "play_demo_questionnaire/group_contact_info/parent_email"                                                                                                                                                                                  
[12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"                                                                                                                                                             
[13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"                                                                                                                                                                
[14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"                                                                                                                                                                
[15] "play_demo_questionnaire/group_contact_info/group_address/city"                                                                                                                                                                            </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df3), <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "start"                                                                       
 [2] "end"                                                                         
 [3] "c_today"                                                                     
 [4] "play_demo_questionnaire/update_date"                                         
 [5] "play_demo_questionnaire/note_exp"                                            
 [6] "play_demo_questionnaire/group_siteinfo/site_id"                              
 [7] "play_demo_questionnaire/group_siteinfo/subject_number"                       
 [8] "play_demo_questionnaire/group_siteinfo/exp_name"                             
 [9] "play_demo_questionnaire/group_contact_info/instructions_contactinfo"         
[10] "play_demo_questionnaire/group_contact_info/parent_phone"                     
[11] "play_demo_questionnaire/group_contact_info/parent_email"                     
[12] "play_demo_questionnaire/group_contact_info/group_address/note_parent_address"
[13] "play_demo_questionnaire/group_contact_info/group_address/parent_address_1"   
[14] "play_demo_questionnaire/group_contact_info/group_address/parent_address_2"   
[15] "play_demo_questionnaire/group_contact_info/group_address/city"               </code></pre>
</div>
</div>
<!-- There are a separate set of variable-by-variable cleaning functions in `R/screen_clean_utils.R`. -->
<p>We remove the unneeded ’play_demo_*’ and ‘play_phone_questionnaire_’ variable headers using <code>screen_remove_variable_headers()</code>.</p>
<p>We next add Census FIPS codes for the home state and county so that we can link with county-level Census data at a later date. This depends on address, city, and state information.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Census queries stopped working around 2023-06-16, but should be restored as of 2024-09-13, using <code>R/screen_add_fips.R</code>.</p>
<p>It would be more efficient to query the Census geocoding database once.</p>
</div>
</div>
<p>We have name and address information in the screening data (e.g., ‘..parent_phone’, ‘..parent_email’, etc.). We remove this and other identifiable information using <code>screen_remove_identifiers()</code>.</p>
<p>We remove fields that contain administrative metadata with <code>screen_remove_metadata_fields()</code>.</p>
<p>We remove fields used only by staff in uploading data to Databrary using <code>screen_remove_databrary_fields()</code>.</p>
<p>Then, we use <code>dplyr::full_join()</code> to combine the set of individually cleaned data files. The <code>screen_clean_raw_csv()</code> function combines the previous <code>screen_remove*</code> functions. The <code>screen_clean_raw_join()</code> function cleans each CSV then joins them.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(scr_df <span class="ot">&lt;-</span> <span class="fu">screen_clean_raw_join</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/275882_PLAY_Demographic_Questionnaire.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stringr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Passing 8 addresses to the US Census batch geocoder</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Query completed in: 0.9 seconds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Removed n = 31 of 172 columns.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: dplyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/334134_PLAY_Demographic_Questionnaire_Spanish.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Passing 8 addresses to the US Census batch geocoder</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Query completed in: 0.8 seconds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Removed n = 47 of 240 columns.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Cleaning '/Users/rog1/rrr/KoBoToolbox/data/csv/screening/359546_PLAY_Demographic_Questionnaire.csv'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Passing 942 addresses to the US Census batch geocoder</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Query completed in: 36.2 seconds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Removed n = 47 of 243 columns.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(start, end, c_today, update_date, site_id,
subject_number, state, check_childage, check_childage_weeks, child_sex, day,
day2, day1, play_id, language_spoken_mom, `language_spoken_mom/english`,
`language_spoken_mom/spanish`, `language_spoken_mom/other`,
language_spoken_mom_other, language_spoken_child,
`language_spoken_child/english`, `language_spoken_child/spanish`,
`language_spoken_child/other`, language_spoken_child_other,
language_spoken_house, `language_spoken_house/english`,
`language_spoken_house/spanish`, `language_spoken_house/other`,
language_spoken_house_other, `child_information/child_bornonduedate`,
`child_information/child_onterm`, `child_information/child_duedate`,
`child_information/child_birthage`, `child_information/child_weight_pounds`,
`child_information/child_weight_ounces`,
`child_information/child_birth_complications`,
`child_information/specify_birth_complications`,
`child_information/hearing_disabilities`, `child_information/specify_hearing`,
`child_information/vision_disabilities`, `child_information/specify_vision`,
`child_information/major_illnesses_injuries`,
`child_information/specify_illnesses_injuries`,
`child_information/other_developmentaldelays`,
`child_information/specify_developmentaldelays`,
`child_information/child_race`, `child_information/child_sleep_time`,
`child_information/child_wake_time`, `child_information/child_nap_hours`,
`child_information/child_sleep_location`,
`child_information/specify_child_sleep_location`,
`child_information/indicate_child`, `child_information/indicate_child_2`,
`group_family_structure/only_child`,
`group_family_structure/specify_onlychild`,
`group_family_structure/household_members`,
`group_family_structure/household_members/father_biological`,
`group_family_structure/household_members/male_partner`,
`group_family_structure/household_members/mother_biological`,
`group_family_structure/household_members/female_partner`,
`group_family_structure/household_members/other_partner`,
`group_family_structure/household_members/sibling_biological`,
`group_family_structure/household_members/sibling_nonbiological`,
`group_family_structure/household_members/grandmother`,
`group_family_structure/household_members/grandfather`,
`group_family_structure/household_members/great_grandmother`,
`group_family_structure/household_members/great_grandfather`,
`group_family_structure/household_members/aunt`,
`group_family_structure/household_members/uncle`,
`group_family_structure/household_members/cousin`,
`group_family_structure/household_members/relative`,
`group_family_structure/household_members/non_relative`,
`group_family_structure/household_members/none`,
`group_family_structure/other_relatives`,
`group_family_structure/other_non_relatives`,
`group_family_structure/indicate_familystructure`,
`group_mominfo/mom_biological`, `group_mominfo/mom_relation`,
`group_mominfo/mom_datecare`, `group_mominfo/mom_childbirth_age`,
`group_mominfo/check_mom_childbirth_age`, `group_mominfo/mom_race`,
`group_mominfo/mom_birth_country`, `group_mominfo/specify_mom_birth_country`,
`group_mominfo/mom_education`, `group_mominfo/mom_employment`,
`group_mominfo/mom_occupation`, `group_mominfo/mom_jobs_number`,
`group_mominfo/mom_training`, `group_mominfo/mom_condition`,
`group_mominfo/specify_mom_condition`, `group_mominfo/indicate_mom`,
`group_biodad/biodad_childbirth_age`,
`group_biodad/check_biodad_childbirth_age`, `group_biodad/biodad_race`,
`group_biodad/indicate_biodad`, `group_biomom/biomom_childbirth_age`,
`group_biomom/check_biomom_childbirth_age`, `group_biomom/biomom_race`,
`group_biomom/indicate_biomom`, `group_nonbiopartner/nonbiopartner_race`,
`group_nonbiopartner/indicate_nonbiopartner`,
`group_genpartner_info/partner_education`,
`group_genpartner_info/partner_employment`,
`group_genpartner_info/partner_occupation`,
`group_genpartner_info/partner_jobs_number`,
`group_genpartner_info/partner_program`,
`group_genpartner_info/indicate_genpartner`,
`group_child_care_arrangements/childcare_types`,
`group_child_care_arrangements/childcare_types/nanny_home`,
`group_child_care_arrangements/childcare_types/nanny_nothome`,
`group_child_care_arrangements/childcare_types/relative`,
`group_child_care_arrangements/childcare_types/childcare`,
`group_child_care_arrangements/childcare_types/none`,
`group_child_care_arrangements/childcare_location`,
`group_child_care_arrangements/childcare_hours`,
`group_child_care_arrangements/childcare_number`,
`group_child_care_arrangements/childcare_age`,
`group_child_care_arrangements/childcare_language`,
`group_inclusioncheck/inclusionreason`,
`group_inclusioncheck/indicate_inclusion`, indicate_demoquestionnaire,
indicate_databrary, `_id`, state_fips, county_fips, fips_state, fips_county)`
Joining with `by = join_by(start, end, c_today, update_date, site_id,
subject_number, state, check_childage, check_childage_weeks, child_sex, day,
day2, day1, language_spoken_child, `language_spoken_child/english`,
`language_spoken_child/spanish`, `language_spoken_child/other`,
language_spoken_child_other, `child_information/child_bornonduedate`,
`child_information/child_onterm`, `child_information/child_duedate`,
`child_information/child_birthage`, `child_information/child_weight_pounds`,
`child_information/child_weight_ounces`,
`child_information/child_birth_complications`,
`child_information/specify_birth_complications`,
`child_information/hearing_disabilities`, `child_information/specify_hearing`,
`child_information/vision_disabilities`, `child_information/specify_vision`,
`child_information/major_illnesses_injuries`,
`child_information/specify_illnesses_injuries`,
`child_information/child_sleep_time`, `child_information/child_wake_time`,
`child_information/child_nap_hours`, `child_information/child_sleep_location`,
`child_information/specify_child_sleep_location`,
`child_information/indicate_child`, `child_information/indicate_child_2`,
`group_family_structure/household_members`,
`group_family_structure/household_members/male_partner`,
`group_family_structure/household_members/female_partner`,
`group_family_structure/household_members/other_partner`,
`group_family_structure/household_members/grandmother`,
`group_family_structure/household_members/grandfather`,
`group_family_structure/household_members/great_grandmother`,
`group_family_structure/household_members/great_grandfather`,
`group_family_structure/household_members/aunt`,
`group_family_structure/household_members/uncle`,
`group_family_structure/household_members/cousin`,
`group_family_structure/household_members/relative`,
`group_family_structure/household_members/non_relative`,
`group_family_structure/other_relatives`,
`group_family_structure/other_non_relatives`,
`group_family_structure/indicate_familystructure`,
`group_child_care_arrangements/childcare_types`,
`group_child_care_arrangements/childcare_types/relative`,
`group_child_care_arrangements/childcare_types/childcare`,
`group_child_care_arrangements/childcare_types/none`,
`group_child_care_arrangements/childcare_hours`,
`group_child_care_arrangements/childcare_number`,
`group_child_care_arrangements/childcare_age`,
`group_child_care_arrangements/childcare_language`, `_id`, state_fips,
county_fips, fips_state, fips_county)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 974 × 166
   start   end   c_today update_date site_id subject_number state check_childage
   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;         
 1 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   230            New … 32.6772408503…
 2 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   229            New … 32.3813828621…
 3 2019-1… 2020… 2020-0… &lt;NA&gt;        VCOMU   002            VA    26.7258382642…
 4 2020-0… 2020… 2020-0… &lt;NA&gt;        GEORG   010            Virg… 12.7547666009…
 5 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   008            New … 13.4122287968…
 6 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   009            New … 19.3636313828…
 7 2020-0… 2020… 2020-0… &lt;NA&gt;        GEORG   011            Virg… 17.8514683322…
 8 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   010            NY    17.8514683322…
 9 2020-0… 2020… 2020-0… &lt;NA&gt;        NYUNI   011            New … 23.8001314924…
10 2020-0… 2020… 2020-0… &lt;NA&gt;        VCOMU   003            VA    17.5884834538…
# ℹ 964 more rows
# ℹ 158 more variables: check_childage_weeks &lt;chr&gt;, child_sex &lt;chr&gt;, day &lt;chr&gt;,
#   day2 &lt;chr&gt;, day1 &lt;chr&gt;, play_id &lt;chr&gt;, language_spoken_mom &lt;chr&gt;,
#   `language_spoken_mom/english` &lt;chr&gt;, `language_spoken_mom/spanish` &lt;chr&gt;,
#   `language_spoken_mom/other` &lt;chr&gt;, language_spoken_mom_other &lt;chr&gt;,
#   language_spoken_child &lt;chr&gt;, `language_spoken_child/english` &lt;chr&gt;,
#   `language_spoken_child/spanish` &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="clean-individual-fields" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="clean-individual-fields">Clean individual fields</h3>
<p>Now, we can proceed to clean-up the merged data frame. The sequence of functions called below cleans ‘construct-specific’ variables as indicated by the function names.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>scr_df <span class="ot">&lt;-</span> scr_df <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_child_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_lang_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_mom_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_biodad_father_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_childcare_info</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_family_structure</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_clean_play_id</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_remove_selected_cols</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">screen_select_reorder_cols</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For convenience, we package this sequence in its own function, <code>screen_clean_fields()</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that all of the variables are considered character strings. The <code>tidyverse</code> suite does a great job of guessing what variables are what, but sometimes it guesses wrongly. So, in preliminary stages, it has proved easier to make everything a character string.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>scr_df <span class="ot">&lt;-</span> <span class="fu">screen_clean_fields</span>(scr_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidyr</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(scr_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [974 × 51] (S3: tbl_df/tbl/data.frame)
 $ submit_date                       : chr [1:974] "2020-02-27T08:24:10.551-05:00" "2020-02-27T08:43:34.275-05:00" "2019-12-18T16:37:17.554-05:00" "2020-01-01T12:54:04.550-05:00" ...
 $ site_id                           : chr [1:974] "NYUNI" "NYUNI" "VCOMU" "GEORG" ...
 $ participant_ID                    : chr [1:974] "230" "229" "002" "010" ...
 $ play_id                           : chr [1:974] NA NA NA NA ...
 $ child_age_mos                     : chr [1:974] "32.677240850317695" "32.38138286215201" "26.725838264299803" "12.754766600920446" ...
 $ child_sex                         : chr [1:974] "male" "female" "female" "male" ...
 $ child_bornonduedate               : chr [1:974] "yes" "yes" "yes" "yes" ...
 $ child_onterm                      : chr [1:974] NA NA NA NA ...
 $ child_birthage                    : chr [1:974] "-7" "-10" "0" "1" ...
 $ child_weight_pounds               : chr [1:974] "8" "7" "6" "7" ...
 $ child_weight_ounces               : chr [1:974] "12" "10" "12" "15" ...
 $ child_birth_complications         : chr [1:974] "no" "no" "no" "no" ...
 $ child_birth_complications_specify : chr [1:974] NA NA NA NA ...
 $ child_hearing_disabilities        : chr [1:974] "yes" "no" "no" "no" ...
 $ child_hearing_disabilities_specify: chr [1:974] "Temporary hearing loss so tubes in his ears, one still remaining" NA NA NA ...
 $ child_vision_disabilities         : chr [1:974] "no" "no" "no" "no" ...
 $ child_vision_disabilities_specify : chr [1:974] NA NA NA NA ...
 $ child_major_illnesses_injuries    : chr [1:974] "yes" "no" "no" "no" ...
 $ child_illnesses_injuries_specify  : chr [1:974] "Pneumonia at 5 months" "" "" "" ...
 $ child_developmentaldelays         : chr [1:974] NA NA NA NA ...
 $ child_developmentaldelays_specify : chr [1:974] NA NA NA NA ...
 $ child_sleep_time                  : chr [1:974] "20:15:00.000-05:00" "20:15:00.000-05:00" "19:00:00.000-05:00" "19:00:00.000-05:00" ...
 $ child_wake_time                   : chr [1:974] "07:15:00.000-05:00" "06:45:00.000-05:00" "07:30:00.000-05:00" "06:15:00.000-05:00" ...
 $ child_nap_hours                   : chr [1:974] "2" "3" "1.5" "2" ...
 $ child_sleep_location              : chr [1:974] "crib_separate" "crib_separate" "crib_separate" "crib_separate" ...
 $ mom_bio                           : chr [1:974] "yes" "yes" "yes" "yes" ...
 $ mom_childbirth_age                : chr [1:974] "33.41" "38.84" "32.2" "30.38" ...
 $ mom_race                          : chr [1:974] "white" "white" "white" "white" ...
 $ mom_birth_country                 : chr [1:974] "unitedstates" "unitedstates" "unitedstates" "unitedstates" ...
 $ mom_birth_country_specify         : chr [1:974] "" "" "" "" ...
 $ mom_education                     : chr [1:974] "masters" "doctorate" "doctorate" "masters" ...
 $ mom_employment                    : chr [1:974] "full_time" "full_time" "full_time" "full_time" ...
 $ mom_occupation                    : chr [1:974] "Architect" "Spanish teacher" "Nurse instructor" "School Psychologist" ...
 $ mom_jobs_number                   : chr [1:974] "1" "1" "1" "1" ...
 $ mom_training                      : chr [1:974] "no" "no" "no" "no" ...
 $ biodad_childbirth_age             : chr [1:974] "33.85_NA" "30.42_NA" "37.32_NA" "30.53_NA" ...
 $ biodad_race                       : chr [1:974] "white_NA" "white_NA" "NA_NA" "NA_NA" ...
 $ language_spoken_mom               : chr [1:974] "english" "english spanish" "english" "english" ...
 $ language_spoken_mom_comments      : chr [1:974] NA NA NA NA ...
 $ language_spoken_child             : chr [1:974] "english" "spanish" "english" "english" ...
 $ language_spoken_home_comments     : chr [1:974] "FALSE_47706996" "TRUE_47707423" "FALSE_43397823" "FALSE_44074192" ...
 $ language_spoken_child_comments    : chr [1:974] NA NA NA NA ...
 $ language_spoken_home              : chr [1:974] "english" "english spanish" "english" "english" ...
 $ language_spoken_house_other       : chr [1:974] NA NA NA NA ...
 $ language_spoken_home_other        : chr [1:974] NA NA NA NA ...
 $ childcare_types                   : chr [1:974] NA NA NA NA ...
 $ childcare_location                : chr [1:974] NA NA NA NA ...
 $ childcare_hours                   : chr [1:974] NA NA NA NA ...
 $ childcare_number                  : chr [1:974] NA NA NA NA ...
 $ childcare_age                     : chr [1:974] NA NA NA NA ...
 $ childcare_language                : chr [1:974] NA NA NA NA ...</code></pre>
</div>
</div>
<p>There is more work to do, but we have a version worth exporting.</p>
</section>
<section id="merge" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="merge">Merge</h2>
<p>Let’s add the Databrary volume ID info.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>scr_df <span class="ot">&lt;-</span> scr_df <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">screen_add_db_vol_id</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then filter out rows that do not have valid volume IDs.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>valid_db_vol <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(scr_df<span class="sc">$</span>vol_id)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>scr_df <span class="ot">&lt;-</span> scr_df[valid_db_vol,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There are <em>n=</em>970 valid Databrary volume IDs out of a total of <em>n</em>=974 screening records.</p>
<p>Next, we add a <code>play_status</code> field based on the <code>group-name</code> field from Databrary. We use <code>group-name</code> for indicating “Gold”, “Silver”, or “Not run.”</p>
<p>Two targets in <code>_targets.R</code> are relevant for this operation:</p>
<pre><code>  tar_target(
    play_vols_df,
    readr::read_csv("data/csv/_meta/play_site_vols.csv",
                    show_col_types = FALSE)
  ),
  tar_target(
    databrary_session_csvs,
    purrr::map(play_vols_df$site_id, databrary_get_save_session_csv),
    cue = tarchetypes::tar_cue_age(
      name = databrary_session_csvs,
      age = as.difftime(update_interval, units = update_interval_units)
    )
  )
</code></pre>
<p>These targets generate site-specific CSVs in <code>data/csv/site_sessions</code> based on the database of PLAY sites contained in <code>data/csv/_meta/play_site_vols.csv</code>. We load these CSVs into a single data frame.</p>
<section id="load-site-session-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="load-site-session-data">Load site session data</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>session_fns <span class="ot">&lt;-</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">"../data/csv/site_sessions"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">.csv$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="ot">&lt;-</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    session_fns,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span>read_csv,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">'c'</span>),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">list_rbind</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>group_name</code> variable contains status information about the sessions.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> group_name, <span class="at">data=</span>df_sessions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>group_name
   No visit    No_visit    No_Visit   PLAY_Gold PLAY_Silver 
          1          49          88         739         122 </code></pre>
</div>
</div>
<p>We note that there are three different versions of no visit: “No visit”, “No_visit”, and “No_Visit”. In addition, there are <em>n</em>=33 sessions with NA in the <code>group_name</code>.</p>
<p>Let’s modify those values that specify no visit on one of these forms to conform with one another.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="ot">&lt;-</span> df_sessions <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group_name =</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(group_name, <span class="st">"No.*isit"</span>, <span class="st">"No_visit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These could be sessions that are still in QA or which are scheduled, or there could be some other anomaly. Here, we want to select only those sessions that occurred and which have passed QA–those sessions for which <code>group_name</code> is either ‘PLAY_Gold’ or ‘PLAY_Silver’.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="ot">&lt;-</span> df_sessions <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(group_name, <span class="st">"PLAY_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sharing-by-session-status" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sharing-by-session-status">Sharing by session status</h3>
<p>Here is information about the sharing status.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> group_name <span class="sc">+</span> session_release, df_sessions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             session_release
group_name    EXCERPTS PRIVATE SHARED
  PLAY_Gold        579       0    160
  PLAY_Silver       85       4     33</code></pre>
</div>
</div>
<p>There was one session marked <code>PRIVATE</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(session_release <span class="sc">==</span> <span class="st">"PRIVATE"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(vol_id, session_id, session_name, group_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  vol_id session_id session_name   group_name 
  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;      
1 1656   70116      PLAY_ASUNI_001 PLAY_Silver
2 979    66932      PLAY_PRINU_024 PLAY_Silver
3 1397   70234      PLAY_UHOUS_035 PLAY_Silver
4 1422   72657      PLAY_UIOWA_025 PLAY_Silver</code></pre>
</div>
</div>
<p>Now, we join the screening data with the Databrary session data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>screen_datab_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(df_sessions, scr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'vol_id'</span>, <span class="st">'participant_ID'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s do some additional cleaning of redundant column names, e.g., exclusion.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>screen_datab_df <span class="ot">&lt;-</span> screen_datab_df <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unite</span>(exclusion_reason, <span class="fu">c</span>(<span class="st">"exclusion1_reason"</span>, <span class="st">"exclusion2_reason"</span>, <span class="st">"exclusion_reason"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">exclusion_reason =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(exclusion_reason, <span class="st">"NA|_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="export-cleaned-file" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="export-cleaned-file">Export cleaned file</h2>
<p>We date-stamp the exported file so we can monitor progress as this workflow develops.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>sfn <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"PLAY-screening-datab-"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(screen_datab_df, <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"data/csv/screening/agg/"</span>, sfn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We also save a copy with “latest”.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>sfn <span class="ot">&lt;-</span> <span class="st">"PLAY-screening-datab-latest.csv"</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(screen_datab_df, <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"data/csv/screening/agg/"</span>, sfn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./screen-gather.html" class="pagination-link" aria-label="Gather">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Gather</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./screen-viz.html" class="pagination-link" aria-label="Visualize">
        <span class="nav-page-text"><span class="chapter-title">Visualize</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb58" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Clean</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup {-}</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>We source a set of cleaning functions have the <span class="in">`screen_`</span> prefix.</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk</span>(<span class="fu">list.files</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"R"</span>), </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"^screen_"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>), source)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>There are three CSV files to clean:</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>(fn <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"../data/csv/screening"</span>, <span class="st">"[Dd]emographic"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>We clean them separately, as needed, then merge them.</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clean variable names {-}</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r read-screening-csvs}</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a><span class="in">df1 &lt;-</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="in">  readr::read_csv(fn[1],</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="in">                  col_types = readr::cols(.default = 'c'),</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a><span class="in">                  show_col_types = FALSE)</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="in">df2 &lt;-</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="in">  readr::read_csv(fn[2],</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="in">                  col_types = readr::cols(.default = 'c'),</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a><span class="in">                  show_col_types = FALSE)</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="in">df3 &lt;-</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a><span class="in">  readr::read_csv(fn[3],</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a><span class="in">                  col_types = readr::cols(.default = 'c'),</span></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a><span class="in">                  show_col_types = FALSE)</span></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df1), <span class="dv">15</span>)</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df2), <span class="dv">15</span>)</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df3), <span class="dv">15</span>)</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df1), <span class="dv">15</span>)</span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df2), <span class="dv">15</span>)</span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(df3), <span class="dv">15</span>)</span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- There are a separate set of variable-by-variable cleaning functions in `R/screen_clean_utils.R`. --&gt;</span></span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a>We remove the unneeded 'play_demo_*' and 'play_phone_questionnaire_' variable headers using <span class="in">`screen_remove_variable_headers()`</span>.</span>
<span id="cb58-80"><a href="#cb58-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-81"><a href="#cb58-81" aria-hidden="true" tabindex="-1"></a>We next add Census FIPS codes for the home state and county so that we can link with county-level Census data at a later date.</span>
<span id="cb58-82"><a href="#cb58-82" aria-hidden="true" tabindex="-1"></a>This depends on address, city, and state information.</span>
<span id="cb58-83"><a href="#cb58-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-84"><a href="#cb58-84" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb58-85"><a href="#cb58-85" aria-hidden="true" tabindex="-1"></a>The Census queries stopped working around 2023-06-16, but should be restored as of 2024-09-13, using <span class="in">`R/screen_add_fips.R`</span>.</span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a>It would be more efficient to query the Census geocoding database once.</span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a>We have name and address information in the screening data (e.g., '..parent_phone', '..parent_email', etc.).</span>
<span id="cb58-91"><a href="#cb58-91" aria-hidden="true" tabindex="-1"></a>We remove this and other identifiable information using <span class="in">`screen_remove_identifiers()`</span>.</span>
<span id="cb58-92"><a href="#cb58-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-93"><a href="#cb58-93" aria-hidden="true" tabindex="-1"></a>We remove fields that contain administrative metadata with <span class="in">`screen_remove_metadata_fields()`</span>.</span>
<span id="cb58-94"><a href="#cb58-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-95"><a href="#cb58-95" aria-hidden="true" tabindex="-1"></a>We remove fields used only by staff in uploading data to Databrary using <span class="in">`screen_remove_databrary_fields()`</span>.</span>
<span id="cb58-96"><a href="#cb58-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-97"><a href="#cb58-97" aria-hidden="true" tabindex="-1"></a>Then, we use <span class="in">`dplyr::full_join()`</span> to combine the set of individually </span>
<span id="cb58-98"><a href="#cb58-98" aria-hidden="true" tabindex="-1"></a>cleaned data files.</span>
<span id="cb58-99"><a href="#cb58-99" aria-hidden="true" tabindex="-1"></a>The <span class="in">`screen_clean_raw_csv()`</span> function combines the previous <span class="in">`screen_remove*`</span> functions.</span>
<span id="cb58-100"><a href="#cb58-100" aria-hidden="true" tabindex="-1"></a>The <span class="in">`screen_clean_raw_join()`</span> function cleans each CSV then joins them.</span>
<span id="cb58-101"><a href="#cb58-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-102"><a href="#cb58-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clean-screening-join}</span></span>
<span id="cb58-103"><a href="#cb58-103" aria-hidden="true" tabindex="-1"></a><span class="in">(scr_df &lt;- screen_clean_raw_join())</span></span>
<span id="cb58-104"><a href="#cb58-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-105"><a href="#cb58-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-106"><a href="#cb58-106" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clean individual fields {-}</span></span>
<span id="cb58-107"><a href="#cb58-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-108"><a href="#cb58-108" aria-hidden="true" tabindex="-1"></a>Now, we can proceed to clean-up the merged data frame.</span>
<span id="cb58-109"><a href="#cb58-109" aria-hidden="true" tabindex="-1"></a>The sequence of functions called below cleans 'construct-specific' variables</span>
<span id="cb58-110"><a href="#cb58-110" aria-hidden="true" tabindex="-1"></a>as indicated by the function names.</span>
<span id="cb58-111"><a href="#cb58-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-112"><a href="#cb58-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-screening-field-cleaning, eval=FALSE}</span></span>
<span id="cb58-113"><a href="#cb58-113" aria-hidden="true" tabindex="-1"></a><span class="in">scr_df &lt;- scr_df |&gt; </span></span>
<span id="cb58-114"><a href="#cb58-114" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_clean_child_info() |&gt;</span></span>
<span id="cb58-115"><a href="#cb58-115" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_clean_lang_info() |&gt;</span></span>
<span id="cb58-116"><a href="#cb58-116" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_clean_mom_info() |&gt;</span></span>
<span id="cb58-117"><a href="#cb58-117" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_clean_biodad_father_info() |&gt;</span></span>
<span id="cb58-118"><a href="#cb58-118" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_clean_childcare_info() |&gt;</span></span>
<span id="cb58-119"><a href="#cb58-119" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_clean_family_structure() |&gt;</span></span>
<span id="cb58-120"><a href="#cb58-120" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_clean_play_id() |&gt;</span></span>
<span id="cb58-121"><a href="#cb58-121" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_remove_selected_cols() |&gt;</span></span>
<span id="cb58-122"><a href="#cb58-122" aria-hidden="true" tabindex="-1"></a><span class="in">    screen_select_reorder_cols()</span></span>
<span id="cb58-123"><a href="#cb58-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-124"><a href="#cb58-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-125"><a href="#cb58-125" aria-hidden="true" tabindex="-1"></a>For convenience, we package this sequence in its own function, <span class="in">`screen_clean_fields()`</span>.</span>
<span id="cb58-126"><a href="#cb58-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-127"><a href="#cb58-127" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb58-128"><a href="#cb58-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-129"><a href="#cb58-129" aria-hidden="true" tabindex="-1"></a>Note that all of the variables are considered character strings. The <span class="in">`tidyverse`</span></span>
<span id="cb58-130"><a href="#cb58-130" aria-hidden="true" tabindex="-1"></a>suite does a great job of guessing what variables are what, but sometimes it</span>
<span id="cb58-131"><a href="#cb58-131" aria-hidden="true" tabindex="-1"></a>guesses wrongly. So, in preliminary stages, it has proved easier to make everything</span>
<span id="cb58-132"><a href="#cb58-132" aria-hidden="true" tabindex="-1"></a>a character string.</span>
<span id="cb58-133"><a href="#cb58-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-134"><a href="#cb58-134" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-135"><a href="#cb58-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-136"><a href="#cb58-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clean-merged-screen-fields}</span></span>
<span id="cb58-137"><a href="#cb58-137" aria-hidden="true" tabindex="-1"></a><span class="in">scr_df &lt;- screen_clean_fields(scr_df)</span></span>
<span id="cb58-138"><a href="#cb58-138" aria-hidden="true" tabindex="-1"></a><span class="in">str(scr_df)</span></span>
<span id="cb58-139"><a href="#cb58-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-140"><a href="#cb58-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-141"><a href="#cb58-141" aria-hidden="true" tabindex="-1"></a>There is more work to do, but we have a version worth exporting.</span>
<span id="cb58-142"><a href="#cb58-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-143"><a href="#cb58-143" aria-hidden="true" tabindex="-1"></a><span class="fu">## Merge {-}</span></span>
<span id="cb58-144"><a href="#cb58-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-145"><a href="#cb58-145" aria-hidden="true" tabindex="-1"></a>Let's add the Databrary volume ID info.</span>
<span id="cb58-146"><a href="#cb58-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-147"><a href="#cb58-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-db-vol-id}</span></span>
<span id="cb58-148"><a href="#cb58-148" aria-hidden="true" tabindex="-1"></a><span class="in">scr_df &lt;- scr_df |&gt;</span></span>
<span id="cb58-149"><a href="#cb58-149" aria-hidden="true" tabindex="-1"></a><span class="in">  screen_add_db_vol_id()</span></span>
<span id="cb58-150"><a href="#cb58-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-151"><a href="#cb58-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-152"><a href="#cb58-152" aria-hidden="true" tabindex="-1"></a>Then filter out rows that do not have valid volume IDs.</span>
<span id="cb58-153"><a href="#cb58-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-154"><a href="#cb58-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-invalid-db-vol-ids}</span></span>
<span id="cb58-155"><a href="#cb58-155" aria-hidden="true" tabindex="-1"></a><span class="in">valid_db_vol &lt;- !is.na(scr_df$vol_id)</span></span>
<span id="cb58-156"><a href="#cb58-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-157"><a href="#cb58-157" aria-hidden="true" tabindex="-1"></a><span class="in">scr_df &lt;- scr_df[valid_db_vol,]</span></span>
<span id="cb58-158"><a href="#cb58-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-159"><a href="#cb58-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-160"><a href="#cb58-160" aria-hidden="true" tabindex="-1"></a>There are *n=*`{r} sum(valid_db_vol)` valid Databrary volume IDs out of a total of *n*=<span class="in">`r length(valid_db_vol)`</span> screening records.</span>
<span id="cb58-161"><a href="#cb58-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-162"><a href="#cb58-162" aria-hidden="true" tabindex="-1"></a>Next, we add a <span class="in">`play_status`</span> field based on the <span class="in">`group-name`</span> field from Databrary.</span>
<span id="cb58-163"><a href="#cb58-163" aria-hidden="true" tabindex="-1"></a>We use <span class="in">`group-name`</span> for indicating "Gold", "Silver", or "Not run."</span>
<span id="cb58-164"><a href="#cb58-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-165"><a href="#cb58-165" aria-hidden="true" tabindex="-1"></a>Two targets in <span class="in">`_targets.R`</span> are relevant for this operation:</span>
<span id="cb58-166"><a href="#cb58-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-167"><a href="#cb58-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-168"><a href="#cb58-168" aria-hidden="true" tabindex="-1"></a><span class="in">  tar_target(</span></span>
<span id="cb58-169"><a href="#cb58-169" aria-hidden="true" tabindex="-1"></a><span class="in">    play_vols_df,</span></span>
<span id="cb58-170"><a href="#cb58-170" aria-hidden="true" tabindex="-1"></a><span class="in">    readr::read_csv("data/csv/_meta/play_site_vols.csv",</span></span>
<span id="cb58-171"><a href="#cb58-171" aria-hidden="true" tabindex="-1"></a><span class="in">                    show_col_types = FALSE)</span></span>
<span id="cb58-172"><a href="#cb58-172" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb58-173"><a href="#cb58-173" aria-hidden="true" tabindex="-1"></a><span class="in">  tar_target(</span></span>
<span id="cb58-174"><a href="#cb58-174" aria-hidden="true" tabindex="-1"></a><span class="in">    databrary_session_csvs,</span></span>
<span id="cb58-175"><a href="#cb58-175" aria-hidden="true" tabindex="-1"></a><span class="in">    purrr::map(play_vols_df$site_id, databrary_get_save_session_csv),</span></span>
<span id="cb58-176"><a href="#cb58-176" aria-hidden="true" tabindex="-1"></a><span class="in">    cue = tarchetypes::tar_cue_age(</span></span>
<span id="cb58-177"><a href="#cb58-177" aria-hidden="true" tabindex="-1"></a><span class="in">      name = databrary_session_csvs,</span></span>
<span id="cb58-178"><a href="#cb58-178" aria-hidden="true" tabindex="-1"></a><span class="in">      age = as.difftime(update_interval, units = update_interval_units)</span></span>
<span id="cb58-179"><a href="#cb58-179" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb58-180"><a href="#cb58-180" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb58-181"><a href="#cb58-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-182"><a href="#cb58-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-183"><a href="#cb58-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-184"><a href="#cb58-184" aria-hidden="true" tabindex="-1"></a>These targets generate site-specific CSVs in <span class="in">`data/csv/site_sessions`</span> based on the database of PLAY sites contained in <span class="in">`data/csv/_meta/play_site_vols.csv`</span>.</span>
<span id="cb58-185"><a href="#cb58-185" aria-hidden="true" tabindex="-1"></a>We load these CSVs into a single data frame.</span>
<span id="cb58-186"><a href="#cb58-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-187"><a href="#cb58-187" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load site session data {-}</span></span>
<span id="cb58-188"><a href="#cb58-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-189"><a href="#cb58-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-db-status}</span></span>
<span id="cb58-190"><a href="#cb58-190" aria-hidden="true" tabindex="-1"></a><span class="in">session_fns &lt;-</span></span>
<span id="cb58-191"><a href="#cb58-191" aria-hidden="true" tabindex="-1"></a><span class="in">  list.files("../data/csv/site_sessions", "\\.csv$", full.names = TRUE)</span></span>
<span id="cb58-192"><a href="#cb58-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-193"><a href="#cb58-193" aria-hidden="true" tabindex="-1"></a><span class="in">df_sessions &lt;-</span></span>
<span id="cb58-194"><a href="#cb58-194" aria-hidden="true" tabindex="-1"></a><span class="in">  purrr::map(</span></span>
<span id="cb58-195"><a href="#cb58-195" aria-hidden="true" tabindex="-1"></a><span class="in">    session_fns,</span></span>
<span id="cb58-196"><a href="#cb58-196" aria-hidden="true" tabindex="-1"></a><span class="in">    readr::read_csv,</span></span>
<span id="cb58-197"><a href="#cb58-197" aria-hidden="true" tabindex="-1"></a><span class="in">    col_types = readr::cols(.default = 'c'),</span></span>
<span id="cb58-198"><a href="#cb58-198" aria-hidden="true" tabindex="-1"></a><span class="in">    show_col_types = FALSE</span></span>
<span id="cb58-199"><a href="#cb58-199" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb58-200"><a href="#cb58-200" aria-hidden="true" tabindex="-1"></a><span class="in">  purrr::list_rbind()</span></span>
<span id="cb58-201"><a href="#cb58-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-202"><a href="#cb58-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-203"><a href="#cb58-203" aria-hidden="true" tabindex="-1"></a>The <span class="in">`group_name`</span> variable contains status information about the sessions.</span>
<span id="cb58-204"><a href="#cb58-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-207"><a href="#cb58-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-208"><a href="#cb58-208" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> group_name, <span class="at">data=</span>df_sessions)</span>
<span id="cb58-209"><a href="#cb58-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-210"><a href="#cb58-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-211"><a href="#cb58-211" aria-hidden="true" tabindex="-1"></a>We note that there are three different versions of no visit: "No visit", "No_visit", and "No_Visit". </span>
<span id="cb58-212"><a href="#cb58-212" aria-hidden="true" tabindex="-1"></a>In addition, there are *n*=<span class="in">`r sum(is.na(df_sessions$group_name))`</span> sessions with NA in the <span class="in">`group_name`</span>.</span>
<span id="cb58-213"><a href="#cb58-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-214"><a href="#cb58-214" aria-hidden="true" tabindex="-1"></a>Let's modify those values that specify no visit on one of these forms to conform with one another.</span>
<span id="cb58-215"><a href="#cb58-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-218"><a href="#cb58-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-219"><a href="#cb58-219" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="ot">&lt;-</span> df_sessions <span class="sc">|&gt;</span></span>
<span id="cb58-220"><a href="#cb58-220" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group_name =</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(group_name, <span class="st">"No.*isit"</span>, <span class="st">"No_visit"</span>))</span>
<span id="cb58-221"><a href="#cb58-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-222"><a href="#cb58-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-223"><a href="#cb58-223" aria-hidden="true" tabindex="-1"></a>These could be sessions that are still in QA or which are scheduled, or there could be some other anomaly.</span>
<span id="cb58-224"><a href="#cb58-224" aria-hidden="true" tabindex="-1"></a>Here, we want to select only those sessions that occurred and which have passed QA--those sessions for which <span class="in">`group_name`</span> is either 'PLAY_Gold' or 'PLAY_Silver'.</span>
<span id="cb58-225"><a href="#cb58-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-228"><a href="#cb58-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-229"><a href="#cb58-229" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="ot">&lt;-</span> df_sessions <span class="sc">|&gt;</span></span>
<span id="cb58-230"><a href="#cb58-230" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(group_name, <span class="st">"PLAY_"</span>))</span>
<span id="cb58-231"><a href="#cb58-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-232"><a href="#cb58-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-233"><a href="#cb58-233" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sharing by session status {-}</span></span>
<span id="cb58-234"><a href="#cb58-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-235"><a href="#cb58-235" aria-hidden="true" tabindex="-1"></a>Here is information about the sharing status.</span>
<span id="cb58-236"><a href="#cb58-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-239"><a href="#cb58-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-240"><a href="#cb58-240" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> group_name <span class="sc">+</span> session_release, df_sessions)</span>
<span id="cb58-241"><a href="#cb58-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-242"><a href="#cb58-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-243"><a href="#cb58-243" aria-hidden="true" tabindex="-1"></a>There was one session marked <span class="in">`PRIVATE`</span>.</span>
<span id="cb58-244"><a href="#cb58-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-247"><a href="#cb58-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-248"><a href="#cb58-248" aria-hidden="true" tabindex="-1"></a>df_sessions <span class="sc">|&gt;</span></span>
<span id="cb58-249"><a href="#cb58-249" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(session_release <span class="sc">==</span> <span class="st">"PRIVATE"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-250"><a href="#cb58-250" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(vol_id, session_id, session_name, group_name)</span>
<span id="cb58-251"><a href="#cb58-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-252"><a href="#cb58-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-253"><a href="#cb58-253" aria-hidden="true" tabindex="-1"></a>Now, we join the screening data with the Databrary session data.</span>
<span id="cb58-254"><a href="#cb58-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-257"><a href="#cb58-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-258"><a href="#cb58-258" aria-hidden="true" tabindex="-1"></a>screen_datab_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(df_sessions, scr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'vol_id'</span>, <span class="st">'participant_ID'</span>))</span>
<span id="cb58-259"><a href="#cb58-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-260"><a href="#cb58-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-261"><a href="#cb58-261" aria-hidden="true" tabindex="-1"></a>Let's do some additional cleaning of redundant column names, e.g., exclusion.</span>
<span id="cb58-262"><a href="#cb58-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-265"><a href="#cb58-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-266"><a href="#cb58-266" aria-hidden="true" tabindex="-1"></a>screen_datab_df <span class="ot">&lt;-</span> screen_datab_df <span class="sc">|&gt;</span></span>
<span id="cb58-267"><a href="#cb58-267" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unite</span>(exclusion_reason, <span class="fu">c</span>(<span class="st">"exclusion1_reason"</span>, <span class="st">"exclusion2_reason"</span>, <span class="st">"exclusion_reason"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb58-268"><a href="#cb58-268" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">exclusion_reason =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(exclusion_reason, <span class="st">"NA|_"</span>))</span>
<span id="cb58-269"><a href="#cb58-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-270"><a href="#cb58-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-271"><a href="#cb58-271" aria-hidden="true" tabindex="-1"></a><span class="fu">## Export cleaned file {-}</span></span>
<span id="cb58-272"><a href="#cb58-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-273"><a href="#cb58-273" aria-hidden="true" tabindex="-1"></a>We date-stamp the exported file so we can monitor progress as this workflow develops.</span>
<span id="cb58-274"><a href="#cb58-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-275"><a href="#cb58-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r export-screen}</span></span>
<span id="cb58-276"><a href="#cb58-276" aria-hidden="true" tabindex="-1"></a><span class="in">sfn &lt;- paste0("PLAY-screening-datab-", Sys.Date(), ".csv")</span></span>
<span id="cb58-277"><a href="#cb58-277" aria-hidden="true" tabindex="-1"></a><span class="in">readr::write_csv(screen_datab_df, file.path(here::here(), "data/csv/screening/agg/", sfn))</span></span>
<span id="cb58-278"><a href="#cb58-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-279"><a href="#cb58-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-280"><a href="#cb58-280" aria-hidden="true" tabindex="-1"></a>We also save a copy with "latest".</span>
<span id="cb58-281"><a href="#cb58-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-282"><a href="#cb58-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r export-latest}</span></span>
<span id="cb58-283"><a href="#cb58-283" aria-hidden="true" tabindex="-1"></a><span class="in">sfn &lt;- "PLAY-screening-datab-latest.csv"</span></span>
<span id="cb58-284"><a href="#cb58-284" aria-hidden="true" tabindex="-1"></a><span class="in">readr::write_csv(screen_datab_df, file.path(here::here(), "data/csv/screening/agg/", sfn))</span></span>
<span id="cb58-285"><a href="#cb58-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/PLAY-behaviorome/KoBoToolbox/edit/main/src/screen-clean.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/PLAY-behaviorome/KoBoToolbox/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>