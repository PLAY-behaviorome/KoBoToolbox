[{"path":"index.html","id":"about","chapter":"About","heading":"About","text":"","code":""},{"path":"index.html","id":"purpose","chapter":"About","heading":"Purpose","text":"PLAY project researchers use KoBoToolbox collect data participant families.\nData sessions PLAY data collection sites pushed common set files KoBoToolbox server.document describes process ) downloading, ii) parsing, iii) cleaning, iv) exporting files forms suitable data analysis.","code":""},{"path":"index.html","id":"overview-of-data-sets","chapter":"About","heading":"Overview of data sets","text":"two sets data collected using KoBoToolbox.\nOne set collected recruiting screening calls study.\nsecond set collected home visit.","code":""},{"path":"index.html","id":"data-access-and-processing","chapter":"About","heading":"Data access and processing","text":"data downloaded manipulated locally synched GitHub.\naccomplished adding data protocol/.gitignore.separate processes detecting deleting personal identifiers specific data files exporting ‘cleaned’ versions may shared Databrary.","code":""},{"path":"index.html","id":"home-visit-data","chapter":"About","heading":"Home visit data","text":"three (3) age groups (12-, 18-, 24-month-olds) four (4) different language environment groups (English-, Spanish-, Bilingual-English-dominant, Bilingual-Spanish-dominant).\nSince language questions specific questions vary age group language environment group, \\(3*4=12\\) different KoBoToolbox survey form files must processed.","code":""},{"path":"setup.html","id":"setup","chapter":"Setup","heading":"Setup","text":"section describes setup procedure.","code":""},{"path":"setup.html","id":"authentication","chapter":"Setup","heading":"Authentication","text":"data stored account https://kf.kobotoolbox.org.\nlogin credentials account shared among PLAY Project staff.\naccess site’s API programmatically, API key downloaded added local ~/.Renviron file.KoBoToolBox API key synched GitHub.","code":""},{"path":"setup.html","id":"set-up","chapter":"Setup","heading":"Set-up","text":"test whether local system API key installed, run command Sys.getenv(\"KOBO_API_KEY\").","code":""},{"path":"setup.html","id":"check-kobo-api-key","chapter":"Setup","heading":"Check KoBo API Key","text":"","code":"\nkb_api <- Sys.getenv(\"KOBO_API_KEY\")\nif ((length(kb_api) != 1) || (!is.character(kb_api))) {\n  stop(\"'KOBO_API_KEY' not installed in .Renviron\")\n} else {\n  message(\"'KOBO_API_KEY' installed.\")\n}## 'KOBO_API_KEY' installed."},{"path":"setup.html","id":"loadsource-helper-functions","chapter":"Setup","heading":"Load/source helper functions","text":"API key installed, several custom functions R/kobo_export.R can run.","code":"\nif (file.exists(\"R/kobo_export.R\")) {\n  source(file.path(\"R/kobo_export.R\"))\n} else {\n  stop(\"File not found: 'R/kobo_export.R'\")\n}"},{"path":"setup.html","id":"install-dependencies","chapter":"Setup","heading":"Install dependencies","text":"helper functions require several external packages. confirm installed, run following chunk.","code":"\nif (params$install_deps) {\n  install_kobo_packages()  \n} else {\n  message(\"'params$install_deps' is FALSE, so no dependencies are installed.\")\n}## 'params$install_deps' is FALSE, so no dependencies are installed."},{"path":"screening-call.html","id":"screening-call","chapter":"Screening call","heading":"Screening call","text":"","code":""},{"path":"screening-call.html","id":"collection-protocol","chapter":"Screening call","heading":"Collection protocol","text":"Details data collection protocol participant screening recruiting can found PLAY Project website.","code":""},{"path":"screening-call.html","id":"retrieve-files-from-kobotoolbox","chapter":"Screening call","heading":"Retrieve files from KoBoToolbox","text":"relevant KoBoToolbox data files ‘Demographic Questionnaire’ title.","code":"\nkb_df <- list_kobo_data()\nif ((dim(kb_df)[1] < 1) || (!is.data.frame(kb_df))) {\n  stop(\"Error in selecting surveys from KoBoToolbox.\")\n}\n\n# Restrict to surveys collected at home\nkb_demog <- kb_df %>%\n  dplyr::filter(., stringr::str_detect(title, \"Demographic\"))\n\nif ((dim(kb_demog)[1] < 1) || (!is.data.frame(kb_demog))) {\n  stop(\"Error in selecting demographics surveys from KoBoToolbox.\")\n}"},{"path":"screening-call.html","id":"save-selected-raw-files-to-local-directory","chapter":"Screening call","heading":"Save selected raw files to local directory","text":"Prepare retrieve demographic data files.","code":"\nif (!dir.exists('data/xlsx/screening')) {\n  stop(\"Directory not found: 'data/xlsx/screening'\")\n}\nn_files <- dim(kb_demog)[1]\nif (params$screening_download) {\npurrr::map(1:n_files, retrieve_save_xls_export, kb_df = kb_demog, save_dir = \"data/xlsx/screening\")  \n} else {\n  message(\"'params$screening_download' is FALSE. KBT files not downloaded.\")\n}## Saved `data/xlsx/screening/334134_PLAY_Demographic_Questionnaire_Spanish.xlsx`## Saved `data/xlsx/screening/359546_PLAY_Demographic_Questionnaire.xlsx`## Saved `data/xlsx/screening/275882_PLAY_Demographic_Questionnaire.xlsx`"},{"path":"screening-call.html","id":"convert-to-csvs","chapter":"Screening call","heading":"Convert to CSVs","text":"default, presume want convert XLSX files data/xlxs/screening CSVs.","code":""},{"path":"screening-call.html","id":"open-files-and-process","chapter":"Screening call","heading":"Open file(s) and process","text":"strictly necessary, filter downloaded filename ensure includes ‘Demographic_Questionnaire’.\nleading 6-digit integer unique ‘form’ identifier, extract .Create helper function handle import, renaming, exporting.Import xlsx save csv version.","code":"\ndemog_fns <- list.files(file.path(\"data/xlsx/screening\"), pattern = \"Demographic_Questionnaire\", full.names = TRUE)\n\ndemog_fns_trimmed <- basename(stringr::str_replace(demog_fns, pattern = \"\\\\.xlsx\", replacement = \"\\\\.csv\"))\n\nform_ids <- stringr::str_extract(demog_fns_trimmed, pattern = \"[0-9]{6}\")\nload_xlsx_save_csv <- function(i, fl) {\n  xl <- readxl::read_xlsx(fl[i])\n  fn_csv <- stringr::str_replace(fl[i], pattern = \"\\\\.xlsx\", replacement = \"\\\\.csv\")\n  fn_csv <- stringr::str_replace(fn_csv, pattern = \"/xlsx/\", \"/csv/\")\n  if (dir.exists(dirname(fn_csv))) {\n    readr::write_csv(xl, fn_csv)    \n  } else {\n    warning(\"Directory not found: '\", dirname(fn_csv), \"'\")\n  }\n}\npurrr::map(1:length(demog_fns), load_xlsx_save_csv, demog_fns)"},{"path":"screening-call.html","id":"merge-files","chapter":"Screening call","heading":"Merge files","text":"","code":""},{"path":"screening-call.html","id":"compare-the-files","chapter":"Screening call","heading":"Compare the files","text":"merging, examine fields compare.Open first file: ‘275882_PLAY_Demographic_Questionnaire.csv’.\\(n=\\) 20 data records \\(n=\\) 168 fields.Open second file: ‘334134_PLAY_Demographic_Questionnaire_Spanish.csv’.\\(n=\\) 2 data records \\(n=\\) 236 fields.Open third file: ‘359546_PLAY_Demographic_Questionnaire.csv’.\\(n=\\) 231 data records \\(n=\\) 239 fields.files different numbers columns, need careful creating merged data file.","code":"\ncsv_fns <- list.files(\"data/csv/screening\", pattern = \"\\\\.csv\", full.names = TRUE)\ndemog_1 <- readr::read_csv(csv_fns[1], show_col_types = FALSE)\ndemog_2 <- readr::read_csv(csv_fns[2], show_col_types = FALSE)\ndemog_3 <- readr::read_csv(csv_fns[3], show_col_types = FALSE)"},{"path":"screening-call.html","id":"extract-column-names","chapter":"Screening call","heading":"Extract column names","text":"Compare 1 2.Compare 1 3.Compare 2 3.second third data files overlap.","code":"\ndemog_1_names <- names(demog_1)\ndemog_2_names <- names(demog_2)\ndemog_3_names <- names(demog_3)\nsum(demog_1_names == demog_2_names)## Warning in demog_1_names == demog_2_names: longer object\n## length is not a multiple of shorter object length## [1] 3\nsum(demog_1_names == demog_3_names)## Warning in demog_1_names == demog_3_names: longer object\n## length is not a multiple of shorter object length## [1] 3\nsum(demog_2_names == demog_3_names)## Warning in demog_2_names == demog_3_names: longer object\n## length is not a multiple of shorter object length## [1] 131"},{"path":"screening-call.html","id":"extract-core-variables","chapter":"Screening call","heading":"Extract core variables","text":"Since data come enrolled participants, careful variables extract project management purposes.","code":""},{"path":"screening-call.html","id":"focus-on-demog_1","chapter":"Screening call","heading":"Focus on demog_1","text":"want look history submissions KoBoToolbox site, need extract following variables: c_today site_id long name play_phone_questionnaire/group_siteinfo/site_idExamine unique values site_id since naming convention variable changed project lifetime.Clean names clear alternative names.","code":"\ndemog_1_submissions <- demog_1 %>%\n  dplyr::select(., submit_date = c_today, site_id = `play_phone_questionnaire/group_siteinfo/site_id`)\nunique(demog_1_submissions$site_id)## [1] \"NYU\"              NA                \n## [3] \"new_york_unive\"   \"university_of__3\"\n## [5] \"georgetown_uni\"   \"GTN\"             \n## [7] \"UCR\"\ndemog_1_submissions <- demog_1_submissions %>%\n  dplyr::mutate(site_id = dplyr::recode(site_id,\n                new_york_unive = \"NYU\",\n                georgetown_uni = \"GTN\")) %>%\n  dplyr::filter(., !stringr::str_detect(site_id, '_of__')) %>%\n  dplyr::arrange(., submit_date)"},{"path":"screening-call.html","id":"examine-demog_2-and-demog_3","chapter":"Screening call","heading":"Examine demog_2 and demog_3","text":"demog_2 one row.demog_3.Examine unique values site_id.use 5 character site IDs. NYU ‘NYUNI’; GTN ‘GEORG’; UCR ‘UCRIV’.Change demog_1_submissions conform new standard can merge data sets.","code":"\ndemog_2_submissions <- demog_2 %>%\n  dplyr::select(., submit_date = c_today, site_id = `play_demo_questionnaire/group_siteinfo/site_id`)\ndemog_3_submissions <- demog_3 %>%\n  dplyr::select(., submit_date = c_today, site_id = `play_demo_questionnaire/group_siteinfo/site_id`)\nunique(demog_3_submissions$site_id)##  [1] \"NYUNI\" \"VCOMU\" \"GEORG\" \"UCRIV\" \"UMIAM\" \"UCSCR\"\n##  [7] \"OHIOS\" \"PURDU\" \"CSULB\" \"CSLON\" NA      \"STANF\"\n## [13] \"UHOUS\" \"CHOPH\" \"INDNA\" \"UIOWA\" \"VBLTU\" \"CSUFL\"\n## [19] \"BOSTU\" \"UTAUS\" \"UGEOR\" \"PRINU\"\ndemog_1_submissions <- demog_1_submissions %>%\n  dplyr::mutate(site_id = dplyr::recode(site_id,\n                NYU = \"NYUNI\",\n                GTN = \"GEORG\",\n                UCR = \"UCRIV\"))"},{"path":"screening-call.html","id":"merge-files-1","chapter":"Screening call","heading":"Merge files","text":"Add cumulative n_calls variable.","code":"\ndemog_submissions <- rbind(demog_1_submissions, demog_2_submissions, demog_3_submissions)\ndemog_submissions <- demog_submissions %>%\n  dplyr::arrange(., submit_date) %>%\n  dplyr::mutate(., n_calls = seq_along(submit_date))"},{"path":"screening-call.html","id":"plots","chapter":"Screening call","heading":"Plots","text":"Plot time series recruiting/screening calls.\nFigure 1: Time series recruiting/screening calls.\nPlot number calls made site.\nFigure 2: Recruiting calls site\n","code":"\ndemog_submissions %>%\n  ggplot(.) +\n  aes(submit_date, n_calls, color = site_id) +\n  geom_point()\ndemog_submissions %>%\n  ggplot(.) +\n  aes(site_id, fill = site_id) +\n  geom_bar() +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) # Rotate text"},{"path":"home-visit.html","id":"home-visit","chapter":"Home visit","heading":"Home visit","text":"","code":""},{"path":"home-visit.html","id":"protocol","chapter":"Home visit","heading":"Protocol","text":"Details data collection protocol home visit can found [PLAY Project website]((https://www.play-project.org/collection.html#Home_Visit).","code":""},{"path":"home-visit.html","id":"download-data","chapter":"Home visit","heading":"Download data","text":"Data files language age-group conditions stored KoBoToolbox (KBT).List data files KBT.List data forms specific home visit.","code":"\nkb_df <- list_kobo_data()\nif ((dim(kb_df)[1] < 1) || (!is.data.frame(kb_df))) {\n  stop(\"Error in selecting surveys from KoBoToolbox.\")\n}\n# Restrict to surveys collected at home\nkb_home <- kb_df %>%\n  dplyr::filter(., stringr::str_detect(title, \"Home\"))\n\nif ((dim(kb_home)[1] < 1) || (!is.data.frame(kb_home))) {\n  stop(\"Error in selecting home surveys from KoBoToolbox.\")\n}"},{"path":"home-visit.html","id":"save-selected-raw-files-to-local-directory-1","chapter":"Home visit","heading":"Save selected raw files to local directory","text":"Prepare retrieve home visit files.\\(n=\\) 24 home visit data files.\nupdate/download params$home_visit_download TRUE (default).Document-wide parameters set header index.Rmd.often set results = FALSE message = FALSE chunk headers code HTML summaries just . Suppressing results way suppress useful output R console.","code":"\nif (!dir.exists(params$home_visit_dir_xlsx)) {\n  stop(\"Directory not found: '\", params$home_visit_dir_xlsx, \"'\")\n}\nn_files <- dim(kb_home)[1]\n# We _want_ to see the message, but not the results\nif (params$home_visit_download) {\n  purrr::map(\n    1:n_files,\n    retrieve_save_xls_export,\n    kb_df = kb_home,\n    save_dir = params$home_visit_dir_xlsx\n  )\n} else {\n  message(\"'params$home_visit_download' is FALSE. KBT files not downloaded.\")\n}## Saved `data/xlsx/home_visit/411456_PLAY_Home_Questionaires_-_12_Bilingual_English_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/740625_PLAY_HomeQuestionaires_12_English.xlsx`## Saved `data/xlsx/home_visit/331453_PLAY_Home_Questionnaires_24_English.xlsx`## Saved `data/xlsx/home_visit/363465_PLAY_Home_Questionnaires_-_24_Bilingual_English_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/363431_PLAY_Home_Questionnaires_-_12_English_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/334099_PLAY_Home_Questionnaires_12_Bilingual_-_English.xlsx`## Saved `data/xlsx/home_visit/363349_PLAY_Home_Questionnaires_-_18_English_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/307736_PLAY_Home_Questionnaires_18_English.xlsx`## Saved `data/xlsx/home_visit/740631_PLAY_HomeQuestionaires_24_Bilingual_English.xlsx`## Saved `data/xlsx/home_visit/1151489_Clone_of_Clone_of_PLAY_HomeQuestionnaires_18_English_-_NO_AUTO_METADATA.xlsx`## Saved `data/xlsx/home_visit/1136694_Clone_of_PLAY_HomeQuestionnaires_18_English_-_NO_AUTO_TODAY.xlsx`## Saved `data/xlsx/home_visit/740623_PLAY_HomeQuestionaires_12_Bilingual_English.xlsx`## Saved `data/xlsx/home_visit/740628_PLAY_HomeQuestionnaires_18_English.xlsx`## Saved `data/xlsx/home_visit/363466_PLAY_Home_Questionnaires_-_18_Bilingual_English_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/411469_PLAY_Home_Questionnaires_-_12_Bilingual_Spanish_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/740630_PLAY_HomeQuestionaires_24_Bilingual_Spanish.xlsx`## Saved `data/xlsx/home_visit/411388_PLAY_Home_Questionnaires_-_18_Bilingual_Spanish_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/740624_PLAY_HomeQuestionaires_12_Bilingual_Spanish.xlsx`## Saved `data/xlsx/home_visit/363381_PLAY_Home_Questionnaires_-_24_English_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/740626_PLAY_HomeQuestionaires_18_Bilingual_English.xlsx`## Saved `data/xlsx/home_visit/331848_PLAY_Home_Questionnaires_12_English.xlsx`## Saved `data/xlsx/home_visit/740629_PLAY_HomeQuestionnaires_24_English.xlsx`## Saved `data/xlsx/home_visit/408149_PLAY_Home_Questionnaires_-_24_Bilingual_Spanish_2020-03-04.xlsx`## Saved `data/xlsx/home_visit/740627_PLAY_HomeQuestionaires_18_Bilingual_Spanish.xlsx`"},{"path":"home-visit.html","id":"normalize-file-names","chapter":"Home visit","heading":"Normalize file names","text":"form names inconsistent, normalize fit following pattern:<form_id>_PLAY_HomeQuestionnaires_<age_group>_<lang_group>.xlsx","code":"\nfl <- list.files(params$home_visit_dir_xlsx, full.names = TRUE)\nfl_home_old <- fl[stringr::str_detect(fl, 'Home')]\nfl_home_new <- purrr::map_chr(fl_home_old, make_standard_form_name)\nfile.rename(fl_home_old, fl_home_new)"},{"path":"home-visit.html","id":"save-xlsx-as-csv","chapter":"Home visit","heading":"Save xlsx as csv","text":"","code":"\nif (!dir.exists(params$home_visit_dir_csv)) {\n  stop(\"Directory not found: '\", params$home_visit_dir_csv, \"'\")\n} else {\n  purrr::map(fl_home_new,\n             open_xlsx_save_csv,\n             params$home_visit_dir_csv,\n             vb = TRUE)\n}"},{"path":"home-visit.html","id":"split-mb-cdi-from-other-questions","chapter":"Home visit","heading":"Split MB-CDI from other questions","text":"Next import CSV given form year, age group, language group, create two new CSV files: one MB-CDI data one survey questions.default, document presumes want convert CSV files meet params$form_years, params$age_grps, params$lang_grps constraints found params$csv_input_dir pairs properly named CSVs save params$csv_save_dir.Extract ‘non-mbcdi’ questions first add ‘non_mbcdi’ filename.Extracting MB-CDI data nearly function call, these_questions parameter set ‘mbcdi’.","code":"\ncsv_fns <- list.files(params$home_visit_dir_csv, '^[0-9]+_raw_[12|18|24]', full.names = TRUE)\n\npurrr::map(\n  csv_fns,\n  open_split_save,\n  csv_save_dir = params$home_visit_dir_csv,\n  these_questions = 'non_mbcdi'\n)\npurrr::map(\n  csv_fns,\n  open_split_save,\n  csv_save_dir = params$home_visit_dir_csv,\n  these_questions = 'mbcdi'\n)"},{"path":"home-visit.html","id":"clean-data","chapter":"Home visit","heading":"Clean data","text":"","code":""},{"path":"home-visit.html","id":"remove-identifiers","chapter":"Home visit","heading":"Remove identifiers","text":"function remove_identifiers() R/kobo_export detects presence names, addresses, phone numbers, email, dates field names input file removes fields.\nalso modifies file name appending _deidentified.non-MBCDI file contains identifiers, target removal process.Note added data .gitignore protocol/, root directory HTML protocol, none data files made available via git GitHub. also means version control done raw data files .","code":"\npurrr::map(\n  csv_fns,\n  open_deidentify_save,\n  csv_save_dir = params$home_visit_dir_csv,\n  these_questions = 'non_mbcdi'\n)"},{"path":"data-dictionary.html","id":"data-dictionary","chapter":"Data dictionary","heading":"Data dictionary","text":"","code":""},{"path":"visualization.html","id":"visualization","chapter":"Visualization","heading":"Visualization","text":"","code":""}]
