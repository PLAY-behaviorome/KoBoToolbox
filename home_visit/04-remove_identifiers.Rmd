---
title: "Remove identifiers"
subtitle: "Version `r Sys.time()`"
author: Rick Gilmore
output: 
  html_document:
    code_folding: show
    self_contained: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
params:
  project_root_dir: ".."
  csv_input_dir: 'data/csv/release_1.0/mbcdi_non'
  csv_save_dir: 'data/csv/release_1.0/identifiers_removed'
  age_grps: ['12', '18', '24']
  lang_grps: ['English', 'Bilingual_English', 'Bilingual_Spanish']
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

This document imports an form of non-MB-CDI questions given age group, and language group, and creates a new file in a new directory with the identifers removed. To do this, we run a `remove_identifiers()` function that deletes those columns with names, addresses, dates, email addresses, and phone numbers before saving the file.

By default, the document presumes that we want to convert **all** of the CSV files that meet the `params$form_years`, `params$age_grps`, and `params$lang_grps` constraints found in `params$csv_input_dir` to pairs of properly named CSVs and save them in `params$csv_save_dir`.

# Setup

We source the helper functions in `R/kobo_export.R`.

```{r source_helpers}
source(file.path(params$project_root_dir, "R/kobo_export.R"))
```

# Open file(s) and process

Because we have parameterized the form year, age groups, and language groups, we can use the `mapply()` function here -- as long as we make sure that the parameter vectors have the right length and composition.

## Non-MB-CDI data

```{r import_save_non_mbcdi_csv, eval=FALSE}
mapply(import_non_mbcdi_remove_ids, 
       form_year = rep(params$form_years, 9), 
       age_grp = rep(params$age_grps, 3),
       lang_grp = rep(params$lang_grps, each = 3),
       csv_input_dir = params$csv_input_dir,
       csv_save_dir = params$csv_save_dir,
       these_questions = 'non_mbcdi')
```

```{r}
csv_fns <-
  list.files(file.path(params$project_root_dir, params$csv_input_dir),
             '^[0-9]{6}_non_mbcdi_[12|18|24]',
             full.names = TRUE)

if (length(csv_fns) <= 0) warning("No matching files found in ", file.path(params$project_root_dir, params$csv_input_dir))
```

```{r}
purrr::map(
  csv_fns,
  open_deidentify_save,
  csv_save_dir = file.path(params$project_root_dir, params$csv_save_dir),
  these_questions = 'non_mbcdi'
)
```

