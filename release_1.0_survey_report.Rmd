---
title: 'PLAY Release 1.0: Surveys'
subtitle: "Version `r Sys.time()`"
author: Rick Gilmore
output: 
  html_document:
    code_folding: hide
    self_contained: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
params:
  kobo_csv_fn: 'tmp/PLAY_non_mbcdi_all_merge.csv'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

This document summarizes the workflow for the PLAY 1.0 data release related to the non-MBCDI survey data.

# Setup

The user should authenticate to Databrary using `databraryapi::login_db()` prior to knitting this document.

Import helper functions.

```{r}
source("R/kobo_databrary_integration.R")

library(tidyverse) # for %>% pipe
```

# Import & merge data

We import data from KoBoToolbox and from Databrary and merge the files.

```{r import-kobo-merge-w-databrary}
play_merge <- readr::read_csv(params$kobo_csv_fn, show_col_types = FALSE)
```

# Visualize

## Demographic data summaries

### Age group by QA status

```{r}
xtabs(formula = ~ group.name + age_group, data = play_merge)
```

### Sex by age group

```{r}
xtabs(formula = ~ child_sex + age_group, data = play_merge)
```

### QA status by site

```{r}
xtabs(formula = ~ group.name + site_id, data = play_merge)
```

## Links to Databrary sessions

```{r}
play_selected <- play_merge %>%
  dplyr::select(., age_group, child_sex, language_child, group.name, databrary_url)

play_selected %>%
  dplyr::arrange(., group.name, age_group) %>%
  knitr::kable(., caption = "Selected PLAY data") %>%
  kableExtra::kable_material(c("striped", "hover"))
```

