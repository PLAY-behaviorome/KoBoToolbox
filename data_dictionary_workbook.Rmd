---
title: "Creating a data dictionary"
subtitle: "Version `r Sys.time()`"
author: Rick Gilmore
output: html_notebook
---

# Purpose

This document describes Rick Gilmore's work on generating a data dictionary for the PLAY project.

# Overall approach

1. Download questions (not answers)
2. Examine their structure
3. Determine format/content of data dictionary
4. Determine how to edit question form to comport with edits to exported data files

# Downloading questions

ROG logged-in to the PLAY Project account on KoBoToolbox.org and manually downloaded the XLSX and XML versions of the `12_HomeQuestionaires_12_English` form. ROG then moved the downloaded file to `data_dict/xlsx` and `data_dict/xml`.

```{r}
list.files('data_dict/xlsx')
list.files('data_dict/xml')
```

Note that the downloaded file name is an internal one generated from KoBoToolbox.

## Load questions

Let's open the XLSX version and examine the relevant fields.

```{r}
qs_12_eng <- readxl::read_excel("data_dict/xlsx/a8HyzdxnVjK53dt4fX3Vup.xlsx")
str(qs_12_eng)
```

The `name` field is closest to the variable name (without 'group' labels).

```{r}
qs_12_eng$name
```

The `label` field contains the question information.

It might be easiest to merge the field names we get from the completed survey data with this data set and do the cleaning/excerpting on the combined file.

The following chunk is borrowed from `gather_clean_visit.Rmd`.

```{r}
data_12_eng <- readxl::read_excel("tmp/740625_PLAY_HomeQuestionaires_12_English-2021-07-29.xlsx")
```

```{r}
dim(qs_12_eng)
dim(data_12_eng)
```

Darn. The length of `qs_12` does not equal the width of `data_12_eng`. Let's look at the head rows to see what's going on.

```{r}
data_cols <- names(data_12_eng)

head(data_cols, 20)
```

```{r}
head(qs_12_eng$name, 20)
```

Just for grins, let's try `basename()` on the data cols to trim the 'path-like' info and look at alignment there.

```{r}
head(basename(data_cols), 20)
```

```{r}
head(qs_12_eng$name, 20)
```

That looks a little closer. I wonder if we can inner_join these?

```{r}
data_qs_df <- tibble::tibble(data_col_index = 1:length(data_cols), data_col_name = basename(data_cols))
```

Now, let's try to join these.

```{r}
qs_data_df <- dplyr::left_join(qs_12_eng, data_qs_df, by = c("name" = "data_col_name"))
```

Let's look at how this went.

```{r}
head(qs_data_df[, c('type', 'name', 'label', 'data_col_index')], 30)
```
That looks ok. How about the tail?

```{r}
tail(qs_data_df[, c('type', 'name', 'label', 'data_col_index')], 30)
```

